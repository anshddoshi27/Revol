"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/admin/notifications/templates/[id]/route";
exports.ids = ["app/api/admin/notifications/templates/[id]/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_3017387smacbookm_Downloads_Career_Tithi_apps_web_src_app_api_admin_notifications_templates_id_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/admin/notifications/templates/[id]/route.ts */ \"(rsc)/./src/app/api/admin/notifications/templates/[id]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/admin/notifications/templates/[id]/route\",\n        pathname: \"/api/admin/notifications/templates/[id]\",\n        filename: \"route\",\n        bundlePath: \"app/api/admin/notifications/templates/[id]/route\"\n    },\n    resolvedPagePath: \"/Users/3017387smacbookm/Downloads/Career/Tithi/apps/web/src/app/api/admin/notifications/templates/[id]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_3017387smacbookm_Downloads_Career_Tithi_apps_web_src_app_api_admin_notifications_templates_id_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/admin/notifications/templates/[id]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhZG1pbiUyRm5vdGlmaWNhdGlvbnMlMkZ0ZW1wbGF0ZXMlMkYlNUJpZCU1RCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYWRtaW4lMkZub3RpZmljYXRpb25zJTJGdGVtcGxhdGVzJTJGJTVCaWQlNUQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhZG1pbiUyRm5vdGlmaWNhdGlvbnMlMkZ0ZW1wbGF0ZXMlMkYlNUJpZCU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRjMwMTczODdzbWFjYm9va20lMkZEb3dubG9hZHMlMkZDYXJlZXIlMkZUaXRoaSUyRmFwcHMlMkZ3ZWIlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGMzAxNzM4N3NtYWNib29rbSUyRkRvd25sb2FkcyUyRkNhcmVlciUyRlRpdGhpJTJGYXBwcyUyRndlYiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDK0Q7QUFDNUk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvPzM2MmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzLzMwMTczODdzbWFjYm9va20vRG93bmxvYWRzL0NhcmVlci9UaXRoaS9hcHBzL3dlYi9zcmMvYXBwL2FwaS9hZG1pbi9ub3RpZmljYXRpb25zL3RlbXBsYXRlcy9baWRdL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hZG1pbi9ub3RpZmljYXRpb25zL3RlbXBsYXRlcy9baWRdL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWRtaW4vbm90aWZpY2F0aW9ucy90ZW1wbGF0ZXMvW2lkXVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYWRtaW4vbm90aWZpY2F0aW9ucy90ZW1wbGF0ZXMvW2lkXS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy8zMDE3Mzg3c21hY2Jvb2ttL0Rvd25sb2Fkcy9DYXJlZXIvVGl0aGkvYXBwcy93ZWIvc3JjL2FwcC9hcGkvYWRtaW4vbm90aWZpY2F0aW9ucy90ZW1wbGF0ZXMvW2lkXS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvYWRtaW4vbm90aWZpY2F0aW9ucy90ZW1wbGF0ZXMvW2lkXS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/admin/notifications/templates/[id]/route.ts":
/*!*****************************************************************!*\
  !*** ./src/app/api/admin/notifications/templates/[id]/route.ts ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_notifications__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/notifications */ \"(rsc)/./src/lib/notifications.ts\");\n\n\n\n\n/**\n * PUT /api/admin/notifications/templates/[id]\n * \n * Update an existing notification template\n * \n * Body: {\n *   name?: string\n *   channel?: 'email' | 'sms'\n *   category?: string\n *   trigger?: string\n *   subject?: string\n *   body?: string\n *   is_enabled?: boolean\n * }\n */ async function PUT(request, { params }) {\n    try {\n        const userId = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getCurrentUserId)();\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const businessId = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getCurrentBusinessId)();\n        if (!businessId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Business not found\"\n            }, {\n                status: 404\n            });\n        }\n        const body = await request.json();\n        const { name, channel, category, trigger, subject, body: bodyText, is_enabled } = body;\n        const supabase = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.createServerClient)();\n        // Verify template exists and belongs to user\n        const { data: existing, error: fetchError } = await supabase.from(\"notification_templates\").select(\"*\").eq(\"id\", params.id).eq(\"user_id\", userId).eq(\"business_id\", businessId).is(\"deleted_at\", null).single();\n        if (fetchError || !existing) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Template not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Validate channel if provided\n        if (channel && channel !== \"email\" && channel !== \"sms\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'channel must be \"email\" or \"sms\"'\n            }, {\n                status: 400\n            });\n        }\n        // Validate trigger if provided\n        if (trigger) {\n            const validTriggers = [\n                \"booking_created\",\n                \"booking_confirmed\",\n                \"reminder_24h\",\n                \"reminder_1h\",\n                \"booking_cancelled\",\n                \"booking_rescheduled\",\n                \"booking_completed\",\n                \"fee_charged\",\n                \"refunded\"\n            ];\n            if (!validTriggers.includes(trigger)) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Invalid trigger. Must be one of: ${validTriggers.join(\", \")}`\n                }, {\n                    status: 400\n                });\n            }\n        }\n        // Validate placeholders if body is provided\n        if (bodyText !== undefined) {\n            const placeholderValidation = (0,_lib_notifications__WEBPACK_IMPORTED_MODULE_3__.validatePlaceholders)(bodyText);\n            if (!placeholderValidation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Invalid placeholders found\",\n                    invalid_placeholders: placeholderValidation.invalid,\n                    allowed_placeholders: _lib_notifications__WEBPACK_IMPORTED_MODULE_3__.ALLOWED_PLACEHOLDERS\n                }, {\n                    status: 400\n                });\n            }\n        }\n        if (subject !== undefined) {\n            const subjectValidation = (0,_lib_notifications__WEBPACK_IMPORTED_MODULE_3__.validatePlaceholders)(subject || \"\");\n            if (!subjectValidation.valid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Invalid placeholders in subject\",\n                    invalid_placeholders: subjectValidation.invalid,\n                    allowed_placeholders: _lib_notifications__WEBPACK_IMPORTED_MODULE_3__.ALLOWED_PLACEHOLDERS\n                }, {\n                    status: 400\n                });\n            }\n        }\n        // Build update object\n        const updateData = {\n            updated_at: new Date().toISOString()\n        };\n        if (name !== undefined) updateData.name = name;\n        if (channel !== undefined) updateData.channel = channel;\n        if (category !== undefined) updateData.category = category;\n        if (trigger !== undefined) updateData.trigger = trigger;\n        if (subject !== undefined) updateData.subject = subject || null;\n        if (bodyText !== undefined) updateData.body_markdown = bodyText;\n        if (is_enabled !== undefined) updateData.is_enabled = is_enabled;\n        // Ensure email templates have subject\n        const finalChannel = channel || existing.channel;\n        if (finalChannel === \"email\" && !subject && !existing.subject) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"subject is required for email templates\"\n            }, {\n                status: 400\n            });\n        }\n        const { data: template, error: updateError } = await supabase.from(\"notification_templates\").update(updateData).eq(\"id\", params.id).eq(\"user_id\", userId).eq(\"business_id\", businessId).select().single();\n        if (updateError) {\n            console.error(\"Error updating template:\", updateError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to update template\",\n                details: updateError.message\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            template,\n            message: \"Template updated successfully\"\n        });\n    } catch (error) {\n        console.error(\"Error in PUT template:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * DELETE /api/admin/notifications/templates/[id]\n * \n * Soft delete a notification template\n */ async function DELETE(request, { params }) {\n    try {\n        const userId = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getCurrentUserId)();\n        if (!userId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const businessId = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getCurrentBusinessId)();\n        if (!businessId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Business not found\"\n            }, {\n                status: 404\n            });\n        }\n        const supabase = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.createServerClient)();\n        // Verify template exists\n        const { data: existing, error: fetchError } = await supabase.from(\"notification_templates\").select(\"id\").eq(\"id\", params.id).eq(\"user_id\", userId).eq(\"business_id\", businessId).is(\"deleted_at\", null).single();\n        if (fetchError || !existing) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Template not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Soft delete\n        const { error: deleteError } = await supabase.from(\"notification_templates\").update({\n            deleted_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        }).eq(\"id\", params.id).eq(\"user_id\", userId).eq(\"business_id\", businessId);\n        if (deleteError) {\n            console.error(\"Error deleting template:\", deleteError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to delete template\",\n                details: deleteError.message\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: \"Template deleted successfully\"\n        });\n    } catch (error) {\n        console.error(\"Error in DELETE template:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hZG1pbi9ub3RpZmljYXRpb25zL3RlbXBsYXRlcy9baWRdL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUEyQztBQUNHO0FBQ3NCO0FBQ2E7QUFFakY7Ozs7Ozs7Ozs7Ozs7O0NBY0MsR0FDTSxlQUFlTSxJQUNwQkMsT0FBZ0IsRUFDaEIsRUFBRUMsTUFBTSxFQUE4QjtJQUV0QyxJQUFJO1FBQ0YsTUFBTUMsU0FBUyxNQUFNUCwyREFBZ0JBO1FBQ3JDLElBQUksQ0FBQ08sUUFBUTtZQUNYLE9BQU9ULHFEQUFZQSxDQUFDVSxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQWUsR0FDeEI7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU1DLGFBQWEsTUFBTVYsK0RBQW9CQTtRQUM3QyxJQUFJLENBQUNVLFlBQVk7WUFDZixPQUFPYixxREFBWUEsQ0FBQ1UsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUFxQixHQUM5QjtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsTUFBTUUsT0FBTyxNQUFNUCxRQUFRRyxJQUFJO1FBQy9CLE1BQU0sRUFBRUssSUFBSSxFQUFFQyxPQUFPLEVBQUVDLFFBQVEsRUFBRUMsT0FBTyxFQUFFQyxPQUFPLEVBQUVMLE1BQU1NLFFBQVEsRUFBRUMsVUFBVSxFQUFFLEdBQUdQO1FBRWxGLE1BQU1RLFdBQVcsTUFBTXJCLDJEQUFrQkE7UUFFekMsNkNBQTZDO1FBQzdDLE1BQU0sRUFBRXNCLE1BQU1DLFFBQVEsRUFBRWIsT0FBT2MsVUFBVSxFQUFFLEdBQUcsTUFBTUgsU0FDakRJLElBQUksQ0FBQywwQkFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxNQUFNcEIsT0FBT3FCLEVBQUUsRUFDbEJELEVBQUUsQ0FBQyxXQUFXbkIsUUFDZG1CLEVBQUUsQ0FBQyxlQUFlZixZQUNsQmlCLEVBQUUsQ0FBQyxjQUFjLE1BQ2pCQyxNQUFNO1FBRVQsSUFBSU4sY0FBYyxDQUFDRCxVQUFV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QUFDLFdBQVduQixRQUNkbUIsRUFBRSxDQUFDLGVBQWVmLFlBQ2xCaUIsRUFBRSxDQUFDLGNBQWMsTUFDakJDLE1BQU07UUFFVCxJQUFJTixjQUFjLENBQUNELFVBQVU7WUFDM0IsT0FBT3hCLHFEQUFZQSxDQUFDVSxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQXFCLEdBQzlCO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxjQUFjO1FBQ2QsTUFBTSxFQUFFRCxPQUFPNkMsV0FBVyxFQUFFLEdBQUcsTUFBTWxDLFNBQ2xDSSxJQUFJLENBQUMsMEJBQ0x3QixNQUFNLENBQUM7WUFDTk8sWUFBWSxJQUFJYixPQUFPQyxXQUFXO1lBQ2xDRixZQUFZLElBQUlDLE9BQU9DLFdBQVc7UUFDcEMsR0FDQ2pCLEVBQUUsQ0FBQyxNQUFNcEIsT0FBT3FCLEVBQUUsRUFDbEJELEVBQUUsQ0FBQyxXQUFXbkIsUUFDZG1CLEVBQUUsQ0FBQyxlQUFlZjtRQUVyQixJQUFJMkMsYUFBYTtZQUNmTCxRQUFReEMsS0FBSyxDQUFDLDRCQUE0QjZDO1lBQzFDLE9BQU94RCxxREFBWUEsQ0FBQ1UsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztnQkFBNkJ5QyxTQUFTSSxZQUFZSCxPQUFPO1lBQUMsR0FDbkU7Z0JBQUV6QyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxPQUFPWixxREFBWUEsQ0FBQ1UsSUFBSSxDQUFDO1lBQ3ZCMkMsU0FBUztRQUNYO0lBQ0YsRUFBRSxPQUFPMUMsT0FBTztRQUNkd0MsUUFBUXhDLEtBQUssQ0FBQyw2QkFBNkJBO1FBQzNDLE9BQU9YLHFEQUFZQSxDQUFDVSxJQUFJLENBQ3RCO1lBQUVDLE9BQU87WUFBeUJ5QyxTQUFTekMsaUJBQWlCMkMsUUFBUTNDLE1BQU0wQyxPQUFPLEdBQUc7UUFBZ0IsR0FDcEc7WUFBRXpDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4vc3JjL2FwcC9hcGkvYWRtaW4vbm90aWZpY2F0aW9ucy90ZW1wbGF0ZXMvW2lkXS9yb3V0ZS50cz81OTBjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGNyZWF0ZVNlcnZlckNsaWVudCB9IGZyb20gJ0AvbGliL2RiJztcbmltcG9ydCB7IGdldEN1cnJlbnRVc2VySWQsIGdldEN1cnJlbnRCdXNpbmVzc0lkIH0gZnJvbSAnQC9saWIvYXV0aCc7XG5pbXBvcnQgeyB2YWxpZGF0ZVBsYWNlaG9sZGVycywgQUxMT1dFRF9QTEFDRUhPTERFUlMgfSBmcm9tICdAL2xpYi9ub3RpZmljYXRpb25zJztcblxuLyoqXG4gKiBQVVQgL2FwaS9hZG1pbi9ub3RpZmljYXRpb25zL3RlbXBsYXRlcy9baWRdXG4gKiBcbiAqIFVwZGF0ZSBhbiBleGlzdGluZyBub3RpZmljYXRpb24gdGVtcGxhdGVcbiAqIFxuICogQm9keToge1xuICogICBuYW1lPzogc3RyaW5nXG4gKiAgIGNoYW5uZWw/OiAnZW1haWwnIHwgJ3NtcydcbiAqICAgY2F0ZWdvcnk/OiBzdHJpbmdcbiAqICAgdHJpZ2dlcj86IHN0cmluZ1xuICogICBzdWJqZWN0Pzogc3RyaW5nXG4gKiAgIGJvZHk/OiBzdHJpbmdcbiAqICAgaXNfZW5hYmxlZD86IGJvb2xlYW5cbiAqIH1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBVVChcbiAgcmVxdWVzdDogUmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZyB9IH1cbikge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IGF3YWl0IGdldEN1cnJlbnRVc2VySWQoKTtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYnVzaW5lc3NJZCA9IGF3YWl0IGdldEN1cnJlbnRCdXNpbmVzc0lkKCk7XG4gICAgaWYgKCFidXNpbmVzc0lkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdCdXNpbmVzcyBub3QgZm91bmQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBuYW1lLCBjaGFubmVsLCBjYXRlZ29yeSwgdHJpZ2dlciwgc3ViamVjdCwgYm9keTogYm9keVRleHQsIGlzX2VuYWJsZWQgfSA9IGJvZHk7XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZVNlcnZlckNsaWVudCgpO1xuXG4gICAgLy8gVmVyaWZ5IHRlbXBsYXRlIGV4aXN0cyBhbmQgYmVsb25ncyB0byB1c2VyXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZywgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnbm90aWZpY2F0aW9uX3RlbXBsYXRlcycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaWQnLCBwYXJhbXMuaWQpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ2J1c2luZXNzX2lkJywgYnVzaW5lc3NJZClcbiAgICAgIC5pcygnZGVsZXRlZF9hdCcsIG51bGwpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZmV0Y2hFcnJvciB8fCAhZXhpc3RpbmcpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1RlbXBsYXRlIG5vdCBmb3VuZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGNoYW5uZWwgaWYgcHJvdmlkZWRcbiAgICBpZiAoY2hhbm5lbCAmJiBjaGFubmVsICE9PSAnZW1haWwnICYmIGNoYW5uZWwgIT09ICdzbXMnKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdjaGFubmVsIG11c3QgYmUgXCJlbWFpbFwiIG9yIFwic21zXCInIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSB0cmlnZ2VyIGlmIHByb3ZpZGVkXG4gICAgaWYgKHRyaWdnZXIpIHtcbiAgICAgIGNvbnN0IHZhbGlkVHJpZ2dlcnMgPSBbXG4gICAgICAgICdib29raW5nX2NyZWF0ZWQnLFxuICAgICAgICAnYm9va2luZ19jb25maXJtZWQnLFxuICAgICAgICAncmVtaW5kZXJfMjRoJyxcbiAgICAgICAgJ3JlbWluZGVyXzFoJyxcbiAgICAgICAgJ2Jvb2tpbmdfY2FuY2VsbGVkJyxcbiAgICAgICAgJ2Jvb2tpbmdfcmVzY2hlZHVsZWQnLFxuICAgICAgICAnYm9va2luZ19jb21wbGV0ZWQnLFxuICAgICAgICAnZmVlX2NoYXJnZWQnLFxuICAgICAgICAncmVmdW5kZWQnLFxuICAgICAgXTtcbiAgICAgIGlmICghdmFsaWRUcmlnZ2Vycy5pbmNsdWRlcyh0cmlnZ2VyKSkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogYEludmFsaWQgdHJpZ2dlci4gTXVzdCBiZSBvbmUgb2Y6ICR7dmFsaWRUcmlnZ2Vycy5qb2luKCcsICcpfWAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBwbGFjZWhvbGRlcnMgaWYgYm9keSBpcyBwcm92aWRlZFxuICAgIGlmIChib2R5VGV4dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCBwbGFjZWhvbGRlclZhbGlkYXRpb24gPSB2YWxpZGF0ZVBsYWNlaG9sZGVycyhib2R5VGV4dCk7XG4gICAgICBpZiAoIXBsYWNlaG9sZGVyVmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBcbiAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBwbGFjZWhvbGRlcnMgZm91bmQnLFxuICAgICAgICAgICAgaW52YWxpZF9wbGFjZWhvbGRlcnM6IHBsYWNlaG9sZGVyVmFsaWRhdGlvbi5pbnZhbGlkLFxuICAgICAgICAgICAgYWxsb3dlZF9wbGFjZWhvbGRlcnM6IEFMTE9XRURfUExBQ0VIT0xERVJTLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHN1YmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc3Qgc3ViamVjdFZhbGlkYXRpb24gPSB2YWxpZGF0ZVBsYWNlaG9sZGVycyhzdWJqZWN0IHx8ICcnKTtcbiAgICAgIGlmICghc3ViamVjdFZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgXG4gICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgcGxhY2Vob2xkZXJzIGluIHN1YmplY3QnLFxuICAgICAgICAgICAgaW52YWxpZF9wbGFjZWhvbGRlcnM6IHN1YmplY3RWYWxpZGF0aW9uLmludmFsaWQsXG4gICAgICAgICAgICBhbGxvd2VkX3BsYWNlaG9sZGVyczogQUxMT1dFRF9QTEFDRUhPTERFUlMsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBCdWlsZCB1cGRhdGUgb2JqZWN0XG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG5cbiAgICBpZiAobmFtZSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLm5hbWUgPSBuYW1lO1xuICAgIGlmIChjaGFubmVsICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuY2hhbm5lbCA9IGNoYW5uZWw7XG4gICAgaWYgKGNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICBpZiAodHJpZ2dlciAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIGlmIChzdWJqZWN0ICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuc3ViamVjdCA9IHN1YmplY3QgfHwgbnVsbDtcbiAgICBpZiAoYm9keVRleHQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5ib2R5X21hcmtkb3duID0gYm9keVRleHQ7XG4gICAgaWYgKGlzX2VuYWJsZWQgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5pc19lbmFibGVkID0gaXNfZW5hYmxlZDtcblxuICAgIC8vIEVuc3VyZSBlbWFpbCB0ZW1wbGF0ZXMgaGF2ZSBzdWJqZWN0XG4gICAgY29uc3QgZmluYWxDaGFubmVsID0gY2hhbm5lbCB8fCBleGlzdGluZy5jaGFubmVsO1xuICAgIGlmIChmaW5hbENoYW5uZWwgPT09ICdlbWFpbCcgJiYgIXN1YmplY3QgJiYgIWV4aXN0aW5nLnN1YmplY3QpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ3N1YmplY3QgaXMgcmVxdWlyZWQgZm9yIGVtYWlsIHRlbXBsYXRlcycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YTogdGVtcGxhdGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdub3RpZmljYXRpb25fdGVtcGxhdGVzJylcbiAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcbiAgICAgIC5lcSgnaWQnLCBwYXJhbXMuaWQpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ2J1c2luZXNzX2lkJywgYnVzaW5lc3NJZClcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyB0ZW1wbGF0ZTonLCB1cGRhdGVFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gdXBkYXRlIHRlbXBsYXRlJywgZGV0YWlsczogdXBkYXRlRXJyb3IubWVzc2FnZSB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHRlbXBsYXRlLFxuICAgICAgbWVzc2FnZTogJ1RlbXBsYXRlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBQVVQgdGVtcGxhdGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLCBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIERFTEVURSAvYXBpL2FkbWluL25vdGlmaWNhdGlvbnMvdGVtcGxhdGVzL1tpZF1cbiAqIFxuICogU29mdCBkZWxldGUgYSBub3RpZmljYXRpb24gdGVtcGxhdGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIERFTEVURShcbiAgcmVxdWVzdDogUmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZyB9IH1cbikge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IGF3YWl0IGdldEN1cnJlbnRVc2VySWQoKTtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYnVzaW5lc3NJZCA9IGF3YWl0IGdldEN1cnJlbnRCdXNpbmVzc0lkKCk7XG4gICAgaWYgKCFidXNpbmVzc0lkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdCdXNpbmVzcyBub3QgZm91bmQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZVNlcnZlckNsaWVudCgpO1xuXG4gICAgLy8gVmVyaWZ5IHRlbXBsYXRlIGV4aXN0c1xuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbl90ZW1wbGF0ZXMnKVxuICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgLmVxKCdpZCcsIHBhcmFtcy5pZClcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgIC5lcSgnYnVzaW5lc3NfaWQnLCBidXNpbmVzc0lkKVxuICAgICAgLmlzKCdkZWxldGVkX2F0JywgbnVsbClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFleGlzdGluZykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnVGVtcGxhdGUgbm90IGZvdW5kJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gU29mdCBkZWxldGVcbiAgICBjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdub3RpZmljYXRpb25fdGVtcGxhdGVzJylcbiAgICAgIC51cGRhdGUoe1xuICAgICAgICBkZWxldGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0pXG4gICAgICAuZXEoJ2lkJywgcGFyYW1zLmlkKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmVxKCdidXNpbmVzc19pZCcsIGJ1c2luZXNzSWQpO1xuXG4gICAgaWYgKGRlbGV0ZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyB0ZW1wbGF0ZTonLCBkZWxldGVFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gZGVsZXRlIHRlbXBsYXRlJywgZGV0YWlsczogZGVsZXRlRXJyb3IubWVzc2FnZSB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIG1lc3NhZ2U6ICdUZW1wbGF0ZSBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gREVMRVRFIHRlbXBsYXRlOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJywgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cblxuXG5cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJnZXRDdXJyZW50VXNlcklkIiwiZ2V0Q3VycmVudEJ1c2luZXNzSWQiLCJ2YWxpZGF0ZVBsYWNlaG9sZGVycyIsIkFMTE9XRURfUExBQ0VIT0xERVJTIiwiUFVUIiwicmVxdWVzdCIsInBhcmFtcyIsInVzZXJJZCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImJ1c2luZXNzSWQiLCJib2R5IiwibmFtZSIsImNoYW5uZWwiLCJjYXRlZ29yeSIsInRyaWdnZXIiLCJzdWJqZWN0IiwiYm9keVRleHQiLCJpc19lbmFibGVkIiwic3VwYWJhc2UiLCJkYXRhIiwiZXhpc3RpbmciLCJmZXRjaEVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJpcyIsInNpbmdsZSIsInZhbGlkVHJpZ2dlcnMiLCJpbmNsdWRlcyIsImpvaW4iLCJ1bmRlZmluZWQiLCJwbGFjZWhvbGRlclZhbGlkYXRpb24iLCJ2YWxpZCIsImludmFsaWRfcGxhY2Vob2xkZXJzIiwiaW52YWxpZCIsImFsbG93ZWRfcGxhY2Vob2xkZXJzIiwic3ViamVjdFZhbGlkYXRpb24iLCJ1cGRhdGVEYXRhIiwidXBkYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImJvZHlfbWFya2Rvd24iLCJmaW5hbENoYW5uZWwiLCJ0ZW1wbGF0ZSIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwiY29uc29sZSIsImRldGFpbHMiLCJtZXNzYWdlIiwiRXJyb3IiLCJERUxFVEUiLCJkZWxldGVFcnJvciIsImRlbGV0ZWRfYXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/admin/notifications/templates/[id]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentBusinessId: () => (/* binding */ getCurrentBusinessId),\n/* harmony export */   getCurrentUserId: () => (/* binding */ getCurrentUserId)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(rsc)/./src/lib/db.ts\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\n\n/**\n * Decode JWT payload without validation\n */ function decodeJWTPayload(token) {\n    try {\n        const parts = token.split(\".\");\n        if (parts.length !== 3) return null;\n        // Decode base64 payload (second part)\n        const payload = parts[1];\n        // Add padding if needed\n        const paddedPayload = payload + \"=\".repeat((4 - payload.length % 4) % 4);\n        const decoded = Buffer.from(paddedPayload, \"base64\").toString(\"utf-8\");\n        return JSON.parse(decoded);\n    } catch (error) {\n        console.error(\"Error decoding JWT:\", error);\n        return null;\n    }\n}\n/**\n * Extract raw JWT token from Supabase session cookies (without decoding)\n */ async function getRawTokenFromCookies() {\n    try {\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n        const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n        if (!supabaseUrl) {\n            return null;\n        }\n        // Get all cookies for debugging\n        const allCookies = cookieStore.getAll();\n        const authCookies = allCookies.filter((c)=>c.name.includes(\"auth\") || c.name.includes(\"sb-\") || c.name.includes(\"supabase\"));\n        // Supabase stores session in cookies with pattern: sb-{project-ref}-auth-token\n        // Extract project ref from URL\n        const url = new URL(supabaseUrl);\n        const projectRef = url.hostname.split(\".\")[0];\n        // Try different cookie name patterns\n        const cookieNames = [\n            `sb-api-auth-token`,\n            `sb-${projectRef}-auth-token`,\n            `sb-${projectRef.replace(/-/g, \"\")}-auth-token`,\n            `sb-${projectRef}-auth-token-code-verifier`\n        ];\n        for (const cookieName of cookieNames){\n            const cookie = cookieStore.get(cookieName);\n            if (cookie?.value) {\n                try {\n                    // Try URL decoding first\n                    let decodedValue = cookie.value;\n                    try {\n                        decodedValue = decodeURIComponent(cookie.value);\n                    } catch  {\n                    // Not URL encoded, use as-is\n                    }\n                    // Try parsing as JSON\n                    try {\n                        const sessionData = JSON.parse(decodedValue);\n                        // Check if it's an array (Supabase sometimes stores tokens as array)\n                        if (Array.isArray(sessionData) && sessionData.length > 0) {\n                            // Get first element which should be the JWT token\n                            const firstElement = sessionData[0];\n                            if (typeof firstElement === \"string\") {\n                                let cleanToken = firstElement.trim();\n                                // Remove surrounding quotes if present\n                                if (cleanToken.startsWith('\"') && cleanToken.endsWith('\"') || cleanToken.startsWith(\"'\") && cleanToken.endsWith(\"'\")) {\n                                    cleanToken = cleanToken.slice(1, -1);\n                                }\n                                // Check if it looks like a JWT (has 3 parts separated by dots)\n                                const parts = cleanToken.split(\".\");\n                                if (parts.length === 3 && cleanToken.length > 100) {\n                                    return cleanToken; // Return raw token, don't decode\n                                }\n                            }\n                        }\n                        // If it's an object with access_token\n                        if (sessionData?.access_token) {\n                            return sessionData.access_token;\n                        }\n                        if (sessionData?.session?.access_token) {\n                            return sessionData.session.access_token;\n                        }\n                    } catch (parseError) {\n                        // Not JSON, might be direct JWT token\n                        if (decodedValue.length > 100 && decodedValue.includes(\".\")) {\n                            return decodedValue;\n                        }\n                    }\n                } catch (error) {\n                    console.error(`Error processing cookie ${cookieName}:`, error);\n                }\n            }\n        }\n        return null;\n    } catch (error) {\n        console.error(\"Error extracting token from cookies:\", error);\n        return null;\n    }\n}\n/**\n * Extract access token from Supabase session cookies\n * Returns user ID if JWT is decoded, or token if not\n */ async function getAccessTokenFromCookies() {\n    try {\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n        const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n        if (!supabaseUrl) {\n            return null;\n        }\n        // Get all cookies for debugging\n        const allCookies = cookieStore.getAll();\n        const authCookies = allCookies.filter((c)=>c.name.includes(\"auth\") || c.name.includes(\"sb-\") || c.name.includes(\"supabase\"));\n        console.log(\"Found auth-related cookies:\", authCookies.map((c)=>c.name));\n        // Supabase stores session in cookies with pattern: sb-{project-ref}-auth-token\n        // Extract project ref from URL\n        const url = new URL(supabaseUrl);\n        const projectRef = url.hostname.split(\".\")[0];\n        // Try different cookie name patterns\n        const cookieNames = [\n            `sb-api-auth-token`,\n            `sb-${projectRef}-auth-token`,\n            `sb-${projectRef.replace(/-/g, \"\")}-auth-token`,\n            `sb-${projectRef}-auth-token-code-verifier`\n        ];\n        for (const cookieName of cookieNames){\n            const cookie = cookieStore.get(cookieName);\n            if (cookie?.value) {\n                // Log first 100 chars to see format (without exposing full token)\n                const preview = cookie.value.substring(0, 100);\n                console.log(`Checking cookie: ${cookieName}, length: ${cookie.value.length}, preview: ${preview}...`);\n                try {\n                    // Try to parse as JSON (Supabase stores session as JSON string)\n                    let sessionData;\n                    let decodedValue = cookie.value;\n                    // Try URL decoding first\n                    try {\n                        decodedValue = decodeURIComponent(cookie.value);\n                    } catch  {\n                    // Not URL encoded, use as-is\n                    }\n                    // Try parsing as JSON\n                    try {\n                        sessionData = JSON.parse(decodedValue);\n                        console.log(`Parsed ${cookieName} as JSON, type:`, Array.isArray(sessionData) ? \"array\" : typeof sessionData, \"keys:\", Object.keys(sessionData || {}));\n                        // Check if it's an array (Supabase sometimes stores tokens as array)\n                        if (Array.isArray(sessionData) && sessionData.length > 0) {\n                            console.log(`Array has ${sessionData.length} elements, checking each...`);\n                            // Try each element to find a valid JWT\n                            for(let i = 0; i < sessionData.length; i++){\n                                const element = sessionData[i];\n                                console.log(`Element ${i} type: ${typeof element}, length: ${typeof element === \"string\" ? element.length : \"N/A\"}`);\n                                if (typeof element === \"string\") {\n                                    // Remove any quotes or extra characters\n                                    let cleanToken = element.trim();\n                                    // Remove surrounding quotes if present\n                                    if (cleanToken.startsWith('\"') && cleanToken.endsWith('\"') || cleanToken.startsWith(\"'\") && cleanToken.endsWith(\"'\")) {\n                                        cleanToken = cleanToken.slice(1, -1);\n                                    }\n                                    // Check if it looks like a JWT (has 3 parts separated by dots)\n                                    const parts = cleanToken.split(\".\");\n                                    if (parts.length === 3 && cleanToken.length > 100) {\n                                        console.log(`Found valid JWT structure in element ${i}, length: ${cleanToken.length}`);\n                                        // Try to decode the JWT to get user ID directly (without validation)\n                                        const payload = decodeJWTPayload(cleanToken);\n                                        if (payload && (payload.sub || payload.user_id)) {\n                                            const userId = payload.sub || payload.user_id;\n                                            console.log(`Extracted user ID from JWT: ${userId}`);\n                                            return userId; // Return user ID directly instead of token\n                                        }\n                                        // If decoding fails, try using the token\n                                        console.log(`Token preview: ${cleanToken.substring(0, 50)}...`);\n                                        return cleanToken;\n                                    }\n                                }\n                                // If element is an object, check for access_token\n                                if (element && typeof element === \"object\" && element.access_token) {\n                                    console.log(`Found access_token in element ${i}:`, cookieName);\n                                    return element.access_token;\n                                }\n                            }\n                            // If no single element works, try joining all string elements\n                            const allStrings = sessionData.filter((e)=>typeof e === \"string\");\n                            if (allStrings.length > 0) {\n                                const joined = allStrings.join(\"\");\n                                const parts = joined.split(\".\");\n                                if (parts.length === 3 && joined.length > 100) {\n                                    console.log(\"Found JWT by joining array elements\");\n                                    return joined;\n                                }\n                            }\n                        }\n                        if (sessionData?.access_token) {\n                            console.log(\"Found access token in cookie:\", cookieName);\n                            return sessionData.access_token;\n                        }\n                        // Check for nested session object\n                        if (sessionData?.session?.access_token) {\n                            console.log(\"Found access token in nested session:\", cookieName);\n                            return sessionData.session.access_token;\n                        }\n                    } catch (parseError) {\n                        // Not JSON, might be direct token or different format\n                        console.log(`Cookie ${cookieName} is not JSON, checking if it's a JWT`);\n                        // Check if it looks like a JWT (has dots and is long enough)\n                        if (decodedValue.length > 100 && decodedValue.includes(\".\")) {\n                            // Likely a JWT token\n                            console.log(\"Found JWT token in cookie:\", cookieName);\n                            return decodedValue;\n                        }\n                    }\n                } catch (error) {\n                    console.error(`Error processing cookie ${cookieName}:`, error);\n                }\n            }\n        }\n        // Try to find any cookie that looks like an auth token\n        for (const cookie of authCookies){\n            if (cookie.name.includes(\"auth-token\") || cookie.name.includes(\"auth_token\")) {\n                try {\n                    let sessionData;\n                    try {\n                        sessionData = JSON.parse(decodeURIComponent(cookie.value));\n                    } catch  {\n                        sessionData = JSON.parse(cookie.value);\n                    }\n                    if (sessionData?.access_token) {\n                        console.log(\"Found access token in auth cookie:\", cookie.name);\n                        return sessionData.access_token;\n                    }\n                } catch  {\n                    // Not JSON, might be direct token\n                    if (cookie.value.length > 100 && cookie.value.includes(\".\")) {\n                        // Looks like a JWT\n                        console.log(\"Found JWT in auth cookie:\", cookie.name);\n                        return cookie.value;\n                    }\n                }\n            }\n        }\n        console.log(\"No access token found in cookies\");\n        return null;\n    } catch (error) {\n        console.error(\"Error extracting token from cookies:\", error);\n        return null;\n    }\n}\n/**\n * Get the current authenticated user from the request\n * \n * Returns the user ID from Supabase Auth JWT, or null if not authenticated.\n * Use this in API routes to get the current user.\n * \n * Usage:\n * ```ts\n * const userId = await getCurrentUserId();\n * if (!userId) {\n *   return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n * }\n * ```\n */ async function getCurrentUserId() {\n    try {\n        const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n        const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnd29vcWFrZHZyY2hmd3Jkbnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTQyNDEsImV4cCI6MjA3ODk3MDI0MX0.YpX0dYf_iueJVR1oK5SvREnO765JAKxriy2csdAEZlI\";\n        if (!supabaseUrl || !supabaseAnonKey) {\n            console.error(\"Missing Supabase environment variables\");\n            return null;\n        }\n        // First try to get token from Authorization header\n        try {\n            const headersList = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.headers)();\n            const authHeader = headersList.get(\"authorization\");\n            if (authHeader?.startsWith(\"Bearer \")) {\n                const token = authHeader.substring(7);\n                const client = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseAnonKey, {\n                    global: {\n                        headers: {\n                            Authorization: `Bearer ${token}`\n                        }\n                    }\n                });\n                const { data: { user }, error } = await client.auth.getUser();\n                if (!error && user) {\n                    return user.id;\n                }\n            }\n        } catch (error) {\n            console.error(\"Error with Authorization header:\", error);\n        // Continue to cookie-based auth\n        }\n        // Try to extract access token or user ID from cookies\n        const tokenOrUserId = await getAccessTokenFromCookies();\n        if (tokenOrUserId) {\n            // If it's already a user ID (from JWT decode), return it\n            if (tokenOrUserId.length < 50 && tokenOrUserId.includes(\"-\")) {\n                // Looks like a UUID (user ID)\n                console.log(\"Using extracted user ID directly:\", tokenOrUserId);\n                return tokenOrUserId;\n            }\n            // Otherwise, try using it as a token\n            try {\n                const client = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseAnonKey, {\n                    global: {\n                        headers: {\n                            Authorization: `Bearer ${tokenOrUserId}`\n                        }\n                    }\n                });\n                const { data: { user }, error } = await client.auth.getUser();\n                if (!error && user) {\n                    return user.id;\n                } else {\n                    console.error(\"Error with cookie token:\", error);\n                    // If token validation fails, try decoding JWT directly\n                    const payload = decodeJWTPayload(tokenOrUserId);\n                    if (payload && (payload.sub || payload.user_id)) {\n                        console.log(\"Extracted user ID from JWT after validation failed:\", payload.sub || payload.user_id);\n                        return payload.sub || payload.user_id;\n                    }\n                }\n            } catch (error) {\n                console.error(\"Error with cookie token:\", error);\n                // Try decoding JWT as fallback\n                const payload = decodeJWTPayload(tokenOrUserId);\n                if (payload && (payload.sub || payload.user_id)) {\n                    console.log(\"Extracted user ID from JWT as fallback:\", payload.sub || payload.user_id);\n                    return payload.sub || payload.user_id;\n                }\n            }\n        }\n        // Fallback: Try cookie-based auth with createServerClient\n        // This might work if cookies are set up correctly\n        try {\n            const supabase = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n            const { data: { user }, error } = await supabase.auth.getUser();\n            if (!error && user) {\n                return user.id;\n            }\n            if (error) {\n                console.error(\"Auth error from createServerClient:\", error);\n            }\n        } catch (error) {\n            console.error(\"Error with createServerClient:\", error);\n        }\n        return null;\n    } catch (error) {\n        console.error(\"Error getting current user:\", error);\n        return null;\n    }\n}\n/**\n * Create an authenticated Supabase client with a specific access token\n */ async function createAuthenticatedClient(accessToken) {\n    const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnd29vcWFrZHZyY2hmd3Jkbnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTQyNDEsImV4cCI6MjA3ODk3MDI0MX0.YpX0dYf_iueJVR1oK5SvREnO765JAKxriy2csdAEZlI\";\n    if (!supabaseUrl || !supabaseAnonKey) {\n        throw new Error(\"Missing Supabase environment variables\");\n    }\n    const { createClient } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/module/index.js\"));\n    return createClient(supabaseUrl, supabaseAnonKey, {\n        global: {\n            headers: {\n                Authorization: `Bearer ${accessToken}`\n            }\n        },\n        auth: {\n            persistSession: false,\n            autoRefreshToken: false\n        }\n    });\n}\n/**\n * Get the current user's business ID\n * \n * Returns the business ID for the authenticated user, or null if not found.\n * \n * Usage:\n * ```ts\n * const businessId = await getCurrentBusinessId();\n * if (!businessId) {\n *   return NextResponse.json({ error: 'Business not found' }, { status: 404 });\n * }\n * ```\n */ async function getCurrentBusinessId() {\n    try {\n        const userId = await getCurrentUserId();\n        if (!userId) {\n            console.error(\"[getCurrentBusinessId] No user ID found\");\n            return null;\n        }\n        console.log(\"[getCurrentBusinessId] Looking for business for user:\", userId);\n        // Log Supabase project info for debugging\n        const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n        if (supabaseUrl) {\n            try {\n                const url = new URL(supabaseUrl);\n                const projectRef = url.hostname.split(\".\")[0];\n                console.log(\"[getCurrentBusinessId] Using Supabase project:\", projectRef);\n            } catch  {\n                console.log(\"[getCurrentBusinessId] Supabase URL:\", supabaseUrl);\n            }\n        }\n        // Use createServerClient which should handle cookies properly\n        // If that fails due to RLS, we'll use service role as fallback\n        const supabase = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n        // Query for business\n        const { data, error } = await supabase.from(\"businesses\").select(\"id, name\").eq(\"user_id\", userId).is(\"deleted_at\", null).maybeSingle(); // Use maybeSingle() instead of single() to avoid error if not found\n        if (error) {\n            console.error(\"[getCurrentBusinessId] Error querying business:\", error);\n            // If RLS error, try with service role (we already verified user is authenticated)\n            if (error.code === \"PGRST301\" || error.message?.includes(\"No suitable key\")) {\n                console.log(\"[getCurrentBusinessId] RLS error, trying with service role for user:\", userId);\n                const { createAdminClient } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @/lib/db */ \"(rsc)/./src/lib/db.ts\"));\n                const adminSupabase = createAdminClient();\n                // First check if ANY businesses exist for this user (including deleted)\n                const { data: allBusinesses, error: allError } = await adminSupabase.from(\"businesses\").select(\"id, name, deleted_at, user_id\").eq(\"user_id\", userId);\n                console.log(\"[getCurrentBusinessId] All businesses for user (admin):\", allBusinesses?.length || 0);\n                if (allBusinesses && allBusinesses.length > 0) {\n                    console.log(\"[getCurrentBusinessId] Businesses found:\", allBusinesses.map((b)=>({\n                            id: b.id,\n                            name: b.name,\n                            deleted: !!b.deleted_at,\n                            user_id: b.user_id\n                        })));\n                }\n                if (allError) {\n                    console.error(\"[getCurrentBusinessId] Error checking all businesses:\", allError);\n                }\n                // Diagnostic: Check if there are ANY businesses at all (to detect user ID mismatch)\n                const { data: anyBusinesses, error: anyError } = await adminSupabase.from(\"businesses\").select(\"id, name, user_id, deleted_at\").limit(10);\n                if (!anyError && anyBusinesses && anyBusinesses.length > 0) {\n                    console.log(\"[getCurrentBusinessId] DIAGNOSTIC: Found businesses in database:\", anyBusinesses.map((b)=>({\n                            id: b.id,\n                            name: b.name,\n                            user_id: b.user_id,\n                            matches_current_user: b.user_id === userId,\n                            deleted: !!b.deleted_at\n                        })));\n                } else if (!anyError) {\n                    console.log(\"[getCurrentBusinessId] DIAGNOSTIC: No businesses exist in database at all\");\n                } else {\n                    console.error(\"[getCurrentBusinessId] DIAGNOSTIC: Error checking all businesses:\", anyError);\n                }\n                // Now get the non-deleted one\n                const { data: adminData, error: adminError } = await adminSupabase.from(\"businesses\").select(\"id, name\").eq(\"user_id\", userId).is(\"deleted_at\", null).maybeSingle();\n                if (adminError) {\n                    console.error(\"[getCurrentBusinessId] Error with admin client:\", adminError);\n                    return null;\n                }\n                if (adminData) {\n                    console.log(\"[getCurrentBusinessId] Found business with admin client:\", adminData.id, adminData.name);\n                    return adminData.id;\n                } else {\n                    console.error(\"[getCurrentBusinessId] No business found with admin client for user:\", userId);\n                    return null;\n                }\n            }\n            return null;\n        }\n        if (!data) {\n            console.error(\"[getCurrentBusinessId] No business found for user:\", userId);\n            return null;\n        }\n        console.log(\"[getCurrentBusinessId] Found business:\", data.id, data.name);\n        return data.id;\n    } catch (error) {\n        console.error(\"[getCurrentBusinessId] Error getting current business:\", error);\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VTt3QkFDekI7Z0JBQ0YsT0FBTyxJQUFJLENBQUNFLFVBQVU7b0JBQ3BCekYsUUFBUXVDLEdBQUcsQ0FBQztnQkFDZCxPQUFPO29CQUNMdkMsUUFBUUQsS0FBSyxDQUFDLHFFQUFxRTBGO2dCQUNyRjtnQkFFQSw4QkFBOEI7Z0JBQzlCLE1BQU0sRUFBRTNCLE1BQU04QixTQUFTLEVBQUU3RixPQUFPOEYsVUFBVSxFQUFFLEdBQUcsTUFBTVgsY0FDbER2RixJQUFJLENBQUMsY0FDTGdGLE1BQU0sQ0FBQyxZQUNQQyxFQUFFLENBQUMsV0FBVzNCLFFBQ2Q0QixFQUFFLENBQUMsY0FBYyxNQUNqQkMsV0FBVztnQkFFZCxJQUFJZSxZQUFZO29CQUNkN0YsUUFBUUQsS0FBSyxDQUFDLG1EQUFtRDhGO29CQUNqRSxPQUFPO2dCQUNUO2dCQUVBLElBQUlELFdBQVc7b0JBQ2I1RixRQUFRdUMsR0FBRyxDQUFDLDREQUE0RHFELFVBQVUxQixFQUFFLEVBQUUwQixVQUFVaEYsSUFBSTtvQkFDcEcsT0FBT2dGLFVBQVUxQixFQUFFO2dCQUNyQixPQUFPO29CQUNMbEUsUUFBUUQsS0FBSyxDQUFDLHdFQUF3RWtEO29CQUN0RixPQUFPO2dCQUNUO1lBQ0Y7WUFFQSxPQUFPO1FBQ1Q7UUFFQSxJQUFJLENBQUNhLE1BQU07WUFDVDlELFFBQVFELEtBQUssQ0FBQyxzREFBc0RrRDtZQUNwRSxPQUFPO1FBQ1Q7UUFFQWpELFFBQVF1QyxHQUFHLENBQUMsMENBQTBDdUIsS0FBS0ksRUFBRSxFQUFFSixLQUFLbEQsSUFBSTtRQUN4RSxPQUFPa0QsS0FBS0ksRUFBRTtJQUNoQixFQUFFLE9BQU9uRSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywwREFBMERBO1FBQ3hFLE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4vc3JjL2xpYi9hdXRoLnRzPzY2OTIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSAnLi9kYic7XG5pbXBvcnQgeyBoZWFkZXJzLCBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbi8qKlxuICogRGVjb2RlIEpXVCBwYXlsb2FkIHdpdGhvdXQgdmFsaWRhdGlvblxuICovXG5mdW5jdGlvbiBkZWNvZGVKV1RQYXlsb2FkKHRva2VuOiBzdHJpbmcpOiBhbnkgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCcuJyk7XG4gICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMykgcmV0dXJuIG51bGw7XG4gICAgXG4gICAgLy8gRGVjb2RlIGJhc2U2NCBwYXlsb2FkIChzZWNvbmQgcGFydClcbiAgICBjb25zdCBwYXlsb2FkID0gcGFydHNbMV07XG4gICAgLy8gQWRkIHBhZGRpbmcgaWYgbmVlZGVkXG4gICAgY29uc3QgcGFkZGVkUGF5bG9hZCA9IHBheWxvYWQgKyAnPScucmVwZWF0KCg0IC0gcGF5bG9hZC5sZW5ndGggJSA0KSAlIDQpO1xuICAgIGNvbnN0IGRlY29kZWQgPSBCdWZmZXIuZnJvbShwYWRkZWRQYXlsb2FkLCAnYmFzZTY0JykudG9TdHJpbmcoJ3V0Zi04Jyk7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoZGVjb2RlZCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVjb2RpbmcgSldUOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIEV4dHJhY3QgcmF3IEpXVCB0b2tlbiBmcm9tIFN1cGFiYXNlIHNlc3Npb24gY29va2llcyAod2l0aG91dCBkZWNvZGluZylcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0UmF3VG9rZW5Gcm9tQ29va2llcygpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcbiAgICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgICBcbiAgICBpZiAoIXN1cGFiYXNlVXJsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBHZXQgYWxsIGNvb2tpZXMgZm9yIGRlYnVnZ2luZ1xuICAgIGNvbnN0IGFsbENvb2tpZXMgPSBjb29raWVTdG9yZS5nZXRBbGwoKTtcbiAgICBjb25zdCBhdXRoQ29va2llcyA9IGFsbENvb2tpZXMuZmlsdGVyKGMgPT4gXG4gICAgICBjLm5hbWUuaW5jbHVkZXMoJ2F1dGgnKSB8fCBcbiAgICAgIGMubmFtZS5pbmNsdWRlcygnc2ItJykgfHxcbiAgICAgIGMubmFtZS5pbmNsdWRlcygnc3VwYWJhc2UnKVxuICAgICk7XG4gICAgXG4gICAgLy8gU3VwYWJhc2Ugc3RvcmVzIHNlc3Npb24gaW4gY29va2llcyB3aXRoIHBhdHRlcm46IHNiLXtwcm9qZWN0LXJlZn0tYXV0aC10b2tlblxuICAgIC8vIEV4dHJhY3QgcHJvamVjdCByZWYgZnJvbSBVUkxcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHN1cGFiYXNlVXJsKTtcbiAgICBjb25zdCBwcm9qZWN0UmVmID0gdXJsLmhvc3RuYW1lLnNwbGl0KCcuJylbMF07XG4gICAgXG4gICAgLy8gVHJ5IGRpZmZlcmVudCBjb29raWUgbmFtZSBwYXR0ZXJuc1xuICAgIGNvbnN0IGNvb2tpZU5hbWVzID0gW1xuICAgICAgYHNiLWFwaS1hdXRoLXRva2VuYCwgLy8gVHJ5IHRoaXMgZmlyc3QgYXMgaXQncyBtb3N0IGNvbW1vblxuICAgICAgYHNiLSR7cHJvamVjdFJlZn0tYXV0aC10b2tlbmAsXG4gICAgICBgc2ItJHtwcm9qZWN0UmVmLnJlcGxhY2UoLy0vZywgJycpfS1hdXRoLXRva2VuYCxcbiAgICAgIGBzYi0ke3Byb2plY3RSZWZ9LWF1dGgtdG9rZW4tY29kZS12ZXJpZmllcmAsIC8vIFNvbWV0aW1lcyBzdG9yZWQgc2VwYXJhdGVseVxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IGNvb2tpZU5hbWUgb2YgY29va2llTmFtZXMpIHtcbiAgICAgIGNvbnN0IGNvb2tpZSA9IGNvb2tpZVN0b3JlLmdldChjb29raWVOYW1lKTtcbiAgICAgIGlmIChjb29raWU/LnZhbHVlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gVHJ5IFVSTCBkZWNvZGluZyBmaXJzdFxuICAgICAgICAgIGxldCBkZWNvZGVkVmFsdWUgPSBjb29raWUudmFsdWU7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGRlY29kZWRWYWx1ZSA9IGRlY29kZVVSSUNvbXBvbmVudChjb29raWUudmFsdWUpO1xuICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgLy8gTm90IFVSTCBlbmNvZGVkLCB1c2UgYXMtaXNcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVHJ5IHBhcnNpbmcgYXMgSlNPTlxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzZXNzaW9uRGF0YSA9IEpTT04ucGFyc2UoZGVjb2RlZFZhbHVlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbiBhcnJheSAoU3VwYWJhc2Ugc29tZXRpbWVzIHN0b3JlcyB0b2tlbnMgYXMgYXJyYXkpXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzZXNzaW9uRGF0YSkgJiYgc2Vzc2lvbkRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAvLyBHZXQgZmlyc3QgZWxlbWVudCB3aGljaCBzaG91bGQgYmUgdGhlIEpXVCB0b2tlblxuICAgICAgICAgICAgICBjb25zdCBmaXJzdEVsZW1lbnQgPSBzZXNzaW9uRGF0YVswXTtcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmaXJzdEVsZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgbGV0IGNsZWFuVG9rZW4gPSBmaXJzdEVsZW1lbnQudHJpbSgpO1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBzdXJyb3VuZGluZyBxdW90ZXMgaWYgcHJlc2VudFxuICAgICAgICAgICAgICAgIGlmICgoY2xlYW5Ub2tlbi5zdGFydHNXaXRoKCdcIicpICYmIGNsZWFuVG9rZW4uZW5kc1dpdGgoJ1wiJykpIHx8IFxuICAgICAgICAgICAgICAgICAgICAoY2xlYW5Ub2tlbi5zdGFydHNXaXRoKFwiJ1wiKSAmJiBjbGVhblRva2VuLmVuZHNXaXRoKFwiJ1wiKSkpIHtcbiAgICAgICAgICAgICAgICAgIGNsZWFuVG9rZW4gPSBjbGVhblRva2VuLnNsaWNlKDEsIC0xKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQgbG9va3MgbGlrZSBhIEpXVCAoaGFzIDMgcGFydHMgc2VwYXJhdGVkIGJ5IGRvdHMpXG4gICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBjbGVhblRva2VuLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMyAmJiBjbGVhblRva2VuLmxlbmd0aCA+IDEwMCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNsZWFuVG9rZW47IC8vIFJldHVybiByYXcgdG9rZW4sIGRvbid0IGRlY29kZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJZiBpdCdzIGFuIG9iamVjdCB3aXRoIGFjY2Vzc190b2tlblxuICAgICAgICAgICAgaWYgKHNlc3Npb25EYXRhPy5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25EYXRhLmFjY2Vzc190b2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHNlc3Npb25EYXRhPy5zZXNzaW9uPy5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25EYXRhLnNlc3Npb24uYWNjZXNzX3Rva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgICAgIC8vIE5vdCBKU09OLCBtaWdodCBiZSBkaXJlY3QgSldUIHRva2VuXG4gICAgICAgICAgICBpZiAoZGVjb2RlZFZhbHVlLmxlbmd0aCA+IDEwMCAmJiBkZWNvZGVkVmFsdWUuaW5jbHVkZXMoJy4nKSkge1xuICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlZFZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBwcm9jZXNzaW5nIGNvb2tpZSAke2Nvb2tpZU5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV4dHJhY3RpbmcgdG9rZW4gZnJvbSBjb29raWVzOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIEV4dHJhY3QgYWNjZXNzIHRva2VuIGZyb20gU3VwYWJhc2Ugc2Vzc2lvbiBjb29raWVzXG4gKiBSZXR1cm5zIHVzZXIgSUQgaWYgSldUIGlzIGRlY29kZWQsIG9yIHRva2VuIGlmIG5vdFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRBY2Nlc3NUb2tlbkZyb21Db29raWVzKCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuICAgIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuICAgIFxuICAgIGlmICghc3VwYWJhc2VVcmwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIEdldCBhbGwgY29va2llcyBmb3IgZGVidWdnaW5nXG4gICAgY29uc3QgYWxsQ29va2llcyA9IGNvb2tpZVN0b3JlLmdldEFsbCgpO1xuICAgIGNvbnN0IGF1dGhDb29raWVzID0gYWxsQ29va2llcy5maWx0ZXIoYyA9PiBcbiAgICAgIGMubmFtZS5pbmNsdWRlcygnYXV0aCcpIHx8IFxuICAgICAgYy5uYW1lLmluY2x1ZGVzKCdzYi0nKSB8fFxuICAgICAgYy5uYW1lLmluY2x1ZGVzKCdzdXBhYmFzZScpXG4gICAgKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnRm91bmQgYXV0aC1yZWxhdGVkIGNvb2tpZXM6JywgYXV0aENvb2tpZXMubWFwKGMgPT4gYy5uYW1lKSk7XG5cbiAgICAvLyBTdXBhYmFzZSBzdG9yZXMgc2Vzc2lvbiBpbiBjb29raWVzIHdpdGggcGF0dGVybjogc2Ite3Byb2plY3QtcmVmfS1hdXRoLXRva2VuXG4gICAgLy8gRXh0cmFjdCBwcm9qZWN0IHJlZiBmcm9tIFVSTFxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoc3VwYWJhc2VVcmwpO1xuICAgIGNvbnN0IHByb2plY3RSZWYgPSB1cmwuaG9zdG5hbWUuc3BsaXQoJy4nKVswXTtcbiAgICBcbiAgICAvLyBUcnkgZGlmZmVyZW50IGNvb2tpZSBuYW1lIHBhdHRlcm5zXG4gICAgY29uc3QgY29va2llTmFtZXMgPSBbXG4gICAgICBgc2ItYXBpLWF1dGgtdG9rZW5gLCAvLyBUcnkgdGhpcyBmaXJzdCBhcyBpdCdzIG1vc3QgY29tbW9uXG4gICAgICBgc2ItJHtwcm9qZWN0UmVmfS1hdXRoLXRva2VuYCxcbiAgICAgIGBzYi0ke3Byb2plY3RSZWYucmVwbGFjZSgvLS9nLCAnJyl9LWF1dGgtdG9rZW5gLFxuICAgICAgYHNiLSR7cHJvamVjdFJlZn0tYXV0aC10b2tlbi1jb2RlLXZlcmlmaWVyYCwgLy8gU29tZXRpbWVzIHN0b3JlZCBzZXBhcmF0ZWx5XG4gICAgXTtcblxuICAgIGZvciAoY29uc3QgY29va2llTmFtZSBvZiBjb29raWVOYW1lcykge1xuICAgICAgY29uc3QgY29va2llID0gY29va2llU3RvcmUuZ2V0KGNvb2tpZU5hbWUpO1xuICAgICAgaWYgKGNvb2tpZT8udmFsdWUpIHtcbiAgICAgICAgLy8gTG9nIGZpcnN0IDEwMCBjaGFycyB0byBzZWUgZm9ybWF0ICh3aXRob3V0IGV4cG9zaW5nIGZ1bGwgdG9rZW4pXG4gICAgICAgIGNvbnN0IHByZXZpZXcgPSBjb29raWUudmFsdWUuc3Vic3RyaW5nKDAsIDEwMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBDaGVja2luZyBjb29raWU6ICR7Y29va2llTmFtZX0sIGxlbmd0aDogJHtjb29raWUudmFsdWUubGVuZ3RofSwgcHJldmlldzogJHtwcmV2aWV3fS4uLmApO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgYXMgSlNPTiAoU3VwYWJhc2Ugc3RvcmVzIHNlc3Npb24gYXMgSlNPTiBzdHJpbmcpXG4gICAgICAgICAgbGV0IHNlc3Npb25EYXRhOiBhbnk7XG4gICAgICAgICAgbGV0IGRlY29kZWRWYWx1ZSA9IGNvb2tpZS52YWx1ZTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBUcnkgVVJMIGRlY29kaW5nIGZpcnN0XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGRlY29kZWRWYWx1ZSA9IGRlY29kZVVSSUNvbXBvbmVudChjb29raWUudmFsdWUpO1xuICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgLy8gTm90IFVSTCBlbmNvZGVkLCB1c2UgYXMtaXNcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVHJ5IHBhcnNpbmcgYXMgSlNPTlxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZXNzaW9uRGF0YSA9IEpTT04ucGFyc2UoZGVjb2RlZFZhbHVlKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBQYXJzZWQgJHtjb29raWVOYW1lfSBhcyBKU09OLCB0eXBlOmAsIEFycmF5LmlzQXJyYXkoc2Vzc2lvbkRhdGEpID8gJ2FycmF5JyA6IHR5cGVvZiBzZXNzaW9uRGF0YSwgJ2tleXM6JywgT2JqZWN0LmtleXMoc2Vzc2lvbkRhdGEgfHwge30pKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbiBhcnJheSAoU3VwYWJhc2Ugc29tZXRpbWVzIHN0b3JlcyB0b2tlbnMgYXMgYXJyYXkpXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzZXNzaW9uRGF0YSkgJiYgc2Vzc2lvbkRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgQXJyYXkgaGFzICR7c2Vzc2lvbkRhdGEubGVuZ3RofSBlbGVtZW50cywgY2hlY2tpbmcgZWFjaC4uLmApO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gVHJ5IGVhY2ggZWxlbWVudCB0byBmaW5kIGEgdmFsaWQgSldUXG4gICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2Vzc2lvbkRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc2Vzc2lvbkRhdGFbaV07XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEVsZW1lbnQgJHtpfSB0eXBlOiAke3R5cGVvZiBlbGVtZW50fSwgbGVuZ3RoOiAke3R5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJyA/IGVsZW1lbnQubGVuZ3RoIDogJ04vQSd9YCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGFueSBxdW90ZXMgb3IgZXh0cmEgY2hhcmFjdGVyc1xuICAgICAgICAgICAgICAgICAgbGV0IGNsZWFuVG9rZW4gPSBlbGVtZW50LnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBzdXJyb3VuZGluZyBxdW90ZXMgaWYgcHJlc2VudFxuICAgICAgICAgICAgICAgICAgaWYgKChjbGVhblRva2VuLnN0YXJ0c1dpdGgoJ1wiJykgJiYgY2xlYW5Ub2tlbi5lbmRzV2l0aCgnXCInKSkgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgKGNsZWFuVG9rZW4uc3RhcnRzV2l0aChcIidcIikgJiYgY2xlYW5Ub2tlbi5lbmRzV2l0aChcIidcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFuVG9rZW4gPSBjbGVhblRva2VuLnNsaWNlKDEsIC0xKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQgbG9va3MgbGlrZSBhIEpXVCAoaGFzIDMgcGFydHMgc2VwYXJhdGVkIGJ5IGRvdHMpXG4gICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGNsZWFuVG9rZW4uc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMgJiYgY2xlYW5Ub2tlbi5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEZvdW5kIHZhbGlkIEpXVCBzdHJ1Y3R1cmUgaW4gZWxlbWVudCAke2l9LCBsZW5ndGg6ICR7Y2xlYW5Ub2tlbi5sZW5ndGh9YCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gZGVjb2RlIHRoZSBKV1QgdG8gZ2V0IHVzZXIgSUQgZGlyZWN0bHkgKHdpdGhvdXQgdmFsaWRhdGlvbilcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IGRlY29kZUpXVFBheWxvYWQoY2xlYW5Ub2tlbik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkICYmIChwYXlsb2FkLnN1YiB8fCBwYXlsb2FkLnVzZXJfaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlcklkID0gcGF5bG9hZC5zdWIgfHwgcGF5bG9hZC51c2VyX2lkO1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFeHRyYWN0ZWQgdXNlciBJRCBmcm9tIEpXVDogJHt1c2VySWR9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJJZDsgLy8gUmV0dXJuIHVzZXIgSUQgZGlyZWN0bHkgaW5zdGVhZCBvZiB0b2tlblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBJZiBkZWNvZGluZyBmYWlscywgdHJ5IHVzaW5nIHRoZSB0b2tlblxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVG9rZW4gcHJldmlldzogJHtjbGVhblRva2VuLnN1YnN0cmluZygwLCA1MCl9Li4uYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhblRva2VuO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBJZiBlbGVtZW50IGlzIGFuIG9iamVjdCwgY2hlY2sgZm9yIGFjY2Vzc190b2tlblxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIHR5cGVvZiBlbGVtZW50ID09PSAnb2JqZWN0JyAmJiBlbGVtZW50LmFjY2Vzc190b2tlbikge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEZvdW5kIGFjY2Vzc190b2tlbiBpbiBlbGVtZW50ICR7aX06YCwgY29va2llTmFtZSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5hY2Nlc3NfdG9rZW47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBJZiBubyBzaW5nbGUgZWxlbWVudCB3b3JrcywgdHJ5IGpvaW5pbmcgYWxsIHN0cmluZyBlbGVtZW50c1xuICAgICAgICAgICAgICBjb25zdCBhbGxTdHJpbmdzID0gc2Vzc2lvbkRhdGEuZmlsdGVyKGUgPT4gdHlwZW9mIGUgPT09ICdzdHJpbmcnKTtcbiAgICAgICAgICAgICAgaWYgKGFsbFN0cmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGpvaW5lZCA9IGFsbFN0cmluZ3Muam9pbignJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBqb2luZWQuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzICYmIGpvaW5lZC5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCBKV1QgYnkgam9pbmluZyBhcnJheSBlbGVtZW50cycpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGpvaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHNlc3Npb25EYXRhPy5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIGFjY2VzcyB0b2tlbiBpbiBjb29raWU6JywgY29va2llTmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uRGF0YS5hY2Nlc3NfdG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIGZvciBuZXN0ZWQgc2Vzc2lvbiBvYmplY3RcbiAgICAgICAgICAgIGlmIChzZXNzaW9uRGF0YT8uc2Vzc2lvbj8uYWNjZXNzX3Rva2VuKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCBhY2Nlc3MgdG9rZW4gaW4gbmVzdGVkIHNlc3Npb246JywgY29va2llTmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uRGF0YS5zZXNzaW9uLmFjY2Vzc190b2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XG4gICAgICAgICAgICAvLyBOb3QgSlNPTiwgbWlnaHQgYmUgZGlyZWN0IHRva2VuIG9yIGRpZmZlcmVudCBmb3JtYXRcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBDb29raWUgJHtjb29raWVOYW1lfSBpcyBub3QgSlNPTiwgY2hlY2tpbmcgaWYgaXQncyBhIEpXVGApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBpdCBsb29rcyBsaWtlIGEgSldUIChoYXMgZG90cyBhbmQgaXMgbG9uZyBlbm91Z2gpXG4gICAgICAgICAgICBpZiAoZGVjb2RlZFZhbHVlLmxlbmd0aCA+IDEwMCAmJiBkZWNvZGVkVmFsdWUuaW5jbHVkZXMoJy4nKSkge1xuICAgICAgICAgICAgICAvLyBMaWtlbHkgYSBKV1QgdG9rZW5cbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIEpXVCB0b2tlbiBpbiBjb29raWU6JywgY29va2llTmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybiBkZWNvZGVkVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHByb2Nlc3NpbmcgY29va2llICR7Y29va2llTmFtZX06YCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVHJ5IHRvIGZpbmQgYW55IGNvb2tpZSB0aGF0IGxvb2tzIGxpa2UgYW4gYXV0aCB0b2tlblxuICAgIGZvciAoY29uc3QgY29va2llIG9mIGF1dGhDb29raWVzKSB7XG4gICAgICBpZiAoY29va2llLm5hbWUuaW5jbHVkZXMoJ2F1dGgtdG9rZW4nKSB8fCBjb29raWUubmFtZS5pbmNsdWRlcygnYXV0aF90b2tlbicpKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbGV0IHNlc3Npb25EYXRhOiBhbnk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHNlc3Npb25EYXRhID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoY29va2llLnZhbHVlKSk7XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICBzZXNzaW9uRGF0YSA9IEpTT04ucGFyc2UoY29va2llLnZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHNlc3Npb25EYXRhPy5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCBhY2Nlc3MgdG9rZW4gaW4gYXV0aCBjb29raWU6JywgY29va2llLm5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25EYXRhLmFjY2Vzc190b2tlbjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIC8vIE5vdCBKU09OLCBtaWdodCBiZSBkaXJlY3QgdG9rZW5cbiAgICAgICAgICBpZiAoY29va2llLnZhbHVlLmxlbmd0aCA+IDEwMCAmJiBjb29raWUudmFsdWUuaW5jbHVkZXMoJy4nKSkge1xuICAgICAgICAgICAgLy8gTG9va3MgbGlrZSBhIEpXVFxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIEpXVCBpbiBhdXRoIGNvb2tpZTonLCBjb29raWUubmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gY29va2llLnZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdObyBhY2Nlc3MgdG9rZW4gZm91bmQgaW4gY29va2llcycpO1xuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV4dHJhY3RpbmcgdG9rZW4gZnJvbSBjb29raWVzOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgY3VycmVudCBhdXRoZW50aWNhdGVkIHVzZXIgZnJvbSB0aGUgcmVxdWVzdFxuICogXG4gKiBSZXR1cm5zIHRoZSB1c2VyIElEIGZyb20gU3VwYWJhc2UgQXV0aCBKV1QsIG9yIG51bGwgaWYgbm90IGF1dGhlbnRpY2F0ZWQuXG4gKiBVc2UgdGhpcyBpbiBBUEkgcm91dGVzIHRvIGdldCB0aGUgY3VycmVudCB1c2VyLlxuICogXG4gKiBVc2FnZTpcbiAqIGBgYHRzXG4gKiBjb25zdCB1c2VySWQgPSBhd2FpdCBnZXRDdXJyZW50VXNlcklkKCk7XG4gKiBpZiAoIXVzZXJJZCkge1xuICogICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAqIH1cbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXJJZCgpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgICBjb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTtcblxuICAgIGlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlQW5vbktleSkge1xuICAgICAgY29uc29sZS5lcnJvcignTWlzc2luZyBTdXBhYmFzZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMnKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIEZpcnN0IHRyeSB0byBnZXQgdG9rZW4gZnJvbSBBdXRob3JpemF0aW9uIGhlYWRlclxuICAgIHRyeSB7XG4gICAgICBjb25zdCBoZWFkZXJzTGlzdCA9IGF3YWl0IGhlYWRlcnMoKTtcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSBoZWFkZXJzTGlzdC5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICAgIGlmIChhdXRoSGVhZGVyPy5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnN1YnN0cmluZyg3KTtcbiAgICAgICAgY29uc3QgY2xpZW50ID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgICAgICBnbG9iYWw6IHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgY2xpZW50LmF1dGguZ2V0VXNlcigpO1xuICAgICAgICBpZiAoIWVycm9yICYmIHVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gdXNlci5pZDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB3aXRoIEF1dGhvcml6YXRpb24gaGVhZGVyOicsIGVycm9yKTtcbiAgICAgIC8vIENvbnRpbnVlIHRvIGNvb2tpZS1iYXNlZCBhdXRoXG4gICAgfVxuICAgIFxuICAgIC8vIFRyeSB0byBleHRyYWN0IGFjY2VzcyB0b2tlbiBvciB1c2VyIElEIGZyb20gY29va2llc1xuICAgIGNvbnN0IHRva2VuT3JVc2VySWQgPSBhd2FpdCBnZXRBY2Nlc3NUb2tlbkZyb21Db29raWVzKCk7XG4gICAgaWYgKHRva2VuT3JVc2VySWQpIHtcbiAgICAgIC8vIElmIGl0J3MgYWxyZWFkeSBhIHVzZXIgSUQgKGZyb20gSldUIGRlY29kZSksIHJldHVybiBpdFxuICAgICAgaWYgKHRva2VuT3JVc2VySWQubGVuZ3RoIDwgNTAgJiYgdG9rZW5PclVzZXJJZC5pbmNsdWRlcygnLScpKSB7XG4gICAgICAgIC8vIExvb2tzIGxpa2UgYSBVVUlEICh1c2VyIElEKVxuICAgICAgICBjb25zb2xlLmxvZygnVXNpbmcgZXh0cmFjdGVkIHVzZXIgSUQgZGlyZWN0bHk6JywgdG9rZW5PclVzZXJJZCk7XG4gICAgICAgIHJldHVybiB0b2tlbk9yVXNlcklkO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBPdGhlcndpc2UsIHRyeSB1c2luZyBpdCBhcyBhIHRva2VuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgICAgIGdsb2JhbDoge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW5PclVzZXJJZH1gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3IgfSA9IGF3YWl0IGNsaWVudC5hdXRoLmdldFVzZXIoKTtcbiAgICAgICAgaWYgKCFlcnJvciAmJiB1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHVzZXIuaWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igd2l0aCBjb29raWUgdG9rZW46JywgZXJyb3IpO1xuICAgICAgICAgIC8vIElmIHRva2VuIHZhbGlkYXRpb24gZmFpbHMsIHRyeSBkZWNvZGluZyBKV1QgZGlyZWN0bHlcbiAgICAgICAgICBjb25zdCBwYXlsb2FkID0gZGVjb2RlSldUUGF5bG9hZCh0b2tlbk9yVXNlcklkKTtcbiAgICAgICAgICBpZiAocGF5bG9hZCAmJiAocGF5bG9hZC5zdWIgfHwgcGF5bG9hZC51c2VyX2lkKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0V4dHJhY3RlZCB1c2VyIElEIGZyb20gSldUIGFmdGVyIHZhbGlkYXRpb24gZmFpbGVkOicsIHBheWxvYWQuc3ViIHx8IHBheWxvYWQudXNlcl9pZCk7XG4gICAgICAgICAgICByZXR1cm4gcGF5bG9hZC5zdWIgfHwgcGF5bG9hZC51c2VyX2lkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igd2l0aCBjb29raWUgdG9rZW46JywgZXJyb3IpO1xuICAgICAgICAvLyBUcnkgZGVjb2RpbmcgSldUIGFzIGZhbGxiYWNrXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBkZWNvZGVKV1RQYXlsb2FkKHRva2VuT3JVc2VySWQpO1xuICAgICAgICBpZiAocGF5bG9hZCAmJiAocGF5bG9hZC5zdWIgfHwgcGF5bG9hZC51c2VyX2lkKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0ZWQgdXNlciBJRCBmcm9tIEpXVCBhcyBmYWxsYmFjazonLCBwYXlsb2FkLnN1YiB8fCBwYXlsb2FkLnVzZXJfaWQpO1xuICAgICAgICAgIHJldHVybiBwYXlsb2FkLnN1YiB8fCBwYXlsb2FkLnVzZXJfaWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gRmFsbGJhY2s6IFRyeSBjb29raWUtYmFzZWQgYXV0aCB3aXRoIGNyZWF0ZVNlcnZlckNsaWVudFxuICAgIC8vIFRoaXMgbWlnaHQgd29yayBpZiBjb29raWVzIGFyZSBzZXQgdXAgY29ycmVjdGx5XG4gICAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZVNlcnZlckNsaWVudCgpO1xuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgICBcbiAgICAgIGlmICghZXJyb3IgJiYgdXNlcikge1xuICAgICAgICByZXR1cm4gdXNlci5pZDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGggZXJyb3IgZnJvbSBjcmVhdGVTZXJ2ZXJDbGllbnQ6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB3aXRoIGNyZWF0ZVNlcnZlckNsaWVudDonLCBlcnJvcik7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgY3VycmVudCB1c2VyOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBhdXRoZW50aWNhdGVkIFN1cGFiYXNlIGNsaWVudCB3aXRoIGEgc3BlY2lmaWMgYWNjZXNzIHRva2VuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUF1dGhlbnRpY2F0ZWRDbGllbnQoYWNjZXNzVG9rZW46IHN0cmluZykge1xuICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5cbiAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VBbm9uS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFN1cGFiYXNlIGVudmlyb25tZW50IHZhcmlhYmxlcycpO1xuICB9XG5cbiAgY29uc3QgeyBjcmVhdGVDbGllbnQgfSA9IGF3YWl0IGltcG9ydCgnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJyk7XG4gIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgIGdsb2JhbDoge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBhdXRoOiB7XG4gICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsXG4gICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICB9LFxuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGN1cnJlbnQgdXNlcidzIGJ1c2luZXNzIElEXG4gKiBcbiAqIFJldHVybnMgdGhlIGJ1c2luZXNzIElEIGZvciB0aGUgYXV0aGVudGljYXRlZCB1c2VyLCBvciBudWxsIGlmIG5vdCBmb3VuZC5cbiAqIFxuICogVXNhZ2U6XG4gKiBgYGB0c1xuICogY29uc3QgYnVzaW5lc3NJZCA9IGF3YWl0IGdldEN1cnJlbnRCdXNpbmVzc0lkKCk7XG4gKiBpZiAoIWJ1c2luZXNzSWQpIHtcbiAqICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdCdXNpbmVzcyBub3QgZm91bmQnIH0sIHsgc3RhdHVzOiA0MDQgfSk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRCdXNpbmVzc0lkKCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IGF3YWl0IGdldEN1cnJlbnRVc2VySWQoKTtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgY29uc29sZS5lcnJvcignW2dldEN1cnJlbnRCdXNpbmVzc0lkXSBObyB1c2VyIElEIGZvdW5kJyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1tnZXRDdXJyZW50QnVzaW5lc3NJZF0gTG9va2luZyBmb3IgYnVzaW5lc3MgZm9yIHVzZXI6JywgdXNlcklkKTtcbiAgICBcbiAgICAvLyBMb2cgU3VwYWJhc2UgcHJvamVjdCBpbmZvIGZvciBkZWJ1Z2dpbmdcbiAgICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgICBpZiAoc3VwYWJhc2VVcmwpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoc3VwYWJhc2VVcmwpO1xuICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gdXJsLmhvc3RuYW1lLnNwbGl0KCcuJylbMF07XG4gICAgICAgIGNvbnNvbGUubG9nKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIFVzaW5nIFN1cGFiYXNlIHByb2plY3Q6JywgcHJvamVjdFJlZik7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tnZXRDdXJyZW50QnVzaW5lc3NJZF0gU3VwYWJhc2UgVVJMOicsIHN1cGFiYXNlVXJsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gVXNlIGNyZWF0ZVNlcnZlckNsaWVudCB3aGljaCBzaG91bGQgaGFuZGxlIGNvb2tpZXMgcHJvcGVybHlcbiAgICAvLyBJZiB0aGF0IGZhaWxzIGR1ZSB0byBSTFMsIHdlJ2xsIHVzZSBzZXJ2aWNlIHJvbGUgYXMgZmFsbGJhY2tcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZVNlcnZlckNsaWVudCgpO1xuICAgIFxuICAgIC8vIFF1ZXJ5IGZvciBidXNpbmVzc1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYnVzaW5lc3NlcycpXG4gICAgICAuc2VsZWN0KCdpZCwgbmFtZScpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuaXMoJ2RlbGV0ZWRfYXQnLCBudWxsKVxuICAgICAgLm1heWJlU2luZ2xlKCk7IC8vIFVzZSBtYXliZVNpbmdsZSgpIGluc3RlYWQgb2Ygc2luZ2xlKCkgdG8gYXZvaWQgZXJyb3IgaWYgbm90IGZvdW5kXG4gICAgXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIEVycm9yIHF1ZXJ5aW5nIGJ1c2luZXNzOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgLy8gSWYgUkxTIGVycm9yLCB0cnkgd2l0aCBzZXJ2aWNlIHJvbGUgKHdlIGFscmVhZHkgdmVyaWZpZWQgdXNlciBpcyBhdXRoZW50aWNhdGVkKVxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDMwMScgfHwgZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ05vIHN1aXRhYmxlIGtleScpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIFJMUyBlcnJvciwgdHJ5aW5nIHdpdGggc2VydmljZSByb2xlIGZvciB1c2VyOicsIHVzZXJJZCk7XG4gICAgICAgIGNvbnN0IHsgY3JlYXRlQWRtaW5DbGllbnQgfSA9IGF3YWl0IGltcG9ydCgnQC9saWIvZGInKTtcbiAgICAgICAgY29uc3QgYWRtaW5TdXBhYmFzZSA9IGNyZWF0ZUFkbWluQ2xpZW50KCk7XG4gICAgICAgIFxuICAgICAgICAvLyBGaXJzdCBjaGVjayBpZiBBTlkgYnVzaW5lc3NlcyBleGlzdCBmb3IgdGhpcyB1c2VyIChpbmNsdWRpbmcgZGVsZXRlZClcbiAgICAgICAgY29uc3QgeyBkYXRhOiBhbGxCdXNpbmVzc2VzLCBlcnJvcjogYWxsRXJyb3IgfSA9IGF3YWl0IGFkbWluU3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgnYnVzaW5lc3NlcycpXG4gICAgICAgICAgLnNlbGVjdCgnaWQsIG5hbWUsIGRlbGV0ZWRfYXQsIHVzZXJfaWQnKVxuICAgICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZCk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZygnW2dldEN1cnJlbnRCdXNpbmVzc0lkXSBBbGwgYnVzaW5lc3NlcyBmb3IgdXNlciAoYWRtaW4pOicsIGFsbEJ1c2luZXNzZXM/Lmxlbmd0aCB8fCAwKTtcbiAgICAgICAgaWYgKGFsbEJ1c2luZXNzZXMgJiYgYWxsQnVzaW5lc3Nlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tnZXRDdXJyZW50QnVzaW5lc3NJZF0gQnVzaW5lc3NlcyBmb3VuZDonLCBhbGxCdXNpbmVzc2VzLm1hcChiID0+ICh7IFxuICAgICAgICAgICAgaWQ6IGIuaWQsIFxuICAgICAgICAgICAgbmFtZTogYi5uYW1lLCBcbiAgICAgICAgICAgIGRlbGV0ZWQ6ICEhYi5kZWxldGVkX2F0LFxuICAgICAgICAgICAgdXNlcl9pZDogYi51c2VyX2lkXG4gICAgICAgICAgfSkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWxsRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIEVycm9yIGNoZWNraW5nIGFsbCBidXNpbmVzc2VzOicsIGFsbEVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRGlhZ25vc3RpYzogQ2hlY2sgaWYgdGhlcmUgYXJlIEFOWSBidXNpbmVzc2VzIGF0IGFsbCAodG8gZGV0ZWN0IHVzZXIgSUQgbWlzbWF0Y2gpXG4gICAgICAgIGNvbnN0IHsgZGF0YTogYW55QnVzaW5lc3NlcywgZXJyb3I6IGFueUVycm9yIH0gPSBhd2FpdCBhZG1pblN1cGFiYXNlXG4gICAgICAgICAgLmZyb20oJ2J1c2luZXNzZXMnKVxuICAgICAgICAgIC5zZWxlY3QoJ2lkLCBuYW1lLCB1c2VyX2lkLCBkZWxldGVkX2F0JylcbiAgICAgICAgICAubGltaXQoMTApO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFhbnlFcnJvciAmJiBhbnlCdXNpbmVzc2VzICYmIGFueUJ1c2luZXNzZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIERJQUdOT1NUSUM6IEZvdW5kIGJ1c2luZXNzZXMgaW4gZGF0YWJhc2U6JywgYW55QnVzaW5lc3Nlcy5tYXAoYiA9PiAoe1xuICAgICAgICAgICAgaWQ6IGIuaWQsXG4gICAgICAgICAgICBuYW1lOiBiLm5hbWUsXG4gICAgICAgICAgICB1c2VyX2lkOiBiLnVzZXJfaWQsXG4gICAgICAgICAgICBtYXRjaGVzX2N1cnJlbnRfdXNlcjogYi51c2VyX2lkID09PSB1c2VySWQsXG4gICAgICAgICAgICBkZWxldGVkOiAhIWIuZGVsZXRlZF9hdFxuICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIWFueUVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tnZXRDdXJyZW50QnVzaW5lc3NJZF0gRElBR05PU1RJQzogTm8gYnVzaW5lc3NlcyBleGlzdCBpbiBkYXRhYmFzZSBhdCBhbGwnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIERJQUdOT1NUSUM6IEVycm9yIGNoZWNraW5nIGFsbCBidXNpbmVzc2VzOicsIGFueUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gTm93IGdldCB0aGUgbm9uLWRlbGV0ZWQgb25lXG4gICAgICAgIGNvbnN0IHsgZGF0YTogYWRtaW5EYXRhLCBlcnJvcjogYWRtaW5FcnJvciB9ID0gYXdhaXQgYWRtaW5TdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCdidXNpbmVzc2VzJylcbiAgICAgICAgICAuc2VsZWN0KCdpZCwgbmFtZScpXG4gICAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgICAgIC5pcygnZGVsZXRlZF9hdCcsIG51bGwpXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYWRtaW5FcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tnZXRDdXJyZW50QnVzaW5lc3NJZF0gRXJyb3Igd2l0aCBhZG1pbiBjbGllbnQ6JywgYWRtaW5FcnJvcik7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChhZG1pbkRhdGEpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW2dldEN1cnJlbnRCdXNpbmVzc0lkXSBGb3VuZCBidXNpbmVzcyB3aXRoIGFkbWluIGNsaWVudDonLCBhZG1pbkRhdGEuaWQsIGFkbWluRGF0YS5uYW1lKTtcbiAgICAgICAgICByZXR1cm4gYWRtaW5EYXRhLmlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tnZXRDdXJyZW50QnVzaW5lc3NJZF0gTm8gYnVzaW5lc3MgZm91bmQgd2l0aCBhZG1pbiBjbGllbnQgZm9yIHVzZXI6JywgdXNlcklkKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIE5vIGJ1c2luZXNzIGZvdW5kIGZvciB1c2VyOicsIHVzZXJJZCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1tnZXRDdXJyZW50QnVzaW5lc3NJZF0gRm91bmQgYnVzaW5lc3M6JywgZGF0YS5pZCwgZGF0YS5uYW1lKTtcbiAgICByZXR1cm4gZGF0YS5pZDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbZ2V0Q3VycmVudEJ1c2luZXNzSWRdIEVycm9yIGdldHRpbmcgY3VycmVudCBidXNpbmVzczonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuXG5cblxuIl0sIm5hbWVzIjpbImNyZWF0ZVNlcnZlckNsaWVudCIsImhlYWRlcnMiLCJjb29raWVzIiwiY3JlYXRlQ2xpZW50IiwiZGVjb2RlSldUUGF5bG9hZCIsInRva2VuIiwicGFydHMiLCJzcGxpdCIsImxlbmd0aCIsInBheWxvYWQiLCJwYWRkZWRQYXlsb2FkIiwicmVwZWF0IiwiZGVjb2RlZCIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsIkpTT04iLCJwYXJzZSIsImVycm9yIiwiY29uc29sZSIsImdldFJhd1Rva2VuRnJvbUNvb2tpZXMiLCJjb29raWVTdG9yZSIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsImFsbENvb2tpZXMiLCJnZXRBbGwiLCJhdXRoQ29va2llcyIsImZpbHRlciIsImMiLCJuYW1lIiwiaW5jbHVkZXMiLCJ1cmwiLCJVUkwiLCJwcm9qZWN0UmVmIiwiaG9zdG5hbWUiLCJjb29raWVOYW1lcyIsInJlcGxhY2UiLCJjb29raWVOYW1lIiwiY29va2llIiwiZ2V0IiwidmFsdWUiLCJkZWNvZGVkVmFsdWUiLCJkZWNvZGVVUklDb21wb25lbnQiLCJzZXNzaW9uRGF0YSIsIkFycmF5IiwiaXNBcnJheSIsImZpcnN0RWxlbWVudCIsImNsZWFuVG9rZW4iLCJ0cmltIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwic2xpY2UiLCJhY2Nlc3NfdG9rZW4iLCJzZXNzaW9uIiwicGFyc2VFcnJvciIsImdldEFjY2Vzc1Rva2VuRnJvbUNvb2tpZXMiLCJsb2ciLCJtYXAiLCJwcmV2aWV3Iiwic3Vic3RyaW5nIiwiT2JqZWN0Iiwia2V5cyIsImkiLCJlbGVtZW50Iiwic3ViIiwidXNlcl9pZCIsInVzZXJJZCIsImFsbFN0cmluZ3MiLCJlIiwiam9pbmVkIiwiam9pbiIsImdldEN1cnJlbnRVc2VySWQiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImhlYWRlcnNMaXN0IiwiYXV0aEhlYWRlciIsImNsaWVudCIsImdsb2JhbCIsIkF1dGhvcml6YXRpb24iLCJkYXRhIiwidXNlciIsImF1dGgiLCJnZXRVc2VyIiwiaWQiLCJ0b2tlbk9yVXNlcklkIiwic3VwYWJhc2UiLCJjcmVhdGVBdXRoZW50aWNhdGVkQ2xpZW50IiwiYWNjZXNzVG9rZW4iLCJFcnJvciIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImdldEN1cnJlbnRCdXNpbmVzc0lkIiwic2VsZWN0IiwiZXEiLCJpcyIsIm1heWJlU2luZ2xlIiwiY29kZSIsIm1lc3NhZ2UiLCJjcmVhdGVBZG1pbkNsaWVudCIsImFkbWluU3VwYWJhc2UiLCJhbGxCdXNpbmVzc2VzIiwiYWxsRXJyb3IiLCJiIiwiZGVsZXRlZCIsImRlbGV0ZWRfYXQiLCJhbnlCdXNpbmVzc2VzIiwiYW55RXJyb3IiLCJsaW1pdCIsIm1hdGNoZXNfY3VycmVudF91c2VyIiwiYWRtaW5EYXRhIiwiYWRtaW5FcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminClient: () => (/* binding */ createAdminClient),\n/* harmony export */   createClientClient: () => (/* binding */ createClientClient),\n/* harmony export */   createServerClient: () => (/* binding */ createServerClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\n/**\n * Get Supabase client for server-side operations\n * \n * This function returns different clients based on context:\n * - If called from an authenticated API route, uses the user's JWT from Authorization header (respects RLS)\n * - If called from a public route or background job, uses service role (bypasses RLS)\n * \n * Usage in API routes:\n * ```ts\n * const supabase = await createServerClient();\n * const { data } = await supabase.from('businesses').select('*');\n * ```\n */ async function createServerClient() {\n    const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnd29vcWFrZHZyY2hmd3Jkbnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTQyNDEsImV4cCI6MjA3ODk3MDI0MX0.YpX0dYf_iueJVR1oK5SvREnO765JAKxriy2csdAEZlI\";\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!supabaseUrl) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n    }\n    if (!supabaseAnonKey && !supabaseServiceKey) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_ANON_KEY or SUPABASE_SERVICE_ROLE_KEY environment variable\");\n    }\n    // Try to get the user's JWT from Authorization header (for API routes)\n    let accessToken;\n    try {\n        const headersList = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.headers)();\n        const authHeader = headersList.get(\"authorization\");\n        if (authHeader?.startsWith(\"Bearer \")) {\n            accessToken = authHeader.substring(7);\n        }\n    } catch  {\n    // Not in a headers context\n    }\n    // If we have a user token from header, use anon key with that token (respects RLS)\n    if (accessToken && supabaseAnonKey) {\n        return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${accessToken}`\n                }\n            }\n        });\n    }\n    // Try to get session from cookies (Supabase stores session in cookies)\n    try {\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        const allCookies = cookieStore.getAll();\n        // Try to extract access token from cookies first\n        const supabaseUrlObj = new URL(supabaseUrl);\n        const projectRef = supabaseUrlObj.hostname.split(\".\")[0];\n        // Look for Supabase auth token cookie\n        // Try sb-api-auth-token first as it's the most common\n        const authCookieNames = [\n            `sb-api-auth-token`,\n            `sb-${projectRef}-auth-token`\n        ];\n        let accessToken;\n        for (const cookieName of authCookieNames){\n            const cookie = cookieStore.get(cookieName);\n            if (cookie?.value) {\n                // Log first 100 chars to see format (without exposing full token)\n                const preview = cookie.value.substring(0, 100);\n                console.log(`[createServerClient] Checking cookie: ${cookieName}, length: ${cookie.value.length}, preview: ${preview}...`);\n                try {\n                    // Try URL decoding first\n                    let decodedValue = cookie.value;\n                    try {\n                        decodedValue = decodeURIComponent(cookie.value);\n                    } catch  {\n                    // Not URL encoded\n                    }\n                    // Try parsing as JSON\n                    try {\n                        const session = JSON.parse(decodedValue);\n                        console.log(`[createServerClient] Parsed ${cookieName} as JSON, type:`, Array.isArray(session) ? \"array\" : typeof session, \"keys:\", Object.keys(session || {}));\n                        // Check if it's an array (Supabase sometimes stores tokens as array)\n                        if (Array.isArray(session) && session.length > 0) {\n                            console.log(`[createServerClient] Array has ${session.length} elements, checking each...`);\n                            // Try each element to find a valid JWT\n                            for(let i = 0; i < session.length; i++){\n                                const element = session[i];\n                                if (typeof element === \"string\") {\n                                    // Remove any quotes or extra characters\n                                    let cleanToken = element.trim();\n                                    if (cleanToken.startsWith('\"') && cleanToken.endsWith('\"') || cleanToken.startsWith(\"'\") && cleanToken.endsWith(\"'\")) {\n                                        cleanToken = cleanToken.slice(1, -1);\n                                    }\n                                    // Check if it looks like a JWT (has 3 parts separated by dots)\n                                    const parts = cleanToken.split(\".\");\n                                    if (parts.length === 3 && cleanToken.length > 100) {\n                                        console.log(`[createServerClient] Found valid JWT structure in element ${i}, using it as access token`);\n                                        // Use this token - even if signature validation fails later, \n                                        // Supabase might still accept it for RLS if the payload is valid\n                                        accessToken = cleanToken;\n                                        break;\n                                    }\n                                }\n                                // If element is an object, check for access_token\n                                if (element && typeof element === \"object\" && element.access_token) {\n                                    console.log(`[createServerClient] Found access_token in element ${i}: ${cookieName}`);\n                                    accessToken = element.access_token;\n                                    break;\n                                }\n                            }\n                            if (accessToken) {\n                                break;\n                            }\n                            // If no single element works, try joining all string elements\n                            const allStrings = session.filter((e)=>typeof e === \"string\");\n                            if (allStrings.length > 0) {\n                                const joined = allStrings.join(\"\");\n                                const parts = joined.split(\".\");\n                                if (parts.length === 3 && joined.length > 100) {\n                                    console.log(\"[createServerClient] Found JWT by joining array elements\");\n                                    accessToken = joined;\n                                    break;\n                                }\n                            }\n                        }\n                        if (session?.access_token) {\n                            console.log(`[createServerClient] Found access_token in ${cookieName}`);\n                            accessToken = session.access_token;\n                            break;\n                        }\n                        // Check for nested session object\n                        if (session?.session?.access_token) {\n                            console.log(`[createServerClient] Found access_token in nested session: ${cookieName}`);\n                            accessToken = session.session.access_token;\n                            break;\n                        }\n                    } catch (parseError) {\n                        // Not JSON, might be direct JWT token\n                        console.log(`[createServerClient] ${cookieName} is not JSON, checking if JWT`);\n                        if (decodedValue.length > 100 && decodedValue.includes(\".\")) {\n                            console.log(`[createServerClient] Using ${cookieName} as direct JWT token`);\n                            accessToken = decodedValue;\n                            break;\n                        }\n                    }\n                } catch (error) {\n                    console.error(`[createServerClient] Error processing ${cookieName}:`, error);\n                }\n            }\n        }\n        // If we found an access token, use it directly\n        if (accessToken && supabaseAnonKey) {\n            return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey, {\n                global: {\n                    headers: {\n                        Authorization: `Bearer ${accessToken}`\n                    }\n                },\n                auth: {\n                    persistSession: false,\n                    autoRefreshToken: false\n                }\n            });\n        }\n        // Fallback: Build cookie header for Supabase to read\n        const cookieHeader = allCookies.map((c)=>`${c.name}=${c.value}`).join(\"; \");\n        if (cookieHeader && supabaseAnonKey) {\n            // Create client with cookies - Supabase will extract session from cookies\n            return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey, {\n                global: {\n                    headers: {\n                        Cookie: cookieHeader\n                    }\n                },\n                auth: {\n                    persistSession: false,\n                    autoRefreshToken: false\n                }\n            });\n        }\n    } catch (error) {\n        console.error(\"Error reading cookies in createServerClient:\", error);\n    // Not in a cookies context, continue\n    }\n    // For public routes or background jobs, use service role key\n    // WARNING: This bypasses RLS - only use when necessary\n    if (supabaseServiceKey) {\n        return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        });\n    }\n    // Fallback to anon key (for public read operations)\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n}\n/**\n * Get Supabase client with service role (bypasses RLS)\n * \n * Use this ONLY for:\n * - Background jobs\n * - Webhook handlers\n * - Admin operations that need to bypass RLS\n * \n * Usage:\n * ```ts\n * const supabase = createAdminClient();\n * const { data } = await supabase.from('businesses').select('*');\n * ```\n */ function createAdminClient() {\n    const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!supabaseUrl) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n    }\n    if (!supabaseServiceKey) {\n        throw new Error(\"Missing SUPABASE_SERVICE_ROLE_KEY environment variable\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        }\n    });\n}\n/**\n * Get Supabase client for client-side operations\n * \n * This should be used in React components or client-side code.\n * It uses the anon key and relies on Supabase Auth for authentication.\n * \n * Usage in client components:\n * ```ts\n * 'use client';\n * const supabase = createClientClient();\n * ```\n */ function createClientClient() {\n    const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnd29vcWFrZHZyY2hmd3Jkbnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTQyNDEsImV4cCI6MjA3ODk3MDI0MX0.YpX0dYf_iueJVR1oK5SvREnO765JAKxriy2csdAEZlI\";\n    if (!supabaseUrl) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n    }\n    if (!supabaseAnonKey) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXFFO0FBQ3JCO0FBRWhEOzs7Ozs7Ozs7Ozs7Q0FZQyxHQUNNLGVBQWVHO0lBQ3BCLE1BQU1DLGNBQWNDLDBDQUFvQztJQUN4RCxNQUFNRyxrQkFBa0JILGtOQUF5QztJQUNqRSxNQUFNSyxxQkFBcUJMLFFBQVFDLEdBQUcsQ0FBQ0sseUJBQXlCO0lBRWhFLElBQUksQ0FBQ1AsYUFBYTtRQUNoQixNQUFNLElBQUlRLE1BQU07SUFDbEI7SUFFQSxJQUFJLENBQUNKLG1CQUFtQixDQUFDRSxvQkFBb0I7UUFDM0MsTUFBTSxJQUFJRSxNQUNSO0lBRUo7SUFFQSx1RUFBdUU7SUFDdkUsSUFBSUM7SUFFSixJQUFJO1FBQ0YsTUFBTUMsY0FBYyxNQUFNWixxREFBT0E7UUFDakMsTUFBTWEsYUFBYUQsWUFBWUUsR0FBRyxDQUFDO1FBQ25DLElBQUlELFlBQVlFLFdBQVcsWUFBWTtZQUNyQ0osY0FBY0UsV0FBV0csU0FBUyxDQUFDO1FBQ3JDO0lBQ0YsRUFBRSxPQUFNO0lBQ04sMkJBQTJCO0lBQzdCO0lBRUEsbUZBQW1GO0lBQ25GLElBQUlMLGVBQWVMLGlCQUFpQjtRQUNsQyxPQUFPUixtRUFBWUEsQ0FBQ0ksYUFBYUksaUJBQWlCO1lBQ2hEVyxRQUFRO2dCQUNOakIsU0FBUztvQkFDUGtCLGVBQWUsQ0FBQyxPQUFPLEVBQUVQLFlBQVksQ0FBQztnQkFDeEM7WUFDRjtRQUNGO0lBQ0Y7SUFFQSx1RUFBdUU7SUFDdkUsSUFBSTtRQUNGLE1BQU1RLGNBQWMsTUFBTXBCLHFEQUFPQTtRQUNqQyxNQUFNcUIsYUFBYUQsWUFBWUUsTUFBTTtRQUVyQyxpREFBaUQ7UUFDakQsTUFBTUMsaUJBQWlCLElBQUlDLElBQUlyQjtRQUMvQixNQUFNc0IsYUFBYUYsZUFBZUcsUUFBUSxDQUFDQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFFeEQsc0NBQXNDO1FBQ3RDLHNEQUFzRDtRQUN0RCxNQUFNQyxrQkFBa0I7WUFDdEIsQ0FBQyxpQkFBaUIsQ0FBQztZQUNuQixDQUFDLEdBQUcsRUFBRUgsV0FBVyxXQUFXLENBQUM7U0FDOUI7UUFFRCxJQUFJYjtRQUNKLEtBQUssTUFBTWlCLGNBQWNELGdCQUFpQjtZQUN4QyxNQUFNRSxTQUFTVixZQUFZTCxHQUFHLENBQUNjO1lBQy9CLElBQUlDLFFBQVFDLE9BQU87Z0JBQ2pCLGtFQUFrRTtnQkFDbEUsTUFBTUMsVUFBVUYsT0FBT0MsS0FBSyxDQUFDZCxTQUFTLENBQUMsR0FBRztnQkFDMUNnQixRQUFRQyxHQUFHLENBQUMsQ0FBQyxzQ0FBc0MsRUFBRUwsV0FBVyxVQUFVLEVBQUVDLE9BQU9DLEtBQUssQ0FBQ0ksTUFBTSxDQUFDLFdBQVcsRUFBRUgsUUFBUSxHQUFHLENBQUM7Z0JBQ3pILElBQUk7b0JBQ0YseUJBQXlCO29CQUN6QixJQUFJSSxlQUFlTixPQUFPQyxLQUFLO29CQUMvQixJQUFJO3dCQUNGSyxlQUFlQyxtQkFBbUJQLE9BQU9DLEtBQUs7b0JBQ2hELEVBQUUsT0FBTTtvQkFDTixrQkFBa0I7b0JBQ3BCO29CQUVBLHNCQUFzQjtvQkFDdEIsSUFBSTt3QkFDRixNQUFNTyxVQUFVQyxLQUFLQyxLQUFLLENBQUNKO3dCQUMzQkgsUUFBUUMsR0FBRyxDQUFDLENBQUMsNEJBQTRCLEVBQUVMLFdBQVcsZUFBZSxDQUFDLEVBQUVZLE1BQU1DLE9BQU8sQ0FBQ0osV0FBVyxVQUFVLE9BQU9BLFNBQVMsU0FBU0ssT0FBT0MsSUFBSSxDQUFDTixXQUFXLENBQUM7d0JBRTVKLHFFQUFxRTt3QkFDckUsSUFBSUcsTUFBTUMsT0FBTyxDQUFDSixZQUFZQSxRQUFRSCxNQUFNLEdBQUcsR0FBRzs0QkFDaERGLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLCtCQUErQixFQUFFSSxRQUFRSCxNQUFNLENBQUMsMkJBQTJCLENBQUM7NEJBRXpGLHVDQUF1Qzs0QkFDdkMsSUFBSyxJQUFJVSxJQUFJLEdBQUdBLElBQUlQLFFBQVFILE1BQU0sRUFBRVUsSUFBSztnQ0FDdkMsTUFBTUMsVUFBVVIsT0FBTyxDQUFDTyxFQUFFO2dDQUUxQixJQUFJLE9BQU9DLFlBQVksVUFBVTtvQ0FDL0Isd0NBQXdDO29DQUN4QyxJQUFJQyxhQUFhRCxRQUFRRSxJQUFJO29DQUM3QixJQUFJLFdBQVloQyxVQUFVLENBQUMsUUFBUStCLFdBQVdFLFFBQVEsQ0FBQyxRQUNsREYsV0FBVy9CLFVBQVUsQ0FBQyxRQUFRK0IsV0FBV0UsUUFBUSxDQUFDLE1BQU87d0NBQzVERixhQUFhQSxXQUFXRyxLQUFLLENBQUMsR0FBRyxDQUFDO29DQUNwQztvQ0FFQSwrREFBK0Q7b0NBQy9ELE1BQU1DLFFBQVFKLFdBQVdwQixLQUFLLENBQUM7b0NBQy9CLElBQUl3QixNQUFNaEIsTUFBTSxLQUFLLEtBQUtZLFdBQVdaLE1BQU0sR0FBRyxLQUFLO3dDQUNqREYsUUFBUUMsR0FBRyxDQUFDLENBQUMsMERBQTBELEVBQUVXLEVBQUUsMEJBQTBCLENBQUM7d0NBQ3RHLDhEQUE4RDt3Q0FDOUQsaUVBQWlFO3dDQUNqRWpDLGNBQWNtQzt3Q0FDZDtvQ0FDRjtnQ0FDRjtnQ0FFQSxrREFBa0Q7Z0NBQ2xELElBQUlELFdBQVcsT0FBT0EsWUFBWSxZQUFZQSxRQUFRTSxZQUFZLEVBQUU7b0NBQ2xFbkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsbURBQW1ELEVBQUVXLEVBQUUsRUFBRSxFQUFFaEIsV0FBVyxDQUFDO29DQUNwRmpCLGNBQWNrQyxRQUFRTSxZQUFZO29DQUNsQztnQ0FDRjs0QkFDRjs0QkFFQSxJQUFJeEMsYUFBYTtnQ0FDZjs0QkFDRjs0QkFFQSw4REFBOEQ7NEJBQzlELE1BQU15QyxhQUFhZixRQUFRZ0IsTUFBTSxDQUFDQyxDQUFBQSxJQUFLLE9BQU9BLE1BQU07NEJBQ3BELElBQUlGLFdBQVdsQixNQUFNLEdBQUcsR0FBRztnQ0FDekIsTUFBTXFCLFNBQVNILFdBQVdJLElBQUksQ0FBQztnQ0FDL0IsTUFBTU4sUUFBUUssT0FBTzdCLEtBQUssQ0FBQztnQ0FDM0IsSUFBSXdCLE1BQU1oQixNQUFNLEtBQUssS0FBS3FCLE9BQU9yQixNQUFNLEdBQUcsS0FBSztvQ0FDN0NGLFFBQVFDLEdBQUcsQ0FBQztvQ0FDWnRCLGNBQWM0QztvQ0FDZDtnQ0FDRjs0QkFDRjt3QkFDRjt3QkFFQSxJQUFJbEIsU0FBU2MsY0FBYzs0QkFDekJuQixRQUFRQyxHQUFHLENBQUMsQ0FBQywyQ0FBMkMsRUFBRUwsV0FBVyxDQUFDOzRCQUN0RWpCLGNBQWMwQixRQUFRYyxZQUFZOzRCQUNsQzt3QkFDRjt3QkFFQSxrQ0FBa0M7d0JBQ2xDLElBQUlkLFNBQVNBLFNBQVNjLGNBQWM7NEJBQ2xDbkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsMkRBQTJELEVBQUVMLFdBQVcsQ0FBQzs0QkFDdEZqQixjQUFjMEIsUUFBUUEsT0FBTyxDQUFDYyxZQUFZOzRCQUMxQzt3QkFDRjtvQkFDRixFQUFFLE9BQU9NLFlBQVk7d0JBQ25CLHNDQUFzQzt3QkFDdEN6QixRQUFRQyxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsRUFBRUwsV0FBVyw2QkFBNkIsQ0FBQzt3QkFDN0UsSUFBSU8sYUFBYUQsTUFBTSxHQUFHLE9BQU9DLGFBQWF1QixRQUFRLENBQUMsTUFBTTs0QkFDM0QxQixRQUFRQyxHQUFHLENBQUMsQ0FBQywyQkFBMkIsRUFBRUwsV0FBVyxvQkFBb0IsQ0FBQzs0QkFDMUVqQixjQUFjd0I7NEJBQ2Q7d0JBQ0Y7b0JBQ0Y7Z0JBQ0YsRUFBRSxPQUFPd0IsT0FBTztvQkFDZDNCLFFBQVEyQixLQUFLLENBQUMsQ0FBQyxzQ0FBc0MsRUFBRS9CLFdBQVcsQ0FBQyxDQUFDLEVBQUUrQjtnQkFDeEU7WUFDRjtRQUNGO1FBRUEsK0NBQStDO1FBQy9DLElBQUloRCxlQUFlTCxpQkFBaUI7WUFDbEMsT0FBT1IsbUVBQVlBLENBQUNJLGFBQWFJLGlCQUFpQjtnQkFDaERXLFFBQVE7b0JBQ05qQixTQUFTO3dCQUNQa0IsZUFBZSxDQUFDLE9BQU8sRUFBRVAsWUFBWSxDQUFDO29CQUN4QztnQkFDRjtnQkFDQWlELE1BQU07b0JBQ0pDLGdCQUFnQjtvQkFDaEJDLGtCQUFrQjtnQkFDcEI7WUFDRjtRQUNGO1FBRUEscURBQXFEO1FBQ3JELE1BQU1DLGVBQWUzQyxXQUFXNEMsR0FBRyxDQUFDQyxDQUFBQSxJQUFLLENBQUMsRUFBRUEsRUFBRUMsSUFBSSxDQUFDLENBQUMsRUFBRUQsRUFBRW5DLEtBQUssQ0FBQyxDQUFDLEVBQUUwQixJQUFJLENBQUM7UUFFdEUsSUFBSU8sZ0JBQWdCekQsaUJBQWlCO1lBQ25DLDBFQUEwRTtZQUMxRSxPQUFPUixtRUFBWUEsQ0FBQ0ksYUFBYUksaUJBQWlCO2dCQUNoRFcsUUFBUTtvQkFDTmpCLFNBQVM7d0JBQ1BtRSxRQUFRSjtvQkFDVjtnQkFDRjtnQkFDQUgsTUFBTTtvQkFDSkMsZ0JBQWdCO29CQUNoQkMsa0JBQWtCO2dCQUNwQjtZQUNGO1FBQ0Y7SUFDRixFQUFFLE9BQU9ILE9BQU87UUFDZDNCLFFBQVEyQixLQUFLLENBQUMsZ0RBQWdEQTtJQUM5RCxxQ0FBcUM7SUFDdkM7SUFFQSw2REFBNkQ7SUFDN0QsdURBQXVEO0lBQ3ZELElBQUluRCxvQkFBb0I7UUFDdEIsT0FBT1YsbUVBQVlBLENBQUNJLGFBQWFNLG9CQUFvQjtZQUNuRG9ELE1BQU07Z0JBQ0pFLGtCQUFrQjtnQkFDbEJELGdCQUFnQjtZQUNsQjtRQUNGO0lBQ0Y7SUFFQSxvREFBb0Q7SUFDcEQsT0FBTy9ELG1FQUFZQSxDQUFDSSxhQUFhSTtBQUNuQztBQUVBOzs7Ozs7Ozs7Ozs7O0NBYUMsR0FDTSxTQUFTOEQ7SUFDZCxNQUFNbEUsY0FBY0MsMENBQW9DO0lBQ3hELE1BQU1LLHFCQUFxQkwsUUFBUUMsR0FBRyxDQUFDSyx5QkFBeUI7SUFFaEUsSUFBSSxDQUFDUCxhQUFhO1FBQ2hCLE1BQU0sSUFBSVEsTUFBTTtJQUNsQjtJQUVBLElBQUksQ0FBQ0Ysb0JBQW9CO1FBQ3ZCLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtJQUVBLE9BQU9aLG1FQUFZQSxDQUFDSSxhQUFhTSxvQkFBb0I7UUFDbkRvRCxNQUFNO1lBQ0pFLGtCQUFrQjtZQUNsQkQsZ0JBQWdCO1FBQ2xCO0lBQ0Y7QUFDRjtBQUVBOzs7Ozs7Ozs7OztDQVdDLEdBQ00sU0FBU1E7SUFDZCxNQUFNbkUsY0FBY0MsMENBQW9DO0lBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0lBRWpFLElBQUksQ0FBQ0QsYUFBYTtRQUNoQixNQUFNLElBQUlRLE1BQU07SUFDbEI7SUFFQSxJQUFJLENBQUNKLGlCQUFpQjtRQUNwQixNQUFNLElBQUlJLE1BQU07SUFDbEI7SUFFQSxPQUFPWixtRUFBWUEsQ0FBQ0ksYUFBYUk7QUFDbkMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvLi9zcmMvbGliL2RiLnRzPzllNGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50LCBTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyBjb29raWVzLCBoZWFkZXJzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcblxuLyoqXG4gKiBHZXQgU3VwYWJhc2UgY2xpZW50IGZvciBzZXJ2ZXItc2lkZSBvcGVyYXRpb25zXG4gKiBcbiAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBkaWZmZXJlbnQgY2xpZW50cyBiYXNlZCBvbiBjb250ZXh0OlxuICogLSBJZiBjYWxsZWQgZnJvbSBhbiBhdXRoZW50aWNhdGVkIEFQSSByb3V0ZSwgdXNlcyB0aGUgdXNlcidzIEpXVCBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyIChyZXNwZWN0cyBSTFMpXG4gKiAtIElmIGNhbGxlZCBmcm9tIGEgcHVibGljIHJvdXRlIG9yIGJhY2tncm91bmQgam9iLCB1c2VzIHNlcnZpY2Ugcm9sZSAoYnlwYXNzZXMgUkxTKVxuICogXG4gKiBVc2FnZSBpbiBBUEkgcm91dGVzOlxuICogYGBgdHNcbiAqIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlU2VydmVyQ2xpZW50KCk7XG4gKiBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ2J1c2luZXNzZXMnKS5zZWxlY3QoJyonKTtcbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2VydmVyQ2xpZW50KCk6IFByb21pc2U8U3VwYWJhc2VDbGllbnQ+IHtcbiAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gIGNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZO1xuICBjb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xuXG4gIGlmICghc3VwYWJhc2VVcmwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlJyk7XG4gIH1cblxuICBpZiAoIXN1cGFiYXNlQW5vbktleSAmJiAhc3VwYWJhc2VTZXJ2aWNlS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ01pc3NpbmcgTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgb3IgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSdcbiAgICApO1xuICB9XG5cbiAgLy8gVHJ5IHRvIGdldCB0aGUgdXNlcidzIEpXVCBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyIChmb3IgQVBJIHJvdXRlcylcbiAgbGV0IGFjY2Vzc1Rva2VuOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IGhlYWRlcnNMaXN0ID0gYXdhaXQgaGVhZGVycygpO1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSBoZWFkZXJzTGlzdC5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoYXV0aEhlYWRlcj8uc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICBhY2Nlc3NUb2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgIH1cbiAgfSBjYXRjaCB7XG4gICAgLy8gTm90IGluIGEgaGVhZGVycyBjb250ZXh0XG4gIH1cblxuICAvLyBJZiB3ZSBoYXZlIGEgdXNlciB0b2tlbiBmcm9tIGhlYWRlciwgdXNlIGFub24ga2V5IHdpdGggdGhhdCB0b2tlbiAocmVzcGVjdHMgUkxTKVxuICBpZiAoYWNjZXNzVG9rZW4gJiYgc3VwYWJhc2VBbm9uS2V5KSB7XG4gICAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgICBnbG9iYWw6IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRyeSB0byBnZXQgc2Vzc2lvbiBmcm9tIGNvb2tpZXMgKFN1cGFiYXNlIHN0b3JlcyBzZXNzaW9uIGluIGNvb2tpZXMpXG4gIHRyeSB7XG4gICAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKCk7XG4gICAgY29uc3QgYWxsQ29va2llcyA9IGNvb2tpZVN0b3JlLmdldEFsbCgpO1xuICAgIFxuICAgIC8vIFRyeSB0byBleHRyYWN0IGFjY2VzcyB0b2tlbiBmcm9tIGNvb2tpZXMgZmlyc3RcbiAgICBjb25zdCBzdXBhYmFzZVVybE9iaiA9IG5ldyBVUkwoc3VwYWJhc2VVcmwpO1xuICAgIGNvbnN0IHByb2plY3RSZWYgPSBzdXBhYmFzZVVybE9iai5ob3N0bmFtZS5zcGxpdCgnLicpWzBdO1xuICAgIFxuICAgIC8vIExvb2sgZm9yIFN1cGFiYXNlIGF1dGggdG9rZW4gY29va2llXG4gICAgLy8gVHJ5IHNiLWFwaS1hdXRoLXRva2VuIGZpcnN0IGFzIGl0J3MgdGhlIG1vc3QgY29tbW9uXG4gICAgY29uc3QgYXV0aENvb2tpZU5hbWVzID0gW1xuICAgICAgYHNiLWFwaS1hdXRoLXRva2VuYCxcbiAgICAgIGBzYi0ke3Byb2plY3RSZWZ9LWF1dGgtdG9rZW5gLFxuICAgIF07XG4gICAgXG4gICAgbGV0IGFjY2Vzc1Rva2VuOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgZm9yIChjb25zdCBjb29raWVOYW1lIG9mIGF1dGhDb29raWVOYW1lcykge1xuICAgICAgY29uc3QgY29va2llID0gY29va2llU3RvcmUuZ2V0KGNvb2tpZU5hbWUpO1xuICAgICAgaWYgKGNvb2tpZT8udmFsdWUpIHtcbiAgICAgICAgLy8gTG9nIGZpcnN0IDEwMCBjaGFycyB0byBzZWUgZm9ybWF0ICh3aXRob3V0IGV4cG9zaW5nIGZ1bGwgdG9rZW4pXG4gICAgICAgIGNvbnN0IHByZXZpZXcgPSBjb29raWUudmFsdWUuc3Vic3RyaW5nKDAsIDEwMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbY3JlYXRlU2VydmVyQ2xpZW50XSBDaGVja2luZyBjb29raWU6ICR7Y29va2llTmFtZX0sIGxlbmd0aDogJHtjb29raWUudmFsdWUubGVuZ3RofSwgcHJldmlldzogJHtwcmV2aWV3fS4uLmApO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFRyeSBVUkwgZGVjb2RpbmcgZmlyc3RcbiAgICAgICAgICBsZXQgZGVjb2RlZFZhbHVlID0gY29va2llLnZhbHVlO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkZWNvZGVkVmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQoY29va2llLnZhbHVlKTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIC8vIE5vdCBVUkwgZW5jb2RlZFxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBUcnkgcGFyc2luZyBhcyBKU09OXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBKU09OLnBhcnNlKGRlY29kZWRWYWx1ZSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gUGFyc2VkICR7Y29va2llTmFtZX0gYXMgSlNPTiwgdHlwZTpgLCBBcnJheS5pc0FycmF5KHNlc3Npb24pID8gJ2FycmF5JyA6IHR5cGVvZiBzZXNzaW9uLCAna2V5czonLCBPYmplY3Qua2V5cyhzZXNzaW9uIHx8IHt9KSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYW4gYXJyYXkgKFN1cGFiYXNlIHNvbWV0aW1lcyBzdG9yZXMgdG9rZW5zIGFzIGFycmF5KVxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2Vzc2lvbikgJiYgc2Vzc2lvbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbY3JlYXRlU2VydmVyQ2xpZW50XSBBcnJheSBoYXMgJHtzZXNzaW9uLmxlbmd0aH0gZWxlbWVudHMsIGNoZWNraW5nIGVhY2guLi5gKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIC8vIFRyeSBlYWNoIGVsZW1lbnQgdG8gZmluZCBhIHZhbGlkIEpXVFxuICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlc3Npb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc2Vzc2lvbltpXTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYW55IHF1b3RlcyBvciBleHRyYSBjaGFyYWN0ZXJzXG4gICAgICAgICAgICAgICAgICBsZXQgY2xlYW5Ub2tlbiA9IGVsZW1lbnQudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgaWYgKChjbGVhblRva2VuLnN0YXJ0c1dpdGgoJ1wiJykgJiYgY2xlYW5Ub2tlbi5lbmRzV2l0aCgnXCInKSkgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgKGNsZWFuVG9rZW4uc3RhcnRzV2l0aChcIidcIikgJiYgY2xlYW5Ub2tlbi5lbmRzV2l0aChcIidcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFuVG9rZW4gPSBjbGVhblRva2VuLnNsaWNlKDEsIC0xKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQgbG9va3MgbGlrZSBhIEpXVCAoaGFzIDMgcGFydHMgc2VwYXJhdGVkIGJ5IGRvdHMpXG4gICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGNsZWFuVG9rZW4uc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMgJiYgY2xlYW5Ub2tlbi5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtjcmVhdGVTZXJ2ZXJDbGllbnRdIEZvdW5kIHZhbGlkIEpXVCBzdHJ1Y3R1cmUgaW4gZWxlbWVudCAke2l9LCB1c2luZyBpdCBhcyBhY2Nlc3MgdG9rZW5gKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoaXMgdG9rZW4gLSBldmVuIGlmIHNpZ25hdHVyZSB2YWxpZGF0aW9uIGZhaWxzIGxhdGVyLCBcbiAgICAgICAgICAgICAgICAgICAgLy8gU3VwYWJhc2UgbWlnaHQgc3RpbGwgYWNjZXB0IGl0IGZvciBSTFMgaWYgdGhlIHBheWxvYWQgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBjbGVhblRva2VuO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gSWYgZWxlbWVudCBpcyBhbiBvYmplY3QsIGNoZWNrIGZvciBhY2Nlc3NfdG9rZW5cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCAmJiB0eXBlb2YgZWxlbWVudCA9PT0gJ29iamVjdCcgJiYgZWxlbWVudC5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbY3JlYXRlU2VydmVyQ2xpZW50XSBGb3VuZCBhY2Nlc3NfdG9rZW4gaW4gZWxlbWVudCAke2l9OiAke2Nvb2tpZU5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IGVsZW1lbnQuYWNjZXNzX3Rva2VuO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gSWYgbm8gc2luZ2xlIGVsZW1lbnQgd29ya3MsIHRyeSBqb2luaW5nIGFsbCBzdHJpbmcgZWxlbWVudHNcbiAgICAgICAgICAgICAgY29uc3QgYWxsU3RyaW5ncyA9IHNlc3Npb24uZmlsdGVyKGUgPT4gdHlwZW9mIGUgPT09ICdzdHJpbmcnKTtcbiAgICAgICAgICAgICAgaWYgKGFsbFN0cmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGpvaW5lZCA9IGFsbFN0cmluZ3Muam9pbignJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBqb2luZWQuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzICYmIGpvaW5lZC5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbY3JlYXRlU2VydmVyQ2xpZW50XSBGb3VuZCBKV1QgYnkgam9pbmluZyBhcnJheSBlbGVtZW50cycpO1xuICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBqb2luZWQ7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHNlc3Npb24/LmFjY2Vzc190b2tlbikge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gRm91bmQgYWNjZXNzX3Rva2VuIGluICR7Y29va2llTmFtZX1gKTtcbiAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBzZXNzaW9uLmFjY2Vzc190b2tlbjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIGZvciBuZXN0ZWQgc2Vzc2lvbiBvYmplY3RcbiAgICAgICAgICAgIGlmIChzZXNzaW9uPy5zZXNzaW9uPy5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtjcmVhdGVTZXJ2ZXJDbGllbnRdIEZvdW5kIGFjY2Vzc190b2tlbiBpbiBuZXN0ZWQgc2Vzc2lvbjogJHtjb29raWVOYW1lfWApO1xuICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IHNlc3Npb24uc2Vzc2lvbi5hY2Nlc3NfdG9rZW47XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgICAgIC8vIE5vdCBKU09OLCBtaWdodCBiZSBkaXJlY3QgSldUIHRva2VuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gJHtjb29raWVOYW1lfSBpcyBub3QgSlNPTiwgY2hlY2tpbmcgaWYgSldUYCk7XG4gICAgICAgICAgICBpZiAoZGVjb2RlZFZhbHVlLmxlbmd0aCA+IDEwMCAmJiBkZWNvZGVkVmFsdWUuaW5jbHVkZXMoJy4nKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gVXNpbmcgJHtjb29raWVOYW1lfSBhcyBkaXJlY3QgSldUIHRva2VuYCk7XG4gICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gZGVjb2RlZFZhbHVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgW2NyZWF0ZVNlcnZlckNsaWVudF0gRXJyb3IgcHJvY2Vzc2luZyAke2Nvb2tpZU5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBJZiB3ZSBmb3VuZCBhbiBhY2Nlc3MgdG9rZW4sIHVzZSBpdCBkaXJlY3RseVxuICAgIGlmIChhY2Nlc3NUb2tlbiAmJiBzdXBhYmFzZUFub25LZXkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgICBnbG9iYWw6IHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBhdXRoOiB7XG4gICAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEZhbGxiYWNrOiBCdWlsZCBjb29raWUgaGVhZGVyIGZvciBTdXBhYmFzZSB0byByZWFkXG4gICAgY29uc3QgY29va2llSGVhZGVyID0gYWxsQ29va2llcy5tYXAoYyA9PiBgJHtjLm5hbWV9PSR7Yy52YWx1ZX1gKS5qb2luKCc7ICcpO1xuICAgIFxuICAgIGlmIChjb29raWVIZWFkZXIgJiYgc3VwYWJhc2VBbm9uS2V5KSB7XG4gICAgICAvLyBDcmVhdGUgY2xpZW50IHdpdGggY29va2llcyAtIFN1cGFiYXNlIHdpbGwgZXh0cmFjdCBzZXNzaW9uIGZyb20gY29va2llc1xuICAgICAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgICAgIGdsb2JhbDoge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIENvb2tpZTogY29va2llSGVhZGVyLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGF1dGg6IHtcbiAgICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsIC8vIFdlJ3JlIGhhbmRsaW5nIGNvb2tpZXMgbWFudWFsbHlcbiAgICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWFkaW5nIGNvb2tpZXMgaW4gY3JlYXRlU2VydmVyQ2xpZW50OicsIGVycm9yKTtcbiAgICAvLyBOb3QgaW4gYSBjb29raWVzIGNvbnRleHQsIGNvbnRpbnVlXG4gIH1cblxuICAvLyBGb3IgcHVibGljIHJvdXRlcyBvciBiYWNrZ3JvdW5kIGpvYnMsIHVzZSBzZXJ2aWNlIHJvbGUga2V5XG4gIC8vIFdBUk5JTkc6IFRoaXMgYnlwYXNzZXMgUkxTIC0gb25seSB1c2Ugd2hlbiBuZWNlc3NhcnlcbiAgaWYgKHN1cGFiYXNlU2VydmljZUtleSkge1xuICAgIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSwge1xuICAgICAgYXV0aDoge1xuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEZhbGxiYWNrIHRvIGFub24ga2V5IChmb3IgcHVibGljIHJlYWQgb3BlcmF0aW9ucylcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5ISk7XG59XG5cbi8qKlxuICogR2V0IFN1cGFiYXNlIGNsaWVudCB3aXRoIHNlcnZpY2Ugcm9sZSAoYnlwYXNzZXMgUkxTKVxuICogXG4gKiBVc2UgdGhpcyBPTkxZIGZvcjpcbiAqIC0gQmFja2dyb3VuZCBqb2JzXG4gKiAtIFdlYmhvb2sgaGFuZGxlcnNcbiAqIC0gQWRtaW4gb3BlcmF0aW9ucyB0aGF0IG5lZWQgdG8gYnlwYXNzIFJMU1xuICogXG4gKiBVc2FnZTpcbiAqIGBgYHRzXG4gKiBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUFkbWluQ2xpZW50KCk7XG4gKiBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ2J1c2luZXNzZXMnKS5zZWxlY3QoJyonKTtcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQWRtaW5DbGllbnQoKTogU3VwYWJhc2VDbGllbnQge1xuICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcblxuICBpZiAoIXN1cGFiYXNlVXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xuICB9XG5cbiAgaWYgKCFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xuICB9XG5cbiAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XG4gICAgYXV0aDoge1xuICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsXG4gICAgfSxcbiAgfSk7XG59XG5cbi8qKlxuICogR2V0IFN1cGFiYXNlIGNsaWVudCBmb3IgY2xpZW50LXNpZGUgb3BlcmF0aW9uc1xuICogXG4gKiBUaGlzIHNob3VsZCBiZSB1c2VkIGluIFJlYWN0IGNvbXBvbmVudHMgb3IgY2xpZW50LXNpZGUgY29kZS5cbiAqIEl0IHVzZXMgdGhlIGFub24ga2V5IGFuZCByZWxpZXMgb24gU3VwYWJhc2UgQXV0aCBmb3IgYXV0aGVudGljYXRpb24uXG4gKiBcbiAqIFVzYWdlIGluIGNsaWVudCBjb21wb25lbnRzOlxuICogYGBgdHNcbiAqICd1c2UgY2xpZW50JztcbiAqIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50Q2xpZW50KCk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNsaWVudENsaWVudCgpOiBTdXBhYmFzZUNsaWVudCB7XG4gIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuICBjb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTtcblxuICBpZiAoIXN1cGFiYXNlVXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xuICB9XG5cbiAgaWYgKCFzdXBhYmFzZUFub25LZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgZW52aXJvbm1lbnQgdmFyaWFibGUnKTtcbiAgfVxuXG4gIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG59XG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjb29raWVzIiwiaGVhZGVycyIsImNyZWF0ZVNlcnZlckNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwiYWNjZXNzVG9rZW4iLCJoZWFkZXJzTGlzdCIsImF1dGhIZWFkZXIiLCJnZXQiLCJzdGFydHNXaXRoIiwic3Vic3RyaW5nIiwiZ2xvYmFsIiwiQXV0aG9yaXphdGlvbiIsImNvb2tpZVN0b3JlIiwiYWxsQ29va2llcyIsImdldEFsbCIsInN1cGFiYXNlVXJsT2JqIiwiVVJMIiwicHJvamVjdFJlZiIsImhvc3RuYW1lIiwic3BsaXQiLCJhdXRoQ29va2llTmFtZXMiLCJjb29raWVOYW1lIiwiY29va2llIiwidmFsdWUiLCJwcmV2aWV3IiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsImRlY29kZWRWYWx1ZSIsImRlY29kZVVSSUNvbXBvbmVudCIsInNlc3Npb24iLCJKU09OIiwicGFyc2UiLCJBcnJheSIsImlzQXJyYXkiLCJPYmplY3QiLCJrZXlzIiwiaSIsImVsZW1lbnQiLCJjbGVhblRva2VuIiwidHJpbSIsImVuZHNXaXRoIiwic2xpY2UiLCJwYXJ0cyIsImFjY2Vzc190b2tlbiIsImFsbFN0cmluZ3MiLCJmaWx0ZXIiLCJlIiwiam9pbmVkIiwiam9pbiIsInBhcnNlRXJyb3IiLCJpbmNsdWRlcyIsImVycm9yIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImNvb2tpZUhlYWRlciIsIm1hcCIsImMiLCJuYW1lIiwiQ29va2llIiwiY3JlYXRlQWRtaW5DbGllbnQiLCJjcmVhdGVDbGllbnRDbGllbnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/notifications.ts":
/*!**********************************!*\
  !*** ./src/lib/notifications.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ALLOWED_PLACEHOLDERS: () => (/* binding */ ALLOWED_PLACEHOLDERS),\n/* harmony export */   createNotificationFromTemplate: () => (/* binding */ createNotificationFromTemplate),\n/* harmony export */   emitNotification: () => (/* binding */ emitNotification),\n/* harmony export */   enqueueNotification: () => (/* binding */ enqueueNotification),\n/* harmony export */   loadTemplateForTrigger: () => (/* binding */ loadTemplateForTrigger),\n/* harmony export */   renderTemplate: () => (/* binding */ renderTemplate),\n/* harmony export */   validatePlaceholders: () => (/* binding */ validatePlaceholders)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(rsc)/./src/lib/db.ts\");\n/* harmony import */ var _timezone__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./timezone */ \"(rsc)/./src/lib/timezone.ts\");\n\n\n// Allowed placeholders per the spec\nconst ALLOWED_PLACEHOLDERS = [\n    \"customer.name\",\n    \"customer.email\",\n    \"customer.phone\",\n    \"service.name\",\n    \"service.duration\",\n    \"service.price\",\n    \"staff.name\",\n    \"booking.code\",\n    \"booking.date\",\n    \"booking.time\",\n    \"booking.amount\",\n    \"business.name\",\n    \"business.phone\",\n    \"business.support_email\",\n    \"booking.url\"\n];\n/**\n * Validate that template only contains allowed placeholders\n */ function validatePlaceholders(template) {\n    const placeholderRegex = /\\$\\{([^}]+)\\}/g;\n    const matches = Array.from(template.matchAll(placeholderRegex));\n    const foundPlaceholders = matches.map((m)=>m[1]);\n    const invalid = foundPlaceholders.filter((p)=>!ALLOWED_PLACEHOLDERS.includes(p));\n    return {\n        valid: invalid.length === 0,\n        invalid\n    };\n}\n/**\n * Render a notification template by substituting placeholders\n * Supports timezone-aware date/time formatting\n */ function renderTemplate(template, data, timezone) {\n    let rendered = template;\n    const tz = timezone || data.business?.timezone || \"America/New_York\";\n    // Replace placeholders with actual values\n    if (data.customer) {\n        rendered = rendered.replace(/\\$\\{customer\\.name\\}/g, data.customer.name || \"\");\n        rendered = rendered.replace(/\\$\\{customer\\.email\\}/g, data.customer.email || \"\");\n        rendered = rendered.replace(/\\$\\{customer\\.phone\\}/g, data.customer.phone || \"\");\n    }\n    if (data.service) {\n        rendered = rendered.replace(/\\$\\{service\\.name\\}/g, data.service.name || \"\");\n        rendered = rendered.replace(/\\$\\{service\\.duration\\}/g, String(data.service.duration_min || 0));\n        rendered = rendered.replace(/\\$\\{service\\.price\\}/g, formatPrice(data.service.price_cents || 0));\n    }\n    if (data.staff) {\n        rendered = rendered.replace(/\\$\\{staff\\.name\\}/g, data.staff.name || \"\");\n    }\n    if (data.booking) {\n        const startDate = new Date(data.booking.start_at);\n        rendered = rendered.replace(/\\$\\{booking\\.date\\}/g, formatDate(startDate, tz));\n        rendered = rendered.replace(/\\$\\{booking\\.time\\}/g, formatTime(startDate, tz));\n        rendered = rendered.replace(/\\$\\{booking\\.code\\}/g, `TITHI-${data.booking.id?.slice(0, 8).toUpperCase() || \"\"}`);\n        // booking.amount uses final_price_cents if available, otherwise price_cents\n        const amount = data.booking.final_price_cents ?? data.booking.price_cents ?? 0;\n        rendered = rendered.replace(/\\$\\{booking\\.amount\\}/g, formatPrice(amount));\n    }\n    if (data.business) {\n        rendered = rendered.replace(/\\$\\{business\\.name\\}/g, data.business.name || \"\");\n        rendered = rendered.replace(/\\$\\{business\\.support_email\\}/g, data.business.support_email || \"\");\n        rendered = rendered.replace(/\\$\\{business\\.phone\\}/g, data.business.phone || \"\");\n    }\n    if (data.booking_url) {\n        rendered = rendered.replace(/\\$\\{booking\\.url\\}/g, data.booking_url);\n    } else if (data.business?.subdomain) {\n        // Generate booking URL if not provided\n        const bookingCode = data.booking?.id ? `TITHI-${data.booking.id.slice(0, 8).toUpperCase()}` : \"\";\n        const url = `https://${data.business.subdomain}.tithi.com/confirm/${bookingCode}`;\n        rendered = rendered.replace(/\\$\\{booking\\.url\\}/g, url);\n    }\n    // Handle amount placeholder for fee_charged and refunded\n    if (data.amount !== undefined) {\n        rendered = rendered.replace(/\\$\\{amount\\}/g, formatPrice(data.amount));\n    }\n    return rendered;\n}\n/**\n * Enqueue a notification job\n * Uses unique constraint to prevent duplicate sends\n */ async function enqueueNotification(params) {\n    const supabase = (0,_db__WEBPACK_IMPORTED_MODULE_0__.createAdminClient)(); // Use admin client to bypass RLS for job insertion\n    // Check for existing job with same booking_id, trigger, and channel (idempotency)\n    if (params.bookingId) {\n        const { data: existing } = await supabase.from(\"notification_jobs\").select(\"id\").eq(\"booking_id\", params.bookingId).eq(\"trigger\", params.trigger).eq(\"channel\", params.channel).limit(1).single();\n        if (existing) {\n            // Job already exists, skip\n            return;\n        }\n    }\n    const now = new Date().toISOString();\n    const { error } = await supabase.from(\"notification_jobs\").insert({\n        user_id: params.userId,\n        business_id: params.businessId,\n        booking_id: params.bookingId || null,\n        template_id: params.templateId || null,\n        recipient_email: params.recipientEmail || null,\n        recipient_phone: params.recipientPhone || null,\n        subject: params.subject || null,\n        body: params.body,\n        channel: params.channel,\n        trigger: params.trigger,\n        status: \"pending\",\n        attempt_count: 0,\n        scheduled_at: now,\n        next_retry_at: null,\n        created_at: now\n    });\n    if (error) {\n        // If unique constraint violation, that's okay (idempotency)\n        if (error.code === \"23505\") {\n            return;\n        }\n        console.error(\"Error enqueueing notification:\", error);\n        throw error;\n    }\n}\n/**\n * Load notification template for a trigger\n */ async function loadTemplateForTrigger(businessId, userId, trigger, channel, supabase) {\n    const client = supabase || (0,_db__WEBPACK_IMPORTED_MODULE_0__.createAdminClient)();\n    const { data: template, error } = await client.from(\"notification_templates\").select(\"*\").eq(\"business_id\", businessId).eq(\"user_id\", userId).eq(\"trigger\", trigger).eq(\"channel\", channel).eq(\"is_enabled\", true).is(\"deleted_at\", null).order(\"created_at\", {\n        ascending: false\n    }).limit(1).maybeSingle();\n    if (error && error.code !== \"PGRST116\") {\n        console.error(\"Error loading template:\", error);\n        return null;\n    }\n    return template;\n}\n/**\n * Main function to emit a notification event\n * This loads booking data, resolves templates, and enqueues jobs\n * \n * @param amount Optional amount in cents for fee_charged and refunded triggers\n */ async function emitNotification(businessId, trigger, bookingId, supabase, amount) {\n    // Check feature flag first - if notifications feature is disabled globally, skip all notifications\n    const { getEffectiveNotificationsEnabled } = await __webpack_require__.e(/*! import() */ \"_rsc_src_lib_feature-flags_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ./feature-flags */ \"(rsc)/./src/lib/feature-flags.ts\"));\n    if (!getEffectiveNotificationsEnabled()) {\n        console.log(`Skipping notification for business ${businessId} - Notifications feature disabled (v2)`);\n        return;\n    }\n    const client = supabase || (0,_db__WEBPACK_IMPORTED_MODULE_0__.createAdminClient)();\n    // Check if notifications are enabled for this business\n    const { data: business } = await client.from(\"businesses\").select(\"id, user_id, name, support_email, phone, subdomain, timezone, notifications_enabled\").eq(\"id\", businessId).single();\n    if (!business) {\n        console.error(`Business ${businessId} not found`);\n        return;\n    }\n    // If notifications are disabled (Basic Plan), skip sending notifications\n    // Basic Plan accounts only show booking confirmations, no SMS/email notifications\n    if (business.notifications_enabled === false) {\n        console.log(`Skipping notification for business ${businessId} - Basic Plan (notifications disabled)`);\n        return;\n    }\n    const userId = business.user_id;\n    // Load complete booking data with all relations\n    const { data: booking, error: bookingError } = await client.from(\"bookings\").select(`\n      *,\n      customers:customer_id (\n        id,\n        name,\n        email,\n        phone\n      ),\n      services:service_id (\n        id,\n        name,\n        duration_min,\n        price_cents\n      ),\n      staff:staff_id (\n        id,\n        name\n      )\n    `).eq(\"id\", bookingId).eq(\"business_id\", businessId).is(\"deleted_at\", null).single();\n    if (bookingError || !booking) {\n        console.error(`Booking ${bookingId} not found:`, bookingError);\n        return;\n    }\n    // For fee_charged and refunded, load the latest payment amount if not provided\n    let feeAmount = amount;\n    if ((trigger === \"fee_charged\" || trigger === \"refunded\") && feeAmount === undefined) {\n        const { data: latestPayment } = await client.from(\"booking_payments\").select(\"amount_cents\").eq(\"booking_id\", bookingId).in(\"money_action\", trigger === \"fee_charged\" ? [\n            \"no_show_fee\",\n            \"cancel_fee\"\n        ] : [\n            \"refund\"\n        ]).order(\"created_at\", {\n            ascending: false\n        }).limit(1).maybeSingle();\n        if (latestPayment) {\n            feeAmount = latestPayment.amount_cents;\n        }\n    }\n    // Build notification data\n    const notificationData = {\n        booking: {\n            id: booking.id,\n            start_at: booking.start_at,\n            end_at: booking.end_at,\n            final_price_cents: booking.final_price_cents,\n            price_cents: booking.price_cents,\n            staff_id: booking.staff_id,\n            status: booking.status\n        },\n        customer: booking.customers ? {\n            name: booking.customers.name,\n            email: booking.customers.email,\n            phone: booking.customers.phone || undefined\n        } : undefined,\n        service: booking.services ? {\n            name: booking.services.name,\n            duration_min: booking.services.duration_min,\n            price_cents: booking.services.price_cents\n        } : undefined,\n        staff: booking.staff ? {\n            name: booking.staff.name\n        } : undefined,\n        business: {\n            name: business.name,\n            support_email: business.support_email || undefined,\n            phone: business.phone || undefined,\n            subdomain: business.subdomain || undefined,\n            timezone: business.timezone || \"America/New_York\"\n        },\n        booking_url: business.subdomain ? `https://${business.subdomain}.tithi.com/confirm/TITHI-${booking.id.slice(0, 8).toUpperCase()}` : undefined,\n        amount: feeAmount\n    };\n    // Load templates for this trigger\n    // NOTE: SMS notifications disabled for v1 - only email notifications are enabled\n    const emailTemplate = await loadTemplateForTrigger(businessId, userId, trigger, \"email\", client);\n    // const smsTemplate = await loadTemplateForTrigger(businessId, userId, trigger, 'sms', client); // Disabled for v1\n    const timezone = business.timezone || \"America/New_York\";\n    // Log if template is missing (for debugging)\n    if (!emailTemplate) {\n        console.log(`[notifications] No email template found for business ${businessId}, trigger ${trigger}. Email will not be sent.`);\n    }\n    // Enqueue email notification if template exists and customer has email\n    if (emailTemplate && notificationData.customer?.email) {\n        console.log(`[notifications] Enqueueing email notification for booking ${bookingId} to ${notificationData.customer.email}`);\n        const renderedBody = renderTemplate(emailTemplate.body_markdown, notificationData, timezone);\n        const renderedSubject = emailTemplate.subject ? renderTemplate(emailTemplate.subject, notificationData, timezone) : undefined;\n        await enqueueNotification({\n            businessId,\n            userId,\n            bookingId,\n            trigger,\n            recipientEmail: notificationData.customer.email,\n            templateId: emailTemplate.id,\n            subject: renderedSubject,\n            body: renderedBody,\n            channel: \"email\"\n        });\n    }\n// SMS notifications disabled for v1 - will be enabled in v2\n// Enqueue SMS notification if template exists and customer has phone\n// if (smsTemplate && notificationData.customer?.phone) {\n//   const renderedBody = renderTemplate(smsTemplate.body_markdown, notificationData, timezone);\n//\n//   await enqueueNotification({\n//     businessId,\n//     userId,\n//     bookingId,\n//     trigger,\n//     recipientPhone: notificationData.customer.phone,\n//     templateId: smsTemplate.id,\n//     body: renderedBody,\n//     channel: 'sms',\n//   });\n// }\n}\n/**\n * Create notification job from template and data (legacy function, use emitNotification)\n */ async function createNotificationFromTemplate(params) {\n    const { businessId, userId, bookingId, trigger, data } = params;\n    if (!bookingId) {\n        console.error(\"createNotificationFromTemplate requires bookingId\");\n        return;\n    }\n    // Use the main emitNotification function\n    await emitNotification(businessId, trigger, bookingId);\n}\n// Helper functions\nfunction formatDate(date, timezone) {\n    return (0,_timezone__WEBPACK_IMPORTED_MODULE_1__.formatInTimeZone)(date.toISOString(), timezone, {\n        weekday: \"long\",\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\"\n    });\n}\nfunction formatTime(date, timezone) {\n    return (0,_timezone__WEBPACK_IMPORTED_MODULE_1__.formatInTimeZone)(date.toISOString(), timezone, {\n        hour: \"numeric\",\n        minute: \"2-digit\",\n        hour12: true\n    });\n}\nfunction formatPrice(cents) {\n    return `$${(cents / 100).toFixed(2)}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FBR2tDO0lBRXpELElBQUksQ0FBQ0UsV0FBVztRQUNkK0IsUUFBUXJCLEtBQUssQ0FBQztRQUNkO0lBQ0Y7SUFFQSx5Q0FBeUM7SUFDekMsTUFBTTRCLGlCQUFpQnZCLFlBQVlYLFNBQVNKO0FBQzlDO0FBRUEsbUJBQW1CO0FBQ25CLFNBQVNoQixXQUFXeUUsSUFBVSxFQUFFNUYsUUFBZ0I7SUFDOUMsT0FBT3BCLDJEQUFnQkEsQ0FBQ2dILEtBQUtoRCxXQUFXLElBQUk1QyxVQUFVO1FBQ3BENkYsU0FBUztRQUNUQyxNQUFNO1FBQ05DLE9BQU87UUFDUEMsS0FBSztJQUNQO0FBQ0Y7QUFFQSxTQUFTNUUsV0FBV3dFLElBQVUsRUFBRTVGLFFBQWdCO0lBQzlDLE9BQU9wQiwyREFBZ0JBLENBQUNnSCxLQUFLaEQsV0FBVyxJQUFJNUMsVUFBVTtRQUNwRGlHLE1BQU07UUFDTkMsUUFBUTtRQUNSQyxRQUFRO0lBQ1Y7QUFDRjtBQUVBLFNBQVN2RixZQUFZd0YsS0FBYTtJQUNoQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUNBLFFBQVEsR0FBRSxFQUFHQyxPQUFPLENBQUMsR0FBRyxDQUFDO0FBQ3ZDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4vc3JjL2xpYi9ub3RpZmljYXRpb25zLnRzPzgyZTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50LCBjcmVhdGVBZG1pbkNsaWVudCB9IGZyb20gJy4vZGInO1xuaW1wb3J0IHsgZm9ybWF0SW5UaW1lWm9uZSB9IGZyb20gJy4vdGltZXpvbmUnO1xuaW1wb3J0IHR5cGUgeyBTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbmV4cG9ydCB0eXBlIE5vdGlmaWNhdGlvblRyaWdnZXIgPSBcbiAgfCAnYm9va2luZ19jcmVhdGVkJ1xuICB8ICdib29raW5nX2NvbmZpcm1lZCdcbiAgfCAncmVtaW5kZXJfMjRoJ1xuICB8ICdyZW1pbmRlcl8xaCdcbiAgfCAnYm9va2luZ19jYW5jZWxsZWQnXG4gIHwgJ2Jvb2tpbmdfcmVzY2hlZHVsZWQnXG4gIHwgJ2Jvb2tpbmdfY29tcGxldGVkJ1xuICB8ICdmZWVfY2hhcmdlZCdcbiAgfCAncmVmdW5kZWQnXG4gIHwgJ3BheW1lbnRfaXNzdWUnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5vdGlmaWNhdGlvbkRhdGEge1xuICBib29raW5nPzoge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgc3RhcnRfYXQ6IHN0cmluZztcbiAgICBlbmRfYXQ/OiBzdHJpbmc7XG4gICAgZmluYWxfcHJpY2VfY2VudHM/OiBudW1iZXI7XG4gICAgcHJpY2VfY2VudHM/OiBudW1iZXI7XG4gICAgc3RhZmZfaWQ/OiBzdHJpbmc7XG4gICAgc3RhdHVzPzogc3RyaW5nO1xuICB9O1xuICBjdXN0b21lcj86IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICBwaG9uZT86IHN0cmluZztcbiAgfTtcbiAgc2VydmljZT86IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZHVyYXRpb25fbWluOiBudW1iZXI7XG4gICAgcHJpY2VfY2VudHM6IG51bWJlcjtcbiAgfTtcbiAgc3RhZmY/OiB7XG4gICAgbmFtZTogc3RyaW5nO1xuICB9O1xuICBidXNpbmVzcz86IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgc3VwcG9ydF9lbWFpbD86IHN0cmluZztcbiAgICBwaG9uZT86IHN0cmluZztcbiAgICBzdWJkb21haW4/OiBzdHJpbmc7XG4gICAgdGltZXpvbmU/OiBzdHJpbmc7XG4gIH07XG4gIGJvb2tpbmdfdXJsPzogc3RyaW5nO1xuICBhbW91bnQ/OiBudW1iZXI7IC8vIEZvciBmZWVfY2hhcmdlZCBhbmQgcmVmdW5kZWQgdHJpZ2dlcnNcbn1cblxuLy8gQWxsb3dlZCBwbGFjZWhvbGRlcnMgcGVyIHRoZSBzcGVjXG5leHBvcnQgY29uc3QgQUxMT1dFRF9QTEFDRUhPTERFUlMgPSBbXG4gICdjdXN0b21lci5uYW1lJyxcbiAgJ2N1c3RvbWVyLmVtYWlsJyxcbiAgJ2N1c3RvbWVyLnBob25lJyxcbiAgJ3NlcnZpY2UubmFtZScsXG4gICdzZXJ2aWNlLmR1cmF0aW9uJyxcbiAgJ3NlcnZpY2UucHJpY2UnLFxuICAnc3RhZmYubmFtZScsXG4gICdib29raW5nLmNvZGUnLFxuICAnYm9va2luZy5kYXRlJyxcbiAgJ2Jvb2tpbmcudGltZScsXG4gICdib29raW5nLmFtb3VudCcsXG4gICdidXNpbmVzcy5uYW1lJyxcbiAgJ2J1c2luZXNzLnBob25lJyxcbiAgJ2J1c2luZXNzLnN1cHBvcnRfZW1haWwnLFxuICAnYm9va2luZy51cmwnLFxuXTtcblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IHRlbXBsYXRlIG9ubHkgY29udGFpbnMgYWxsb3dlZCBwbGFjZWhvbGRlcnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGxhY2Vob2xkZXJzKHRlbXBsYXRlOiBzdHJpbmcpOiB7IHZhbGlkOiBib29sZWFuOyBpbnZhbGlkOiBzdHJpbmdbXSB9IHtcbiAgY29uc3QgcGxhY2Vob2xkZXJSZWdleCA9IC9cXCRcXHsoW159XSspXFx9L2c7XG4gIGNvbnN0IG1hdGNoZXMgPSBBcnJheS5mcm9tKHRlbXBsYXRlLm1hdGNoQWxsKHBsYWNlaG9sZGVyUmVnZXgpKTtcbiAgY29uc3QgZm91bmRQbGFjZWhvbGRlcnMgPSBtYXRjaGVzLm1hcChtID0+IG1bMV0pO1xuICBjb25zdCBpbnZhbGlkID0gZm91bmRQbGFjZWhvbGRlcnMuZmlsdGVyKHAgPT4gIUFMTE9XRURfUExBQ0VIT0xERVJTLmluY2x1ZGVzKHApKTtcbiAgXG4gIHJldHVybiB7XG4gICAgdmFsaWQ6IGludmFsaWQubGVuZ3RoID09PSAwLFxuICAgIGludmFsaWQsXG4gIH07XG59XG5cbi8qKlxuICogUmVuZGVyIGEgbm90aWZpY2F0aW9uIHRlbXBsYXRlIGJ5IHN1YnN0aXR1dGluZyBwbGFjZWhvbGRlcnNcbiAqIFN1cHBvcnRzIHRpbWV6b25lLWF3YXJlIGRhdGUvdGltZSBmb3JtYXR0aW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJUZW1wbGF0ZSh0ZW1wbGF0ZTogc3RyaW5nLCBkYXRhOiBOb3RpZmljYXRpb25EYXRhLCB0aW1lem9uZT86IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCByZW5kZXJlZCA9IHRlbXBsYXRlO1xuICBjb25zdCB0eiA9IHRpbWV6b25lIHx8IGRhdGEuYnVzaW5lc3M/LnRpbWV6b25lIHx8ICdBbWVyaWNhL05ld19Zb3JrJztcblxuICAvLyBSZXBsYWNlIHBsYWNlaG9sZGVycyB3aXRoIGFjdHVhbCB2YWx1ZXNcbiAgaWYgKGRhdGEuY3VzdG9tZXIpIHtcbiAgICByZW5kZXJlZCA9IHJlbmRlcmVkLnJlcGxhY2UoL1xcJFxce2N1c3RvbWVyXFwubmFtZVxcfS9nLCBkYXRhLmN1c3RvbWVyLm5hbWUgfHwgJycpO1xuICAgIHJlbmRlcmVkID0gcmVuZGVyZWQucmVwbGFjZSgvXFwkXFx7Y3VzdG9tZXJcXC5lbWFpbFxcfS9nLCBkYXRhLmN1c3RvbWVyLmVtYWlsIHx8ICcnKTtcbiAgICByZW5kZXJlZCA9IHJlbmRlcmVkLnJlcGxhY2UoL1xcJFxce2N1c3RvbWVyXFwucGhvbmVcXH0vZywgZGF0YS5jdXN0b21lci5waG9uZSB8fCAnJyk7XG4gIH1cblxuICBpZiAoZGF0YS5zZXJ2aWNlKSB7XG4gICAgcmVuZGVyZWQgPSByZW5kZXJlZC5yZXBsYWNlKC9cXCRcXHtzZXJ2aWNlXFwubmFtZVxcfS9nLCBkYXRhLnNlcnZpY2UubmFtZSB8fCAnJyk7XG4gICAgcmVuZGVyZWQgPSByZW5kZXJlZC5yZXBsYWNlKC9cXCRcXHtzZXJ2aWNlXFwuZHVyYXRpb25cXH0vZywgU3RyaW5nKGRhdGEuc2VydmljZS5kdXJhdGlvbl9taW4gfHwgMCkpO1xuICAgIHJlbmRlcmVkID0gcmVuZGVyZWQucmVwbGFjZSgvXFwkXFx7c2VydmljZVxcLnByaWNlXFx9L2csIGZvcm1hdFByaWNlKGRhdGEuc2VydmljZS5wcmljZV9jZW50cyB8fCAwKSk7XG4gIH1cblxuICBpZiAoZGF0YS5zdGFmZikge1xuICAgIHJlbmRlcmVkID0gcmVuZGVyZWQucmVwbGFjZSgvXFwkXFx7c3RhZmZcXC5uYW1lXFx9L2csIGRhdGEuc3RhZmYubmFtZSB8fCAnJyk7XG4gIH1cblxuICBpZiAoZGF0YS5ib29raW5nKSB7XG4gICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoZGF0YS5ib29raW5nLnN0YXJ0X2F0KTtcbiAgICByZW5kZXJlZCA9IHJlbmRlcmVkLnJlcGxhY2UoL1xcJFxce2Jvb2tpbmdcXC5kYXRlXFx9L2csIGZvcm1hdERhdGUoc3RhcnREYXRlLCB0eikpO1xuICAgIHJlbmRlcmVkID0gcmVuZGVyZWQucmVwbGFjZSgvXFwkXFx7Ym9va2luZ1xcLnRpbWVcXH0vZywgZm9ybWF0VGltZShzdGFydERhdGUsIHR6KSk7XG4gICAgcmVuZGVyZWQgPSByZW5kZXJlZC5yZXBsYWNlKC9cXCRcXHtib29raW5nXFwuY29kZVxcfS9nLCBgVElUSEktJHtkYXRhLmJvb2tpbmcuaWQ/LnNsaWNlKDAsIDgpLnRvVXBwZXJDYXNlKCkgfHwgJyd9YCk7XG4gICAgXG4gICAgLy8gYm9va2luZy5hbW91bnQgdXNlcyBmaW5hbF9wcmljZV9jZW50cyBpZiBhdmFpbGFibGUsIG90aGVyd2lzZSBwcmljZV9jZW50c1xuICAgIGNvbnN0IGFtb3VudCA9IGRhdGEuYm9va2luZy5maW5hbF9wcmljZV9jZW50cyA/PyBkYXRhLmJvb2tpbmcucHJpY2VfY2VudHMgPz8gMDtcbiAgICByZW5kZXJlZCA9IHJlbmRlcmVkLnJlcGxhY2UoL1xcJFxce2Jvb2tpbmdcXC5hbW91bnRcXH0vZywgZm9ybWF0UHJpY2UoYW1vdW50KSk7XG4gIH1cblxuICBpZiAoZGF0YS5idXNpbmVzcykge1xuICAgIHJlbmRlcmVkID0gcmVuZGVyZWQucmVwbGFjZSgvXFwkXFx7YnVzaW5lc3NcXC5uYW1lXFx9L2csIGRhdGEuYnVzaW5lc3MubmFtZSB8fCAnJyk7XG4gICAgcmVuZGVyZWQgPSByZW5kZXJlZC5yZXBsYWNlKC9cXCRcXHtidXNpbmVzc1xcLnN1cHBvcnRfZW1haWxcXH0vZywgZGF0YS5idXNpbmVzcy5zdXBwb3J0X2VtYWlsIHx8ICcnKTtcbiAgICByZW5kZXJlZCA9IHJlbmRlcmVkLnJlcGxhY2UoL1xcJFxce2J1c2luZXNzXFwucGhvbmVcXH0vZywgZGF0YS5idXNpbmVzcy5waG9uZSB8fCAnJyk7XG4gIH1cblxuICBpZiAoZGF0YS5ib29raW5nX3VybCkge1xuICAgIHJlbmRlcmVkID0gcmVuZGVyZWQucmVwbGFjZSgvXFwkXFx7Ym9va2luZ1xcLnVybFxcfS9nLCBkYXRhLmJvb2tpbmdfdXJsKTtcbiAgfSBlbHNlIGlmIChkYXRhLmJ1c2luZXNzPy5zdWJkb21haW4pIHtcbiAgICAvLyBHZW5lcmF0ZSBib29raW5nIFVSTCBpZiBub3QgcHJvdmlkZWRcbiAgICBjb25zdCBib29raW5nQ29kZSA9IGRhdGEuYm9va2luZz8uaWQgXG4gICAgICA/IGBUSVRISS0ke2RhdGEuYm9va2luZy5pZC5zbGljZSgwLCA4KS50b1VwcGVyQ2FzZSgpfWBcbiAgICAgIDogJyc7XG4gICAgY29uc3QgdXJsID0gYGh0dHBzOi8vJHtkYXRhLmJ1c2luZXNzLnN1YmRvbWFpbn0udGl0aGkuY29tL2NvbmZpcm0vJHtib29raW5nQ29kZX1gO1xuICAgIHJlbmRlcmVkID0gcmVuZGVyZWQucmVwbGFjZSgvXFwkXFx7Ym9va2luZ1xcLnVybFxcfS9nLCB1cmwpO1xuICB9XG5cbiAgLy8gSGFuZGxlIGFtb3VudCBwbGFjZWhvbGRlciBmb3IgZmVlX2NoYXJnZWQgYW5kIHJlZnVuZGVkXG4gIGlmIChkYXRhLmFtb3VudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmVuZGVyZWQgPSByZW5kZXJlZC5yZXBsYWNlKC9cXCRcXHthbW91bnRcXH0vZywgZm9ybWF0UHJpY2UoZGF0YS5hbW91bnQpKTtcbiAgfVxuXG4gIHJldHVybiByZW5kZXJlZDtcbn1cblxuLyoqXG4gKiBFbnF1ZXVlIGEgbm90aWZpY2F0aW9uIGpvYlxuICogVXNlcyB1bmlxdWUgY29uc3RyYWludCB0byBwcmV2ZW50IGR1cGxpY2F0ZSBzZW5kc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5xdWV1ZU5vdGlmaWNhdGlvbihwYXJhbXM6IHtcbiAgYnVzaW5lc3NJZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgYm9va2luZ0lkPzogc3RyaW5nO1xuICB0cmlnZ2VyOiBzdHJpbmc7XG4gIHJlY2lwaWVudEVtYWlsPzogc3RyaW5nO1xuICByZWNpcGllbnRQaG9uZT86IHN0cmluZztcbiAgdGVtcGxhdGVJZD86IHN0cmluZztcbiAgc3ViamVjdD86IHN0cmluZztcbiAgYm9keTogc3RyaW5nO1xuICBjaGFubmVsOiAnZW1haWwnIHwgJ3Ntcyc7XG59KTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQWRtaW5DbGllbnQoKTsgLy8gVXNlIGFkbWluIGNsaWVudCB0byBieXBhc3MgUkxTIGZvciBqb2IgaW5zZXJ0aW9uXG5cbiAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIGpvYiB3aXRoIHNhbWUgYm9va2luZ19pZCwgdHJpZ2dlciwgYW5kIGNoYW5uZWwgKGlkZW1wb3RlbmN5KVxuICBpZiAocGFyYW1zLmJvb2tpbmdJZCkge1xuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnbm90aWZpY2F0aW9uX2pvYnMnKVxuICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgLmVxKCdib29raW5nX2lkJywgcGFyYW1zLmJvb2tpbmdJZClcbiAgICAgIC5lcSgndHJpZ2dlcicsIHBhcmFtcy50cmlnZ2VyKVxuICAgICAgLmVxKCdjaGFubmVsJywgcGFyYW1zLmNoYW5uZWwpXG4gICAgICAubGltaXQoMSlcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChleGlzdGluZykge1xuICAgICAgLy8gSm9iIGFscmVhZHkgZXhpc3RzLCBza2lwXG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdub3RpZmljYXRpb25fam9icycpXG4gICAgLmluc2VydCh7XG4gICAgICB1c2VyX2lkOiBwYXJhbXMudXNlcklkLFxuICAgICAgYnVzaW5lc3NfaWQ6IHBhcmFtcy5idXNpbmVzc0lkLFxuICAgICAgYm9va2luZ19pZDogcGFyYW1zLmJvb2tpbmdJZCB8fCBudWxsLFxuICAgICAgdGVtcGxhdGVfaWQ6IHBhcmFtcy50ZW1wbGF0ZUlkIHx8IG51bGwsXG4gICAgICByZWNpcGllbnRfZW1haWw6IHBhcmFtcy5yZWNpcGllbnRFbWFpbCB8fCBudWxsLFxuICAgICAgcmVjaXBpZW50X3Bob25lOiBwYXJhbXMucmVjaXBpZW50UGhvbmUgfHwgbnVsbCxcbiAgICAgIHN1YmplY3Q6IHBhcmFtcy5zdWJqZWN0IHx8IG51bGwsXG4gICAgICBib2R5OiBwYXJhbXMuYm9keSxcbiAgICAgIGNoYW5uZWw6IHBhcmFtcy5jaGFubmVsLFxuICAgICAgdHJpZ2dlcjogcGFyYW1zLnRyaWdnZXIgYXMgYW55LFxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICBhdHRlbXB0X2NvdW50OiAwLFxuICAgICAgc2NoZWR1bGVkX2F0OiBub3csXG4gICAgICBuZXh0X3JldHJ5X2F0OiBudWxsLCAvLyBXaWxsIGJlIHNldCBvbiBmaXJzdCBmYWlsdXJlXG4gICAgICBjcmVhdGVkX2F0OiBub3csXG4gICAgfSk7XG5cbiAgaWYgKGVycm9yKSB7XG4gICAgLy8gSWYgdW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9uLCB0aGF0J3Mgb2theSAoaWRlbXBvdGVuY3kpXG4gICAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW5xdWV1ZWluZyBub3RpZmljYXRpb246JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogTG9hZCBub3RpZmljYXRpb24gdGVtcGxhdGUgZm9yIGEgdHJpZ2dlclxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZFRlbXBsYXRlRm9yVHJpZ2dlcihcbiAgYnVzaW5lc3NJZDogc3RyaW5nLFxuICB1c2VySWQ6IHN0cmluZyxcbiAgdHJpZ2dlcjogTm90aWZpY2F0aW9uVHJpZ2dlcixcbiAgY2hhbm5lbDogJ2VtYWlsJyB8ICdzbXMnLFxuICBzdXBhYmFzZT86IFN1cGFiYXNlQ2xpZW50XG4pOiBQcm9taXNlPGFueSB8IG51bGw+IHtcbiAgY29uc3QgY2xpZW50ID0gc3VwYWJhc2UgfHwgY3JlYXRlQWRtaW5DbGllbnQoKTtcblxuICBjb25zdCB7IGRhdGE6IHRlbXBsYXRlLCBlcnJvciB9ID0gYXdhaXQgY2xpZW50XG4gICAgLmZyb20oJ25vdGlmaWNhdGlvbl90ZW1wbGF0ZXMnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5lcSgnYnVzaW5lc3NfaWQnLCBidXNpbmVzc0lkKVxuICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAuZXEoJ3RyaWdnZXInLCB0cmlnZ2VyKVxuICAgIC5lcSgnY2hhbm5lbCcsIGNoYW5uZWwpXG4gICAgLmVxKCdpc19lbmFibGVkJywgdHJ1ZSlcbiAgICAuaXMoJ2RlbGV0ZWRfYXQnLCBudWxsKVxuICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgIC5saW1pdCgxKVxuICAgIC5tYXliZVNpbmdsZSgpO1xuXG4gIGlmIChlcnJvciAmJiBlcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7IC8vIFBHUlNUMTE2ID0gbm8gcm93cyByZXR1cm5lZFxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgdGVtcGxhdGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHRlbXBsYXRlO1xufVxuXG4vKipcbiAqIE1haW4gZnVuY3Rpb24gdG8gZW1pdCBhIG5vdGlmaWNhdGlvbiBldmVudFxuICogVGhpcyBsb2FkcyBib29raW5nIGRhdGEsIHJlc29sdmVzIHRlbXBsYXRlcywgYW5kIGVucXVldWVzIGpvYnNcbiAqIFxuICogQHBhcmFtIGFtb3VudCBPcHRpb25hbCBhbW91bnQgaW4gY2VudHMgZm9yIGZlZV9jaGFyZ2VkIGFuZCByZWZ1bmRlZCB0cmlnZ2Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW1pdE5vdGlmaWNhdGlvbihcbiAgYnVzaW5lc3NJZDogc3RyaW5nLFxuICB0cmlnZ2VyOiBOb3RpZmljYXRpb25UcmlnZ2VyLFxuICBib29raW5nSWQ6IHN0cmluZyxcbiAgc3VwYWJhc2U/OiBTdXBhYmFzZUNsaWVudCxcbiAgYW1vdW50PzogbnVtYmVyXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgLy8gQ2hlY2sgZmVhdHVyZSBmbGFnIGZpcnN0IC0gaWYgbm90aWZpY2F0aW9ucyBmZWF0dXJlIGlzIGRpc2FibGVkIGdsb2JhbGx5LCBza2lwIGFsbCBub3RpZmljYXRpb25zXG4gIGNvbnN0IHsgZ2V0RWZmZWN0aXZlTm90aWZpY2F0aW9uc0VuYWJsZWQgfSA9IGF3YWl0IGltcG9ydCgnLi9mZWF0dXJlLWZsYWdzJyk7XG4gIGlmICghZ2V0RWZmZWN0aXZlTm90aWZpY2F0aW9uc0VuYWJsZWQoKSkge1xuICAgIGNvbnNvbGUubG9nKGBTa2lwcGluZyBub3RpZmljYXRpb24gZm9yIGJ1c2luZXNzICR7YnVzaW5lc3NJZH0gLSBOb3RpZmljYXRpb25zIGZlYXR1cmUgZGlzYWJsZWQgKHYyKWApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGNsaWVudCA9IHN1cGFiYXNlIHx8IGNyZWF0ZUFkbWluQ2xpZW50KCk7XG5cbiAgLy8gQ2hlY2sgaWYgbm90aWZpY2F0aW9ucyBhcmUgZW5hYmxlZCBmb3IgdGhpcyBidXNpbmVzc1xuICBjb25zdCB7IGRhdGE6IGJ1c2luZXNzIH0gPSBhd2FpdCBjbGllbnRcbiAgICAuZnJvbSgnYnVzaW5lc3NlcycpXG4gICAgLnNlbGVjdCgnaWQsIHVzZXJfaWQsIG5hbWUsIHN1cHBvcnRfZW1haWwsIHBob25lLCBzdWJkb21haW4sIHRpbWV6b25lLCBub3RpZmljYXRpb25zX2VuYWJsZWQnKVxuICAgIC5lcSgnaWQnLCBidXNpbmVzc0lkKVxuICAgIC5zaW5nbGUoKTtcblxuICBpZiAoIWJ1c2luZXNzKSB7XG4gICAgY29uc29sZS5lcnJvcihgQnVzaW5lc3MgJHtidXNpbmVzc0lkfSBub3QgZm91bmRgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBJZiBub3RpZmljYXRpb25zIGFyZSBkaXNhYmxlZCAoQmFzaWMgUGxhbiksIHNraXAgc2VuZGluZyBub3RpZmljYXRpb25zXG4gIC8vIEJhc2ljIFBsYW4gYWNjb3VudHMgb25seSBzaG93IGJvb2tpbmcgY29uZmlybWF0aW9ucywgbm8gU01TL2VtYWlsIG5vdGlmaWNhdGlvbnNcbiAgaWYgKGJ1c2luZXNzLm5vdGlmaWNhdGlvbnNfZW5hYmxlZCA9PT0gZmFsc2UpIHtcbiAgICBjb25zb2xlLmxvZyhgU2tpcHBpbmcgbm90aWZpY2F0aW9uIGZvciBidXNpbmVzcyAke2J1c2luZXNzSWR9IC0gQmFzaWMgUGxhbiAobm90aWZpY2F0aW9ucyBkaXNhYmxlZClgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB1c2VySWQgPSBidXNpbmVzcy51c2VyX2lkO1xuXG4gIC8vIExvYWQgY29tcGxldGUgYm9va2luZyBkYXRhIHdpdGggYWxsIHJlbGF0aW9uc1xuICBjb25zdCB7IGRhdGE6IGJvb2tpbmcsIGVycm9yOiBib29raW5nRXJyb3IgfSA9IGF3YWl0IGNsaWVudFxuICAgIC5mcm9tKCdib29raW5ncycpXG4gICAgLnNlbGVjdChgXG4gICAgICAqLFxuICAgICAgY3VzdG9tZXJzOmN1c3RvbWVyX2lkIChcbiAgICAgICAgaWQsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwaG9uZVxuICAgICAgKSxcbiAgICAgIHNlcnZpY2VzOnNlcnZpY2VfaWQgKFxuICAgICAgICBpZCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgZHVyYXRpb25fbWluLFxuICAgICAgICBwcmljZV9jZW50c1xuICAgICAgKSxcbiAgICAgIHN0YWZmOnN0YWZmX2lkIChcbiAgICAgICAgaWQsXG4gICAgICAgIG5hbWVcbiAgICAgIClcbiAgICBgKVxuICAgIC5lcSgnaWQnLCBib29raW5nSWQpXG4gICAgLmVxKCdidXNpbmVzc19pZCcsIGJ1c2luZXNzSWQpXG4gICAgLmlzKCdkZWxldGVkX2F0JywgbnVsbClcbiAgICAuc2luZ2xlKCk7XG5cbiAgaWYgKGJvb2tpbmdFcnJvciB8fCAhYm9va2luZykge1xuICAgIGNvbnNvbGUuZXJyb3IoYEJvb2tpbmcgJHtib29raW5nSWR9IG5vdCBmb3VuZDpgLCBib29raW5nRXJyb3IpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIEZvciBmZWVfY2hhcmdlZCBhbmQgcmVmdW5kZWQsIGxvYWQgdGhlIGxhdGVzdCBwYXltZW50IGFtb3VudCBpZiBub3QgcHJvdmlkZWRcbiAgbGV0IGZlZUFtb3VudCA9IGFtb3VudDtcbiAgaWYgKCh0cmlnZ2VyID09PSAnZmVlX2NoYXJnZWQnIHx8IHRyaWdnZXIgPT09ICdyZWZ1bmRlZCcpICYmIGZlZUFtb3VudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY29uc3QgeyBkYXRhOiBsYXRlc3RQYXltZW50IH0gPSBhd2FpdCBjbGllbnRcbiAgICAgIC5mcm9tKCdib29raW5nX3BheW1lbnRzJylcbiAgICAgIC5zZWxlY3QoJ2Ftb3VudF9jZW50cycpXG4gICAgICAuZXEoJ2Jvb2tpbmdfaWQnLCBib29raW5nSWQpXG4gICAgICAuaW4oJ21vbmV5X2FjdGlvbicsIHRyaWdnZXIgPT09ICdmZWVfY2hhcmdlZCcgPyBbJ25vX3Nob3dfZmVlJywgJ2NhbmNlbF9mZWUnXSA6IFsncmVmdW5kJ10pXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAgIC5saW1pdCgxKVxuICAgICAgLm1heWJlU2luZ2xlKCk7XG4gICAgXG4gICAgaWYgKGxhdGVzdFBheW1lbnQpIHtcbiAgICAgIGZlZUFtb3VudCA9IGxhdGVzdFBheW1lbnQuYW1vdW50X2NlbnRzO1xuICAgIH1cbiAgfVxuXG4gIC8vIEJ1aWxkIG5vdGlmaWNhdGlvbiBkYXRhXG4gIGNvbnN0IG5vdGlmaWNhdGlvbkRhdGE6IE5vdGlmaWNhdGlvbkRhdGEgPSB7XG4gICAgYm9va2luZzoge1xuICAgICAgaWQ6IGJvb2tpbmcuaWQsXG4gICAgICBzdGFydF9hdDogYm9va2luZy5zdGFydF9hdCxcbiAgICAgIGVuZF9hdDogYm9va2luZy5lbmRfYXQsXG4gICAgICBmaW5hbF9wcmljZV9jZW50czogYm9va2luZy5maW5hbF9wcmljZV9jZW50cyxcbiAgICAgIHByaWNlX2NlbnRzOiBib29raW5nLnByaWNlX2NlbnRzLFxuICAgICAgc3RhZmZfaWQ6IGJvb2tpbmcuc3RhZmZfaWQsXG4gICAgICBzdGF0dXM6IGJvb2tpbmcuc3RhdHVzLFxuICAgIH0sXG4gICAgY3VzdG9tZXI6IGJvb2tpbmcuY3VzdG9tZXJzID8ge1xuICAgICAgbmFtZTogYm9va2luZy5jdXN0b21lcnMubmFtZSxcbiAgICAgIGVtYWlsOiBib29raW5nLmN1c3RvbWVycy5lbWFpbCxcbiAgICAgIHBob25lOiBib29raW5nLmN1c3RvbWVycy5waG9uZSB8fCB1bmRlZmluZWQsXG4gICAgfSA6IHVuZGVmaW5lZCxcbiAgICBzZXJ2aWNlOiBib29raW5nLnNlcnZpY2VzID8ge1xuICAgICAgbmFtZTogYm9va2luZy5zZXJ2aWNlcy5uYW1lLFxuICAgICAgZHVyYXRpb25fbWluOiBib29raW5nLnNlcnZpY2VzLmR1cmF0aW9uX21pbixcbiAgICAgIHByaWNlX2NlbnRzOiBib29raW5nLnNlcnZpY2VzLnByaWNlX2NlbnRzLFxuICAgIH0gOiB1bmRlZmluZWQsXG4gICAgc3RhZmY6IGJvb2tpbmcuc3RhZmYgPyB7XG4gICAgICBuYW1lOiBib29raW5nLnN0YWZmLm5hbWUsXG4gICAgfSA6IHVuZGVmaW5lZCxcbiAgICBidXNpbmVzczoge1xuICAgICAgbmFtZTogYnVzaW5lc3MubmFtZSxcbiAgICAgIHN1cHBvcnRfZW1haWw6IGJ1c2luZXNzLnN1cHBvcnRfZW1haWwgfHwgdW5kZWZpbmVkLFxuICAgICAgcGhvbmU6IGJ1c2luZXNzLnBob25lIHx8IHVuZGVmaW5lZCxcbiAgICAgIHN1YmRvbWFpbjogYnVzaW5lc3Muc3ViZG9tYWluIHx8IHVuZGVmaW5lZCxcbiAgICAgIHRpbWV6b25lOiBidXNpbmVzcy50aW1lem9uZSB8fCAnQW1lcmljYS9OZXdfWW9yaycsXG4gICAgfSxcbiAgICBib29raW5nX3VybDogYnVzaW5lc3Muc3ViZG9tYWluIFxuICAgICAgPyBgaHR0cHM6Ly8ke2J1c2luZXNzLnN1YmRvbWFpbn0udGl0aGkuY29tL2NvbmZpcm0vVElUSEktJHtib29raW5nLmlkLnNsaWNlKDAsIDgpLnRvVXBwZXJDYXNlKCl9YFxuICAgICAgOiB1bmRlZmluZWQsXG4gICAgYW1vdW50OiBmZWVBbW91bnQsIC8vIEZvciBmZWVfY2hhcmdlZCBhbmQgcmVmdW5kZWQgdHJpZ2dlcnNcbiAgfTtcblxuICAvLyBMb2FkIHRlbXBsYXRlcyBmb3IgdGhpcyB0cmlnZ2VyXG4gIC8vIE5PVEU6IFNNUyBub3RpZmljYXRpb25zIGRpc2FibGVkIGZvciB2MSAtIG9ubHkgZW1haWwgbm90aWZpY2F0aW9ucyBhcmUgZW5hYmxlZFxuICBjb25zdCBlbWFpbFRlbXBsYXRlID0gYXdhaXQgbG9hZFRlbXBsYXRlRm9yVHJpZ2dlcihidXNpbmVzc0lkLCB1c2VySWQsIHRyaWdnZXIsICdlbWFpbCcsIGNsaWVudCk7XG4gIC8vIGNvbnN0IHNtc1RlbXBsYXRlID0gYXdhaXQgbG9hZFRlbXBsYXRlRm9yVHJpZ2dlcihidXNpbmVzc0lkLCB1c2VySWQsIHRyaWdnZXIsICdzbXMnLCBjbGllbnQpOyAvLyBEaXNhYmxlZCBmb3IgdjFcblxuICBjb25zdCB0aW1lem9uZSA9IGJ1c2luZXNzLnRpbWV6b25lIHx8ICdBbWVyaWNhL05ld19Zb3JrJztcblxuICAvLyBMb2cgaWYgdGVtcGxhdGUgaXMgbWlzc2luZyAoZm9yIGRlYnVnZ2luZylcbiAgaWYgKCFlbWFpbFRlbXBsYXRlKSB7XG4gICAgY29uc29sZS5sb2coYFtub3RpZmljYXRpb25zXSBObyBlbWFpbCB0ZW1wbGF0ZSBmb3VuZCBmb3IgYnVzaW5lc3MgJHtidXNpbmVzc0lkfSwgdHJpZ2dlciAke3RyaWdnZXJ9LiBFbWFpbCB3aWxsIG5vdCBiZSBzZW50LmApO1xuICB9XG5cbiAgLy8gRW5xdWV1ZSBlbWFpbCBub3RpZmljYXRpb24gaWYgdGVtcGxhdGUgZXhpc3RzIGFuZCBjdXN0b21lciBoYXMgZW1haWxcbiAgaWYgKGVtYWlsVGVtcGxhdGUgJiYgbm90aWZpY2F0aW9uRGF0YS5jdXN0b21lcj8uZW1haWwpIHtcbiAgICBjb25zb2xlLmxvZyhgW25vdGlmaWNhdGlvbnNdIEVucXVldWVpbmcgZW1haWwgbm90aWZpY2F0aW9uIGZvciBib29raW5nICR7Ym9va2luZ0lkfSB0byAke25vdGlmaWNhdGlvbkRhdGEuY3VzdG9tZXIuZW1haWx9YCk7XG4gICAgY29uc3QgcmVuZGVyZWRCb2R5ID0gcmVuZGVyVGVtcGxhdGUoZW1haWxUZW1wbGF0ZS5ib2R5X21hcmtkb3duLCBub3RpZmljYXRpb25EYXRhLCB0aW1lem9uZSk7XG4gICAgY29uc3QgcmVuZGVyZWRTdWJqZWN0ID0gZW1haWxUZW1wbGF0ZS5zdWJqZWN0XG4gICAgICA/IHJlbmRlclRlbXBsYXRlKGVtYWlsVGVtcGxhdGUuc3ViamVjdCwgbm90aWZpY2F0aW9uRGF0YSwgdGltZXpvbmUpXG4gICAgICA6IHVuZGVmaW5lZDtcblxuICAgIGF3YWl0IGVucXVldWVOb3RpZmljYXRpb24oe1xuICAgICAgYnVzaW5lc3NJZCxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGJvb2tpbmdJZCxcbiAgICAgIHRyaWdnZXIsXG4gICAgICByZWNpcGllbnRFbWFpbDogbm90aWZpY2F0aW9uRGF0YS5jdXN0b21lci5lbWFpbCxcbiAgICAgIHRlbXBsYXRlSWQ6IGVtYWlsVGVtcGxhdGUuaWQsXG4gICAgICBzdWJqZWN0OiByZW5kZXJlZFN1YmplY3QsXG4gICAgICBib2R5OiByZW5kZXJlZEJvZHksXG4gICAgICBjaGFubmVsOiAnZW1haWwnLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gU01TIG5vdGlmaWNhdGlvbnMgZGlzYWJsZWQgZm9yIHYxIC0gd2lsbCBiZSBlbmFibGVkIGluIHYyXG4gIC8vIEVucXVldWUgU01TIG5vdGlmaWNhdGlvbiBpZiB0ZW1wbGF0ZSBleGlzdHMgYW5kIGN1c3RvbWVyIGhhcyBwaG9uZVxuICAvLyBpZiAoc21zVGVtcGxhdGUgJiYgbm90aWZpY2F0aW9uRGF0YS5jdXN0b21lcj8ucGhvbmUpIHtcbiAgLy8gICBjb25zdCByZW5kZXJlZEJvZHkgPSByZW5kZXJUZW1wbGF0ZShzbXNUZW1wbGF0ZS5ib2R5X21hcmtkb3duLCBub3RpZmljYXRpb25EYXRhLCB0aW1lem9uZSk7XG4gIC8vXG4gIC8vICAgYXdhaXQgZW5xdWV1ZU5vdGlmaWNhdGlvbih7XG4gIC8vICAgICBidXNpbmVzc0lkLFxuICAvLyAgICAgdXNlcklkLFxuICAvLyAgICAgYm9va2luZ0lkLFxuICAvLyAgICAgdHJpZ2dlcixcbiAgLy8gICAgIHJlY2lwaWVudFBob25lOiBub3RpZmljYXRpb25EYXRhLmN1c3RvbWVyLnBob25lLFxuICAvLyAgICAgdGVtcGxhdGVJZDogc21zVGVtcGxhdGUuaWQsXG4gIC8vICAgICBib2R5OiByZW5kZXJlZEJvZHksXG4gIC8vICAgICBjaGFubmVsOiAnc21zJyxcbiAgLy8gICB9KTtcbiAgLy8gfVxufVxuXG4vKipcbiAqIENyZWF0ZSBub3RpZmljYXRpb24gam9iIGZyb20gdGVtcGxhdGUgYW5kIGRhdGEgKGxlZ2FjeSBmdW5jdGlvbiwgdXNlIGVtaXROb3RpZmljYXRpb24pXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVOb3RpZmljYXRpb25Gcm9tVGVtcGxhdGUocGFyYW1zOiB7XG4gIGJ1c2luZXNzSWQ6IHN0cmluZztcbiAgdXNlcklkOiBzdHJpbmc7XG4gIGJvb2tpbmdJZD86IHN0cmluZztcbiAgdHJpZ2dlcjogTm90aWZpY2F0aW9uVHJpZ2dlcjtcbiAgZGF0YTogTm90aWZpY2F0aW9uRGF0YTtcbn0pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgeyBidXNpbmVzc0lkLCB1c2VySWQsIGJvb2tpbmdJZCwgdHJpZ2dlciwgZGF0YSB9ID0gcGFyYW1zO1xuXG4gIGlmICghYm9va2luZ0lkKSB7XG4gICAgY29uc29sZS5lcnJvcignY3JlYXRlTm90aWZpY2F0aW9uRnJvbVRlbXBsYXRlIHJlcXVpcmVzIGJvb2tpbmdJZCcpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFVzZSB0aGUgbWFpbiBlbWl0Tm90aWZpY2F0aW9uIGZ1bmN0aW9uXG4gIGF3YWl0IGVtaXROb3RpZmljYXRpb24oYnVzaW5lc3NJZCwgdHJpZ2dlciwgYm9va2luZ0lkKTtcbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uc1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlOiBEYXRlLCB0aW1lem9uZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGZvcm1hdEluVGltZVpvbmUoZGF0ZS50b0lTT1N0cmluZygpLCB0aW1lem9uZSwge1xuICAgIHdlZWtkYXk6ICdsb25nJyxcbiAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgbW9udGg6ICdsb25nJyxcbiAgICBkYXk6ICdudW1lcmljJyxcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGZvcm1hdFRpbWUoZGF0ZTogRGF0ZSwgdGltZXpvbmU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBmb3JtYXRJblRpbWVab25lKGRhdGUudG9JU09TdHJpbmcoKSwgdGltZXpvbmUsIHtcbiAgICBob3VyOiAnbnVtZXJpYycsXG4gICAgbWludXRlOiAnMi1kaWdpdCcsXG4gICAgaG91cjEyOiB0cnVlLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gZm9ybWF0UHJpY2UoY2VudHM6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBgJCR7KGNlbnRzIC8gMTAwKS50b0ZpeGVkKDIpfWA7XG59XG5cblxuIl0sIm5hbWVzIjpbImNyZWF0ZUFkbWluQ2xpZW50IiwiZm9ybWF0SW5UaW1lWm9uZSIsIkFMTE9XRURfUExBQ0VIT0xERVJTIiwidmFsaWRhdGVQbGFjZWhvbGRlcnMiLCJ0ZW1wbGF0ZSIsInBsYWNlaG9sZGVyUmVnZXgiLCJtYXRjaGVzIiwiQXJyYXkiLCJmcm9tIiwibWF0Y2hBbGwiLCJmb3VuZFBsYWNlaG9sZGVycyIsIm1hcCIsIm0iLCJpbnZhbGlkIiwiZmlsdGVyIiwicCIsImluY2x1ZGVzIiwidmFsaWQiLCJsZW5ndGgiLCJyZW5kZXJUZW1wbGF0ZSIsImRhdGEiLCJ0aW1lem9uZSIsInJlbmRlcmVkIiwidHoiLCJidXNpbmVzcyIsImN1c3RvbWVyIiwicmVwbGFjZSIsIm5hbWUiLCJlbWFpbCIsInBob25lIiwic2VydmljZSIsIlN0cmluZyIsImR1cmF0aW9uX21pbiIsImZvcm1hdFByaWNlIiwicHJpY2VfY2VudHMiLCJzdGFmZiIsImJvb2tpbmciLCJzdGFydERhdGUiLCJEYXRlIiwic3RhcnRfYXQiLCJmb3JtYXREYXRlIiwiZm9ybWF0VGltZSIsImlkIiwic2xpY2UiLCJ0b1VwcGVyQ2FzZSIsImFtb3VudCIsImZpbmFsX3ByaWNlX2NlbnRzIiwic3VwcG9ydF9lbWFpbCIsImJvb2tpbmdfdXJsIiwic3ViZG9tYWluIiwiYm9va2luZ0NvZGUiLCJ1cmwiLCJ1bmRlZmluZWQiLCJlbnF1ZXVlTm90aWZpY2F0aW9uIiwicGFyYW1zIiwic3VwYWJhc2UiLCJib29raW5nSWQiLCJleGlzdGluZyIsInNlbGVjdCIsImVxIiwidHJpZ2dlciIsImNoYW5uZWwiLCJsaW1pdCIsInNpbmdsZSIsIm5vdyIsInRvSVNPU3RyaW5nIiwiZXJyb3IiLCJpbnNlcnQiLCJ1c2VyX2lkIiwidXNlcklkIiwiYnVzaW5lc3NfaWQiLCJidXNpbmVzc0lkIiwiYm9va2luZ19pZCIsInRlbXBsYXRlX2lkIiwidGVtcGxhdGVJZCIsInJlY2lwaWVudF9lbWFpbCIsInJlY2lwaWVudEVtYWlsIiwicmVjaXBpZW50X3Bob25lIiwicmVjaXBpZW50UGhvbmUiLCJzdWJqZWN0IiwiYm9keSIsInN0YXR1cyIsImF0dGVtcHRfY291bnQiLCJzY2hlZHVsZWRfYXQiLCJuZXh0X3JldHJ5X2F0IiwiY3JlYXRlZF9hdCIsImNvZGUiLCJjb25zb2xlIiwibG9hZFRlbXBsYXRlRm9yVHJpZ2dlciIsImNsaWVudCIsImlzIiwib3JkZXIiLCJhc2NlbmRpbmciLCJtYXliZVNpbmdsZSIsImVtaXROb3RpZmljYXRpb24iLCJnZXRFZmZlY3RpdmVOb3RpZmljYXRpb25zRW5hYmxlZCIsImxvZyIsIm5vdGlmaWNhdGlvbnNfZW5hYmxlZCIsImJvb2tpbmdFcnJvciIsImZlZUFtb3VudCIsImxhdGVzdFBheW1lbnQiLCJpbiIsImFtb3VudF9jZW50cyIsIm5vdGlmaWNhdGlvbkRhdGEiLCJlbmRfYXQiLCJzdGFmZl9pZCIsImN1c3RvbWVycyIsInNlcnZpY2VzIiwiZW1haWxUZW1wbGF0ZSIsInJlbmRlcmVkQm9keSIsImJvZHlfbWFya2Rvd24iLCJyZW5kZXJlZFN1YmplY3QiLCJjcmVhdGVOb3RpZmljYXRpb25Gcm9tVGVtcGxhdGUiLCJkYXRlIiwid2Vla2RheSIsInllYXIiLCJtb250aCIsImRheSIsImhvdXIiLCJtaW51dGUiLCJob3VyMTIiLCJjZW50cyIsInRvRml4ZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/notifications.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/timezone.ts":
/*!*****************************!*\
  !*** ./src/lib/timezone.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   formatInTimeZone: () => (/* binding */ formatInTimeZone),\n/* harmony export */   timeStringToMinutes: () => (/* binding */ timeStringToMinutes),\n/* harmony export */   zonedMinutesToDate: () => (/* binding */ zonedMinutesToDate)\n/* harmony export */ });\nfunction timeStringToMinutes(time) {\n    const [hours = \"0\", minutes = \"0\"] = time.split(\":\");\n    return parseInt(hours, 10) * 60 + parseInt(minutes, 10);\n}\nfunction zonedMinutesToDate(date, minutes, timeZone) {\n    const baseParts = getDateParts(date, timeZone);\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    const utcDate = new Date(Date.UTC(baseParts.year, baseParts.month - 1, baseParts.day, hours, mins));\n    const offset = getOffsetMinutes(utcDate, timeZone);\n    return new Date(utcDate.getTime() - offset * 60000);\n}\nfunction formatInTimeZone(isoString, timeZone, options) {\n    // Handle both string and Date inputs\n    let date;\n    if (isoString instanceof Date) {\n        date = isoString;\n    } else if (typeof isoString === \"string\") {\n        // Validate string is not empty\n        if (!isoString || isoString.trim() === \"\") {\n            console.error(`[formatInTimeZone] Empty date string provided`);\n            return \"Invalid Date\";\n        }\n        date = new Date(isoString);\n    } else {\n        console.error(`[formatInTimeZone] Invalid input type:`, typeof isoString, isoString);\n        return \"Invalid Date\";\n    }\n    // Validate the date\n    if (isNaN(date.getTime())) {\n        console.error(`[formatInTimeZone] Invalid date value:`, isoString);\n        return \"Invalid Date\";\n    }\n    // Handle string format option (like \"yyyy-MM-dd\")\n    if (typeof options === \"string\") {\n        // For simple date format strings, use a basic formatter\n        const formatter = new Intl.DateTimeFormat(\"en-US\", {\n            timeZone,\n            year: \"numeric\",\n            month: \"2-digit\",\n            day: \"2-digit\"\n        });\n        const parts = formatter.formatToParts(date);\n        const year = parts.find((p)=>p.type === \"year\")?.value || \"\";\n        const month = parts.find((p)=>p.type === \"month\")?.value || \"\";\n        const day = parts.find((p)=>p.type === \"day\")?.value || \"\";\n        // Replace format string placeholders\n        return options.replace(\"yyyy\", year).replace(\"MM\", month).replace(\"dd\", day);\n    }\n    // Handle Intl.DateTimeFormatOptions\n    const formatter = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone,\n        ...options\n    });\n    return formatter.format(date);\n}\nfunction getDateParts(date, timeZone) {\n    const formatter = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone,\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\"\n    });\n    const parts = formatter.formatToParts(date);\n    return {\n        year: Number(parts.find((part)=>part.type === \"year\")?.value ?? date.getUTCFullYear()),\n        month: Number(parts.find((part)=>part.type === \"month\")?.value ?? date.getUTCMonth() + 1),\n        day: Number(parts.find((part)=>part.type === \"day\")?.value ?? date.getUTCDate())\n    };\n}\nfunction getOffsetMinutes(date, timeZone) {\n    const formatter = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone,\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hourCycle: \"h23\"\n    });\n    const parts = formatter.formatToParts(date);\n    const year = Number(parts.find((part)=>part.type === \"year\")?.value ?? date.getUTCFullYear());\n    const month = Number(parts.find((part)=>part.type === \"month\")?.value ?? date.getUTCMonth() + 1);\n    const day = Number(parts.find((part)=>part.type === \"day\")?.value ?? date.getUTCDate());\n    const hour = Number(parts.find((part)=>part.type === \"hour\")?.value ?? date.getUTCHours());\n    const minute = Number(parts.find((part)=>part.type === \"minute\")?.value ?? date.getUTCMinutes());\n    const asUTC = Date.UTC(year, month - 1, day, hour, minute);\n    return (asUTC - date.getTime()) / 60000;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBT1IsTUFBTUUsSUFBSSxDQUFDLENBQUNPLE9BQVNBLEtBQUtMLElBQUksS0FBSyxXQUFXQyxTQUFTL0IsS0FBSzJDLGFBQWE7SUFDL0YsTUFBTUMsUUFBUXBDLEtBQUtDLEdBQUcsQ0FBQ0MsTUFBTUMsUUFBUSxHQUFHQyxLQUFLMkIsTUFBTUM7SUFDbkQsT0FBTyxDQUFDSSxRQUFRNUMsS0FBS2UsT0FBTyxFQUFDLElBQUs7QUFDcEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvLi9zcmMvbGliL3RpbWV6b25lLnRzP2ZkYjgiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIHRpbWVTdHJpbmdUb01pbnV0ZXModGltZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgW2hvdXJzID0gXCIwXCIsIG1pbnV0ZXMgPSBcIjBcIl0gPSB0aW1lLnNwbGl0KFwiOlwiKTtcbiAgcmV0dXJuIHBhcnNlSW50KGhvdXJzLCAxMCkgKiA2MCArIHBhcnNlSW50KG1pbnV0ZXMsIDEwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHpvbmVkTWludXRlc1RvRGF0ZShkYXRlOiBEYXRlLCBtaW51dGVzOiBudW1iZXIsIHRpbWVab25lOiBzdHJpbmcpOiBEYXRlIHtcbiAgY29uc3QgYmFzZVBhcnRzID0gZ2V0RGF0ZVBhcnRzKGRhdGUsIHRpbWVab25lKTtcbiAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKG1pbnV0ZXMgLyA2MCk7XG4gIGNvbnN0IG1pbnMgPSBtaW51dGVzICUgNjA7XG4gIGNvbnN0IHV0Y0RhdGUgPSBuZXcgRGF0ZShEYXRlLlVUQyhiYXNlUGFydHMueWVhciwgYmFzZVBhcnRzLm1vbnRoIC0gMSwgYmFzZVBhcnRzLmRheSwgaG91cnMsIG1pbnMpKTtcbiAgY29uc3Qgb2Zmc2V0ID0gZ2V0T2Zmc2V0TWludXRlcyh1dGNEYXRlLCB0aW1lWm9uZSk7XG4gIHJldHVybiBuZXcgRGF0ZSh1dGNEYXRlLmdldFRpbWUoKSAtIG9mZnNldCAqIDYwXzAwMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRJblRpbWVab25lKFxuICBpc29TdHJpbmc6IHN0cmluZyB8IERhdGUsXG4gIHRpbWVab25lOiBzdHJpbmcsXG4gIG9wdGlvbnM6IEludGwuRGF0ZVRpbWVGb3JtYXRPcHRpb25zIHwgc3RyaW5nXG4pOiBzdHJpbmcge1xuICAvLyBIYW5kbGUgYm90aCBzdHJpbmcgYW5kIERhdGUgaW5wdXRzXG4gIGxldCBkYXRlOiBEYXRlO1xuICBpZiAoaXNvU3RyaW5nIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgIGRhdGUgPSBpc29TdHJpbmc7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGlzb1N0cmluZyA9PT0gJ3N0cmluZycpIHtcbiAgICAvLyBWYWxpZGF0ZSBzdHJpbmcgaXMgbm90IGVtcHR5XG4gICAgaWYgKCFpc29TdHJpbmcgfHwgaXNvU3RyaW5nLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtmb3JtYXRJblRpbWVab25lXSBFbXB0eSBkYXRlIHN0cmluZyBwcm92aWRlZGApO1xuICAgICAgcmV0dXJuICdJbnZhbGlkIERhdGUnO1xuICAgIH1cbiAgICBkYXRlID0gbmV3IERhdGUoaXNvU3RyaW5nKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKGBbZm9ybWF0SW5UaW1lWm9uZV0gSW52YWxpZCBpbnB1dCB0eXBlOmAsIHR5cGVvZiBpc29TdHJpbmcsIGlzb1N0cmluZyk7XG4gICAgcmV0dXJuICdJbnZhbGlkIERhdGUnO1xuICB9XG4gIFxuICAvLyBWYWxpZGF0ZSB0aGUgZGF0ZVxuICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgY29uc29sZS5lcnJvcihgW2Zvcm1hdEluVGltZVpvbmVdIEludmFsaWQgZGF0ZSB2YWx1ZTpgLCBpc29TdHJpbmcpO1xuICAgIHJldHVybiAnSW52YWxpZCBEYXRlJztcbiAgfVxuICBcbiAgLy8gSGFuZGxlIHN0cmluZyBmb3JtYXQgb3B0aW9uIChsaWtlIFwieXl5eS1NTS1kZFwiKVxuICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7XG4gICAgLy8gRm9yIHNpbXBsZSBkYXRlIGZvcm1hdCBzdHJpbmdzLCB1c2UgYSBiYXNpYyBmb3JtYXR0ZXJcbiAgICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLVVTXCIsIHsgXG4gICAgICB0aW1lWm9uZSxcbiAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICAgIG1vbnRoOiAnMi1kaWdpdCcsXG4gICAgICBkYXk6ICcyLWRpZ2l0J1xuICAgIH0pO1xuICAgIGNvbnN0IHBhcnRzID0gZm9ybWF0dGVyLmZvcm1hdFRvUGFydHMoZGF0ZSk7XG4gICAgY29uc3QgeWVhciA9IHBhcnRzLmZpbmQocCA9PiBwLnR5cGUgPT09ICd5ZWFyJyk/LnZhbHVlIHx8ICcnO1xuICAgIGNvbnN0IG1vbnRoID0gcGFydHMuZmluZChwID0+IHAudHlwZSA9PT0gJ21vbnRoJyk/LnZhbHVlIHx8ICcnO1xuICAgIGNvbnN0IGRheSA9IHBhcnRzLmZpbmQocCA9PiBwLnR5cGUgPT09ICdkYXknKT8udmFsdWUgfHwgJyc7XG4gICAgXG4gICAgLy8gUmVwbGFjZSBmb3JtYXQgc3RyaW5nIHBsYWNlaG9sZGVyc1xuICAgIHJldHVybiBvcHRpb25zXG4gICAgICAucmVwbGFjZSgneXl5eScsIHllYXIpXG4gICAgICAucmVwbGFjZSgnTU0nLCBtb250aClcbiAgICAgIC5yZXBsYWNlKCdkZCcsIGRheSk7XG4gIH1cbiAgXG4gIC8vIEhhbmRsZSBJbnRsLkRhdGVUaW1lRm9ybWF0T3B0aW9uc1xuICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLVVTXCIsIHsgdGltZVpvbmUsIC4uLm9wdGlvbnMgfSk7XG4gIHJldHVybiBmb3JtYXR0ZXIuZm9ybWF0KGRhdGUpO1xufVxuXG5mdW5jdGlvbiBnZXREYXRlUGFydHMoZGF0ZTogRGF0ZSwgdGltZVpvbmU6IHN0cmluZykge1xuICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLVVTXCIsIHtcbiAgICB0aW1lWm9uZSxcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICBtb250aDogXCIyLWRpZ2l0XCIsXG4gICAgZGF5OiBcIjItZGlnaXRcIlxuICB9KTtcbiAgY29uc3QgcGFydHMgPSBmb3JtYXR0ZXIuZm9ybWF0VG9QYXJ0cyhkYXRlKTtcbiAgcmV0dXJuIHtcbiAgICB5ZWFyOiBOdW1iZXIocGFydHMuZmluZCgocGFydCkgPT4gcGFydC50eXBlID09PSBcInllYXJcIik/LnZhbHVlID8/IGRhdGUuZ2V0VVRDRnVsbFllYXIoKSksXG4gICAgbW9udGg6IE51bWJlcihwYXJ0cy5maW5kKChwYXJ0KSA9PiBwYXJ0LnR5cGUgPT09IFwibW9udGhcIik/LnZhbHVlID8/IGRhdGUuZ2V0VVRDTW9udGgoKSArIDEpLFxuICAgIGRheTogTnVtYmVyKHBhcnRzLmZpbmQoKHBhcnQpID0+IHBhcnQudHlwZSA9PT0gXCJkYXlcIik/LnZhbHVlID8/IGRhdGUuZ2V0VVRDRGF0ZSgpKVxuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRPZmZzZXRNaW51dGVzKGRhdGU6IERhdGUsIHRpbWVab25lOiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLVVTXCIsIHtcbiAgICB0aW1lWm9uZSxcbiAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICBtb250aDogXCIyLWRpZ2l0XCIsXG4gICAgZGF5OiBcIjItZGlnaXRcIixcbiAgICBob3VyOiBcIjItZGlnaXRcIixcbiAgICBtaW51dGU6IFwiMi1kaWdpdFwiLFxuICAgIGhvdXJDeWNsZTogXCJoMjNcIlxuICB9KTtcbiAgY29uc3QgcGFydHMgPSBmb3JtYXR0ZXIuZm9ybWF0VG9QYXJ0cyhkYXRlKTtcbiAgY29uc3QgeWVhciA9IE51bWJlcihwYXJ0cy5maW5kKChwYXJ0KSA9PiBwYXJ0LnR5cGUgPT09IFwieWVhclwiKT8udmFsdWUgPz8gZGF0ZS5nZXRVVENGdWxsWWVhcigpKTtcbiAgY29uc3QgbW9udGggPSBOdW1iZXIocGFydHMuZmluZCgocGFydCkgPT4gcGFydC50eXBlID09PSBcIm1vbnRoXCIpPy52YWx1ZSA/PyBkYXRlLmdldFVUQ01vbnRoKCkgKyAxKTtcbiAgY29uc3QgZGF5ID0gTnVtYmVyKHBhcnRzLmZpbmQoKHBhcnQpID0+IHBhcnQudHlwZSA9PT0gXCJkYXlcIik/LnZhbHVlID8/IGRhdGUuZ2V0VVRDRGF0ZSgpKTtcbiAgY29uc3QgaG91ciA9IE51bWJlcihwYXJ0cy5maW5kKChwYXJ0KSA9PiBwYXJ0LnR5cGUgPT09IFwiaG91clwiKT8udmFsdWUgPz8gZGF0ZS5nZXRVVENIb3VycygpKTtcbiAgY29uc3QgbWludXRlID0gTnVtYmVyKHBhcnRzLmZpbmQoKHBhcnQpID0+IHBhcnQudHlwZSA9PT0gXCJtaW51dGVcIik/LnZhbHVlID8/IGRhdGUuZ2V0VVRDTWludXRlcygpKTtcbiAgY29uc3QgYXNVVEMgPSBEYXRlLlVUQyh5ZWFyLCBtb250aCAtIDEsIGRheSwgaG91ciwgbWludXRlKTtcbiAgcmV0dXJuIChhc1VUQyAtIGRhdGUuZ2V0VGltZSgpKSAvIDYwXzAwMDtcbn1cblxuXG4iXSwibmFtZXMiOlsidGltZVN0cmluZ1RvTWludXRlcyIsInRpbWUiLCJob3VycyIsIm1pbnV0ZXMiLCJzcGxpdCIsInBhcnNlSW50Iiwiem9uZWRNaW51dGVzVG9EYXRlIiwiZGF0ZSIsInRpbWVab25lIiwiYmFzZVBhcnRzIiwiZ2V0RGF0ZVBhcnRzIiwiTWF0aCIsImZsb29yIiwibWlucyIsInV0Y0RhdGUiLCJEYXRlIiwiVVRDIiwieWVhciIsIm1vbnRoIiwiZGF5Iiwib2Zmc2V0IiwiZ2V0T2Zmc2V0TWludXRlcyIsImdldFRpbWUiLCJmb3JtYXRJblRpbWVab25lIiwiaXNvU3RyaW5nIiwib3B0aW9ucyIsInRyaW0iLCJjb25zb2xlIiwiZXJyb3IiLCJpc05hTiIsImZvcm1hdHRlciIsIkludGwiLCJEYXRlVGltZUZvcm1hdCIsInBhcnRzIiwiZm9ybWF0VG9QYXJ0cyIsImZpbmQiLCJwIiwidHlwZSIsInZhbHVlIiwicmVwbGFjZSIsImZvcm1hdCIsIk51bWJlciIsInBhcnQiLCJnZXRVVENGdWxsWWVhciIsImdldFVUQ01vbnRoIiwiZ2V0VVRDRGF0ZSIsImhvdXIiLCJtaW51dGUiLCJob3VyQ3ljbGUiLCJnZXRVVENIb3VycyIsImdldFVUQ01pbnV0ZXMiLCJhc1VUQyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/timezone.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&page=%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fnotifications%2Ftemplates%2F%5Bid%5D%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();