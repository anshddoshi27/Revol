"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/signup/route";
exports.ids = ["app/api/auth/signup/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsignup%2Froute&page=%2Fapi%2Fauth%2Fsignup%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsignup%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsignup%2Froute&page=%2Fapi%2Fauth%2Fsignup%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsignup%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_3017387smacbookm_Downloads_Career_Tithi_apps_web_src_app_api_auth_signup_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/signup/route.ts */ \"(rsc)/./src/app/api/auth/signup/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/signup/route\",\n        pathname: \"/api/auth/signup\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/signup/route\"\n    },\n    resolvedPagePath: \"/Users/3017387smacbookm/Downloads/Career/Tithi/apps/web/src/app/api/auth/signup/route.ts\",\n    nextConfigOutput,\n    userland: _Users_3017387smacbookm_Downloads_Career_Tithi_apps_web_src_app_api_auth_signup_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/auth/signup/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGc2lnbnVwJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhdXRoJTJGc2lnbnVwJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYXV0aCUyRnNpZ251cCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRjMwMTczODdzbWFjYm9va20lMkZEb3dubG9hZHMlMkZDYXJlZXIlMkZUaXRoaSUyRmFwcHMlMkZ3ZWIlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGMzAxNzM4N3NtYWNib29rbSUyRkRvd25sb2FkcyUyRkNhcmVlciUyRlRpdGhpJTJGYXBwcyUyRndlYiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDd0M7QUFDckg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvPzk5YTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzLzMwMTczODdzbWFjYm9va20vRG93bmxvYWRzL0NhcmVlci9UaXRoaS9hcHBzL3dlYi9zcmMvYXBwL2FwaS9hdXRoL3NpZ251cC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXV0aC9zaWdudXAvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL3NpZ251cFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYXV0aC9zaWdudXAvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvMzAxNzM4N3NtYWNib29rbS9Eb3dubG9hZHMvQ2FyZWVyL1RpdGhpL2FwcHMvd2ViL3NyYy9hcHAvYXBpL2F1dGgvc2lnbnVwL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9hdXRoL3NpZ251cC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsignup%2Froute&page=%2Fapi%2Fauth%2Fsignup%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsignup%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/auth/signup/route.ts":
/*!******************************************!*\
  !*** ./src/app/api/auth/signup/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.ts\");\n\n\n\n/**\n * POST /api/auth/signup\n * \n * Creates a new user account and a business record (with no name initially)\n * \n * Body: {\n *   email: string\n *   password: string\n *   fullName: string\n *   phone?: string\n * }\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { email, password, fullName, phone } = body;\n        if (!email || !password || !fullName) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing required fields: email, password, fullName\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate email format before sending to Supabase\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(email)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid email format\"\n            }, {\n                status: 400\n            });\n        }\n        // Create a fresh Supabase client for signup (don't use createServerClient as it reads cookies)\n        // Use anon key directly for auth operations\n        const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n        const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnd29vcWFrZHZyY2hmd3Jkbnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTQyNDEsImV4cCI6MjA3ODk3MDI0MX0.YpX0dYf_iueJVR1oK5SvREnO765JAKxriy2csdAEZlI\";\n        if (!supabaseUrl || !supabaseAnonKey) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Supabase configuration missing\"\n            }, {\n                status: 500\n            });\n        }\n        // Create a fresh client without any session/cookies for signup\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseAnonKey, {\n            auth: {\n                persistSession: false,\n                autoRefreshToken: false\n            }\n        });\n        // Normalize email\n        const normalizedEmail = email.toLowerCase().trim();\n        console.log(\"[signup] Attempting to sign up with email:\", normalizedEmail);\n        console.log(\"[signup] Supabase URL:\", supabaseUrl);\n        // Create user account in Supabase Auth\n        const { data: authData, error: authError } = await supabase.auth.signUp({\n            email: normalizedEmail,\n            password,\n            options: {\n                data: {\n                    full_name: fullName,\n                    phone: phone || null\n                },\n                emailRedirectTo: `${\"http://localhost:3000\" || 0}/onboarding`\n            }\n        });\n        if (authError) {\n            console.error(\"[signup] Auth error:\", authError);\n            // Provide more helpful error messages\n            let errorMessage = \"Failed to create account\";\n            let statusCode = 400;\n            if (authError.message?.includes(\"email_address_invalid\") || authError.code === \"email_address_invalid\") {\n                errorMessage = `Invalid email address: \"${normalizedEmail}\". This error usually means:\n1. Your Supabase project has email domain restrictions configured\n2. Email confirmation is required and the email format doesn't pass validation\n3. The Supabase project settings need to be updated\n\nTo fix this:\n- Go to your Supabase Dashboard > Authentication > Settings\n- Check \"Email Auth\" settings and ensure email confirmation is disabled for development\n- Check if there are any email domain allowlists/blocklists configured\n- Try using a different email address or check your Supabase project configuration`;\n            } else if (authError.message?.includes(\"rate limit\") || authError.message?.includes(\"too many requests\") || authError.code === \"over_email_send_rate_limit\") {\n                errorMessage = `Email rate limit exceeded. This happens when too many signup emails are sent in a short time.\n\nSolutions:\n1. Wait 5-10 minutes and try again\n2. Use a different email address\n3. For development: Disable email confirmation in Supabase Dashboard > Authentication > Settings\n4. Check your Supabase project's email rate limits in Dashboard > Settings > API`;\n                statusCode = 429; // Too Many Requests\n            } else if (authError.message?.includes(\"already registered\") || authError.code === \"signup_disabled\") {\n                errorMessage = \"An account with this email already exists. Please sign in instead.\";\n            } else if (authError.message?.includes(\"password\")) {\n                errorMessage = \"Password does not meet requirements.\";\n            } else {\n                errorMessage = authError.message || \"Failed to create account\";\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: errorMessage,\n                details: authError.message,\n                code: authError.code\n            }, {\n                status: statusCode\n            });\n        }\n        if (!authData.user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create user account\"\n            }, {\n                status: 500\n            });\n        }\n        const userId = authData.user.id;\n        console.log(\"[signup] User ID from auth:\", userId);\n        // Check if user was just created or already existed\n        // If user already existed, Supabase might return the existing user\n        // We need to check if this user already has a business\n        const adminSupabase = (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.createAdminClient)();\n        // Check if user already has a business (this indicates they've signed up before)\n        const { data: existingBusiness, error: businessCheckError } = await adminSupabase.from(\"businesses\").select(\"id, name, subscription_status, deleted_at\").eq(\"user_id\", userId).is(\"deleted_at\", null).maybeSingle();\n        if (businessCheckError && businessCheckError.code !== \"PGRST116\") {\n            console.error(\"[signup] Error checking for existing business:\", businessCheckError);\n        // Continue with signup if it's just a table not found error\n        } else if (existingBusiness) {\n            // User already has a business - this means they've signed up before\n            console.log(\"[signup] User already has a business:\", existingBusiness.id, existingBusiness.name);\n            // Check if business is already launched\n            const isLaunched = existingBusiness.subscription_status && existingBusiness.subscription_status !== null && existingBusiness.name && existingBusiness.name.trim().length > 0;\n            if (isLaunched) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"An account with this email already exists and is active. Please sign in instead.\",\n                    code: \"EMAIL_ALREADY_EXISTS\"\n                }, {\n                    status: 409\n                } // Conflict\n                );\n            } else {\n                // Business exists but not launched - user might be trying to restart onboarding\n                // Still return error to prevent confusion - they should sign in and continue\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"An account with this email already exists. Please sign in to continue setting up your business.\",\n                    code: \"EMAIL_ALREADY_EXISTS\"\n                }, {\n                    status: 409\n                } // Conflict\n                );\n            }\n        }\n        console.log(\"[signup] User is new or has no business - proceeding with signup\");\n        // Check if there's a public.users table and create record if needed\n        // The foreign key constraint might reference public.users instead of auth.users\n        // This is a workaround until the migration fixes the constraint\n        try {\n            // Try to check if users table exists by attempting to query it\n            const { data: existingUser, error: checkUserError } = await adminSupabase.from(\"users\").select(\"id\").eq(\"id\", userId).maybeSingle();\n            // If table exists (no PGRST116 error) but user doesn't exist, create it\n            if (!checkUserError && !existingUser) {\n                console.log(\"[signup] users table exists but user record missing - creating it\");\n                const { error: createUserError } = await adminSupabase.from(\"users\").insert({\n                    id: userId,\n                    email: normalizedEmail,\n                    full_name: fullName,\n                    phone: phone || null,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                });\n                if (createUserError) {\n                    console.warn(\"[signup] Could not create user record in users table:\", createUserError);\n                    // If insert fails due to missing columns, try with minimal fields\n                    if (createUserError.code === \"42703\" || createUserError.message?.includes(\"column\")) {\n                        try {\n                            const { error: minimalError } = await adminSupabase.from(\"users\").insert({\n                                id: userId\n                            });\n                            if (minimalError) {\n                                console.warn(\"[signup] Could not create minimal user record:\", minimalError);\n                            } else {\n                                console.log(\"[signup] Created minimal user record in users table\");\n                            }\n                        } catch (e) {\n                            console.warn(\"[signup] Failed to create minimal user record:\", e);\n                        }\n                    }\n                } else {\n                    console.log(\"[signup] User record created in users table\");\n                }\n            } else if (checkUserError && checkUserError.code === \"PGRST116\") {\n                // Table doesn't exist - that's fine, foreign key should reference auth.users\n                console.log(\"[signup] users table does not exist - foreign key should reference auth.users\");\n            } else if (checkUserError) {\n                console.warn(\"[signup] Error checking users table:\", checkUserError);\n            }\n        } catch (error) {\n            // users table might not exist or have different structure\n            console.log(\"[signup] users table check failed:\", error);\n        }\n        // Create business record with no name (will be updated in step 1)\n        // Set notifications_enabled to false (Basic plan) by default - user can change in step 8\n        const { data: business, error: businessError } = await adminSupabase.from(\"businesses\").insert({\n            user_id: userId,\n            name: \"\",\n            subdomain: `temp-${Date.now()}`,\n            timezone: \"America/New_York\",\n            industry: \"other\",\n            notifications_enabled: false\n        }).select(\"id\").single();\n        if (businessError || !business) {\n            console.error(\"[signup] Error creating business:\", businessError);\n            // Don't fail the signup if business creation fails - user can still proceed\n            // The business will be created in step 1 if it doesn't exist\n            console.warn(\"[signup] Business creation failed, but user account was created. Business will be created in step 1.\");\n        } else {\n            console.log(\"[signup] Business created:\", business.id);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            user: {\n                id: authData.user.id,\n                email: authData.user.email\n            },\n            businessId: business?.id || null,\n            message: \"Account created successfully. Please check your email to verify your account.\"\n        });\n    } catch (error) {\n        console.error(\"[signup] Error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hdXRoL3NpZ251cC9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTJDO0FBQ1U7QUFDUjtBQUU3Qzs7Ozs7Ozs7Ozs7Q0FXQyxHQUNNLGVBQWVHLEtBQUtDLE9BQWdCO0lBQ3pDLElBQUk7UUFDRixNQUFNQyxPQUFPLE1BQU1ELFFBQVFFLElBQUk7UUFDL0IsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLFFBQVEsRUFBRUMsUUFBUSxFQUFFQyxLQUFLLEVBQUUsR0FBR0w7UUFFN0MsSUFBSSxDQUFDRSxTQUFTLENBQUNDLFlBQVksQ0FBQ0MsVUFBVTtZQUNwQyxPQUFPVCxxREFBWUEsQ0FBQ00sSUFBSSxDQUN0QjtnQkFBRUssT0FBTztZQUFxRCxHQUM5RDtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsbURBQW1EO1FBQ25ELE1BQU1DLGFBQWE7UUFDbkIsSUFBSSxDQUFDQSxXQUFXQyxJQUFJLENBQUNQLFFBQVE7WUFDM0IsT0FBT1AscURBQVlBLENBQUNNLElBQUksQ0FDdEI7Z0JBQUVLLE9BQU87WUFBdUIsR0FDaEM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLCtGQUErRjtRQUMvRiw0Q0FBNEM7UUFDNUMsTUFBTUcsY0FBY0MsMENBQW9DO1FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO1FBRWpFLElBQUksQ0FBQ0QsZUFBZSxDQUFDSSxpQkFBaUI7WUFDcEMsT0FBT25CLHFEQUFZQSxDQUFDTSxJQUFJLENBQ3RCO2dCQUFFSyxPQUFPO1lBQWlDLEdBQzFDO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSwrREFBK0Q7UUFDL0QsTUFBTVMsV0FBV3BCLG1FQUFZQSxDQUFDYyxhQUFhSSxpQkFBaUI7WUFDMURHLE1BQU07Z0JBQ0pDLGdCQUFnQjtnQkFDaEJDLGtCQUFrQjtZQUNwQjtRQUNGO1FBRUEsa0JBQWtCO1FBQ2xCLE1BQU1DLGtCQUFrQmxCLE1BQU1tQixXQUFXLEdBQUdDLElBQUk7UUFFaERDLFFB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WUFDTHZDLFFBQVFDLEdBQUcsQ0FBQyw4QkFBOEJ5QyxTQUFTeEIsRUFBRTtRQUN2RDtRQUVBLE9BQU85QyxxREFBWUEsQ0FBQ00sSUFBSSxDQUFDO1lBQ3ZCeUUsU0FBUztZQUNUbkMsTUFBTTtnQkFDSkUsSUFBSWYsU0FBU2EsSUFBSSxDQUFDRSxFQUFFO2dCQUNwQnZDLE9BQU93QixTQUFTYSxJQUFJLENBQUNyQyxLQUFLO1lBQzVCO1lBQ0F5RSxZQUFZVixVQUFVeEIsTUFBTTtZQUM1Qk4sU0FBUztRQUNYO0lBQ0YsRUFBRSxPQUFPN0IsT0FBTztRQUNkaUIsUUFBUWpCLEtBQUssQ0FBQyxtQkFBbUJBO1FBQ2pDLE9BQU9YLHFEQUFZQSxDQUFDTSxJQUFJLENBQ3RCO1lBQUVLLE9BQU87WUFBeUJnQyxTQUFTaEMsaUJBQWlCc0UsUUFBUXRFLE1BQU02QixPQUFPLEdBQUc7UUFBZ0IsR0FDcEc7WUFBRTVCLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLy4vc3JjL2FwcC9hcGkvYXV0aC9zaWdudXAvcm91dGUudHM/ZmYwOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuaW1wb3J0IHsgY3JlYXRlQWRtaW5DbGllbnQgfSBmcm9tICdAL2xpYi9kYic7XG5cbi8qKlxuICogUE9TVCAvYXBpL2F1dGgvc2lnbnVwXG4gKiBcbiAqIENyZWF0ZXMgYSBuZXcgdXNlciBhY2NvdW50IGFuZCBhIGJ1c2luZXNzIHJlY29yZCAod2l0aCBubyBuYW1lIGluaXRpYWxseSlcbiAqIFxuICogQm9keToge1xuICogICBlbWFpbDogc3RyaW5nXG4gKiAgIHBhc3N3b3JkOiBzdHJpbmdcbiAqICAgZnVsbE5hbWU6IHN0cmluZ1xuICogICBwaG9uZT86IHN0cmluZ1xuICogfVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkLCBmdWxsTmFtZSwgcGhvbmUgfSA9IGJvZHk7XG5cbiAgICBpZiAoIWVtYWlsIHx8ICFwYXNzd29yZCB8fCAhZnVsbE5hbWUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzOiBlbWFpbCwgcGFzc3dvcmQsIGZ1bGxOYW1lJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgZW1haWwgZm9ybWF0IGJlZm9yZSBzZW5kaW5nIHRvIFN1cGFiYXNlXG4gICAgY29uc3QgZW1haWxSZWdleCA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xuICAgIGlmICghZW1haWxSZWdleC50ZXN0KGVtYWlsKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYSBmcmVzaCBTdXBhYmFzZSBjbGllbnQgZm9yIHNpZ251cCAoZG9uJ3QgdXNlIGNyZWF0ZVNlcnZlckNsaWVudCBhcyBpdCByZWFkcyBjb29raWVzKVxuICAgIC8vIFVzZSBhbm9uIGtleSBkaXJlY3RseSBmb3IgYXV0aCBvcGVyYXRpb25zXG4gICAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gICAgY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5cbiAgICBpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUFub25LZXkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1N1cGFiYXNlIGNvbmZpZ3VyYXRpb24gbWlzc2luZycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBhIGZyZXNoIGNsaWVudCB3aXRob3V0IGFueSBzZXNzaW9uL2Nvb2tpZXMgZm9yIHNpZ251cFxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBOb3JtYWxpemUgZW1haWxcbiAgICBjb25zdCBub3JtYWxpemVkRW1haWwgPSBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnW3NpZ251cF0gQXR0ZW1wdGluZyB0byBzaWduIHVwIHdpdGggZW1haWw6Jywgbm9ybWFsaXplZEVtYWlsKTtcbiAgICBjb25zb2xlLmxvZygnW3NpZ251cF0gU3VwYWJhc2UgVVJMOicsIHN1cGFiYXNlVXJsKTtcblxuICAgIC8vIENyZWF0ZSB1c2VyIGFjY291bnQgaW4gU3VwYWJhc2UgQXV0aFxuICAgIGNvbnN0IHsgZGF0YTogYXV0aERhdGEsIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnblVwKHtcbiAgICAgIGVtYWlsOiBub3JtYWxpemVkRW1haWwsXG4gICAgICBwYXNzd29yZCxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGZ1bGxfbmFtZTogZnVsbE5hbWUsXG4gICAgICAgICAgcGhvbmU6IHBob25lIHx8IG51bGwsXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsUmVkaXJlY3RUbzogYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJ30vb25ib2FyZGluZ2AsXG4gICAgICAgIC8vIERpc2FibGUgZW1haWwgY29uZmlybWF0aW9uIGZvciBkZXZlbG9wbWVudCAoaWYgU3VwYWJhc2UgYWxsb3dzKVxuICAgICAgICAvLyBOb3RlOiBUaGlzIG1pZ2h0IG5vdCB3b3JrIGlmIFN1cGFiYXNlIGhhcyBlbWFpbCBjb25maXJtYXRpb24gcmVxdWlyZWRcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoYXV0aEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbc2lnbnVwXSBBdXRoIGVycm9yOicsIGF1dGhFcnJvcik7XG4gICAgICBcbiAgICAgIC8vIFByb3ZpZGUgbW9yZSBoZWxwZnVsIGVycm9yIG1lc3NhZ2VzXG4gICAgICBsZXQgZXJyb3JNZXNzYWdlID0gJ0ZhaWxlZCB0byBjcmVhdGUgYWNjb3VudCc7XG4gICAgICBsZXQgc3RhdHVzQ29kZSA9IDQwMDtcbiAgICAgIFxuICAgICAgaWYgKGF1dGhFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnZW1haWxfYWRkcmVzc19pbnZhbGlkJykgfHwgYXV0aEVycm9yLmNvZGUgPT09ICdlbWFpbF9hZGRyZXNzX2ludmFsaWQnKSB7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9IGBJbnZhbGlkIGVtYWlsIGFkZHJlc3M6IFwiJHtub3JtYWxpemVkRW1haWx9XCIuIFRoaXMgZXJyb3IgdXN1YWxseSBtZWFuczpcbjEuIFlvdXIgU3VwYWJhc2UgcHJvamVjdCBoYXMgZW1haWwgZG9tYWluIHJlc3RyaWN0aW9ucyBjb25maWd1cmVkXG4yLiBFbWFpbCBjb25maXJtYXRpb24gaXMgcmVxdWlyZWQgYW5kIHRoZSBlbWFpbCBmb3JtYXQgZG9lc24ndCBwYXNzIHZhbGlkYXRpb25cbjMuIFRoZSBTdXBhYmFzZSBwcm9qZWN0IHNldHRpbmdzIG5lZWQgdG8gYmUgdXBkYXRlZFxuXG5UbyBmaXggdGhpczpcbi0gR28gdG8geW91ciBTdXBhYmFzZSBEYXNoYm9hcmQgPiBBdXRoZW50aWNhdGlvbiA+IFNldHRpbmdzXG4tIENoZWNrIFwiRW1haWwgQXV0aFwiIHNldHRpbmdzIGFuZCBlbnN1cmUgZW1haWwgY29uZmlybWF0aW9uIGlzIGRpc2FibGVkIGZvciBkZXZlbG9wbWVudFxuLSBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGVtYWlsIGRvbWFpbiBhbGxvd2xpc3RzL2Jsb2NrbGlzdHMgY29uZmlndXJlZFxuLSBUcnkgdXNpbmcgYSBkaWZmZXJlbnQgZW1haWwgYWRkcmVzcyBvciBjaGVjayB5b3VyIFN1cGFiYXNlIHByb2plY3QgY29uZmlndXJhdGlvbmA7XG4gICAgICB9IGVsc2UgaWYgKGF1dGhFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncmF0ZSBsaW1pdCcpIHx8IGF1dGhFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygndG9vIG1hbnkgcmVxdWVzdHMnKSB8fCBhdXRoRXJyb3IuY29kZSA9PT0gJ292ZXJfZW1haWxfc2VuZF9yYXRlX2xpbWl0Jykge1xuICAgICAgICBlcnJvck1lc3NhZ2UgPSBgRW1haWwgcmF0ZSBsaW1pdCBleGNlZWRlZC4gVGhpcyBoYXBwZW5zIHdoZW4gdG9vIG1hbnkgc2lnbnVwIGVtYWlscyBhcmUgc2VudCBpbiBhIHNob3J0IHRpbWUuXG5cblNvbHV0aW9uczpcbjEuIFdhaXQgNS0xMCBtaW51dGVzIGFuZCB0cnkgYWdhaW5cbjIuIFVzZSBhIGRpZmZlcmVudCBlbWFpbCBhZGRyZXNzXG4zLiBGb3IgZGV2ZWxvcG1lbnQ6IERpc2FibGUgZW1haWwgY29uZmlybWF0aW9uIGluIFN1cGFiYXNlIERhc2hib2FyZCA+IEF1dGhlbnRpY2F0aW9uID4gU2V0dGluZ3NcbjQuIENoZWNrIHlvdXIgU3VwYWJhc2UgcHJvamVjdCdzIGVtYWlsIHJhdGUgbGltaXRzIGluIERhc2hib2FyZCA+IFNldHRpbmdzID4gQVBJYDtcbiAgICAgICAgc3RhdHVzQ29kZSA9IDQyOTsgLy8gVG9vIE1hbnkgUmVxdWVzdHNcbiAgICAgIH0gZWxzZSBpZiAoYXV0aEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdhbHJlYWR5IHJlZ2lzdGVyZWQnKSB8fCBhdXRoRXJyb3IuY29kZSA9PT0gJ3NpZ251cF9kaXNhYmxlZCcpIHtcbiAgICAgICAgZXJyb3JNZXNzYWdlID0gJ0FuIGFjY291bnQgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzLiBQbGVhc2Ugc2lnbiBpbiBpbnN0ZWFkLic7XG4gICAgICB9IGVsc2UgaWYgKGF1dGhFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncGFzc3dvcmQnKSkge1xuICAgICAgICBlcnJvck1lc3NhZ2UgPSAnUGFzc3dvcmQgZG9lcyBub3QgbWVldCByZXF1aXJlbWVudHMuJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVycm9yTWVzc2FnZSA9IGF1dGhFcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gY3JlYXRlIGFjY291bnQnO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IGVycm9yTWVzc2FnZSwgZGV0YWlsczogYXV0aEVycm9yLm1lc3NhZ2UsIGNvZGU6IGF1dGhFcnJvci5jb2RlIH0sXG4gICAgICAgIHsgc3RhdHVzOiBzdGF0dXNDb2RlIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCFhdXRoRGF0YS51c2VyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHVzZXIgYWNjb3VudCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJJZCA9IGF1dGhEYXRhLnVzZXIuaWQ7XG4gICAgY29uc29sZS5sb2coJ1tzaWdudXBdIFVzZXIgSUQgZnJvbSBhdXRoOicsIHVzZXJJZCk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgdXNlciB3YXMganVzdCBjcmVhdGVkIG9yIGFscmVhZHkgZXhpc3RlZFxuICAgIC8vIElmIHVzZXIgYWxyZWFkeSBleGlzdGVkLCBTdXBhYmFzZSBtaWdodCByZXR1cm4gdGhlIGV4aXN0aW5nIHVzZXJcbiAgICAvLyBXZSBuZWVkIHRvIGNoZWNrIGlmIHRoaXMgdXNlciBhbHJlYWR5IGhhcyBhIGJ1c2luZXNzXG4gICAgY29uc3QgYWRtaW5TdXBhYmFzZSA9IGNyZWF0ZUFkbWluQ2xpZW50KCk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGhhcyBhIGJ1c2luZXNzICh0aGlzIGluZGljYXRlcyB0aGV5J3ZlIHNpZ25lZCB1cCBiZWZvcmUpXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ0J1c2luZXNzLCBlcnJvcjogYnVzaW5lc3NDaGVja0Vycm9yIH0gPSBhd2FpdCBhZG1pblN1cGFiYXNlXG4gICAgICAuZnJvbSgnYnVzaW5lc3NlcycpXG4gICAgICAuc2VsZWN0KCdpZCwgbmFtZSwgc3Vic2NyaXB0aW9uX3N0YXR1cywgZGVsZXRlZF9hdCcpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuaXMoJ2RlbGV0ZWRfYXQnLCBudWxsKVxuICAgICAgLm1heWJlU2luZ2xlKCk7XG4gICAgXG4gICAgaWYgKGJ1c2luZXNzQ2hlY2tFcnJvciAmJiBidXNpbmVzc0NoZWNrRXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2Jykge1xuICAgICAgY29uc29sZS5lcnJvcignW3NpZ251cF0gRXJyb3IgY2hlY2tpbmcgZm9yIGV4aXN0aW5nIGJ1c2luZXNzOicsIGJ1c2luZXNzQ2hlY2tFcnJvcik7XG4gICAgICAvLyBDb250aW51ZSB3aXRoIHNpZ251cCBpZiBpdCdzIGp1c3QgYSB0YWJsZSBub3QgZm91bmQgZXJyb3JcbiAgICB9IGVsc2UgaWYgKGV4aXN0aW5nQnVzaW5lc3MpIHtcbiAgICAgIC8vIFVzZXIgYWxyZWFkeSBoYXMgYSBidXNpbmVzcyAtIHRoaXMgbWVhbnMgdGhleSd2ZSBzaWduZWQgdXAgYmVmb3JlXG4gICAgICBjb25zb2xlLmxvZygnW3NpZ251cF0gVXNlciBhbHJlYWR5IGhhcyBhIGJ1c2luZXNzOicsIGV4aXN0aW5nQnVzaW5lc3MuaWQsIGV4aXN0aW5nQnVzaW5lc3MubmFtZSk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIGJ1c2luZXNzIGlzIGFscmVhZHkgbGF1bmNoZWRcbiAgICAgIGNvbnN0IGlzTGF1bmNoZWQgPSBleGlzdGluZ0J1c2luZXNzLnN1YnNjcmlwdGlvbl9zdGF0dXMgJiYgXG4gICAgICAgIGV4aXN0aW5nQnVzaW5lc3Muc3Vic2NyaXB0aW9uX3N0YXR1cyAhPT0gbnVsbCAmJlxuICAgICAgICBleGlzdGluZ0J1c2luZXNzLm5hbWUgJiYgXG4gICAgICAgIGV4aXN0aW5nQnVzaW5lc3MubmFtZS50cmltKCkubGVuZ3RoID4gMDtcbiAgICAgIFxuICAgICAgaWYgKGlzTGF1bmNoZWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgXG4gICAgICAgICAgICBlcnJvcjogJ0FuIGFjY291bnQgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzIGFuZCBpcyBhY3RpdmUuIFBsZWFzZSBzaWduIGluIGluc3RlYWQuJyxcbiAgICAgICAgICAgIGNvZGU6ICdFTUFJTF9BTFJFQURZX0VYSVNUUydcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDkgfSAvLyBDb25mbGljdFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQnVzaW5lc3MgZXhpc3RzIGJ1dCBub3QgbGF1bmNoZWQgLSB1c2VyIG1pZ2h0IGJlIHRyeWluZyB0byByZXN0YXJ0IG9uYm9hcmRpbmdcbiAgICAgICAgLy8gU3RpbGwgcmV0dXJuIGVycm9yIHRvIHByZXZlbnQgY29uZnVzaW9uIC0gdGhleSBzaG91bGQgc2lnbiBpbiBhbmQgY29udGludWVcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgXG4gICAgICAgICAgICBlcnJvcjogJ0FuIGFjY291bnQgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzLiBQbGVhc2Ugc2lnbiBpbiB0byBjb250aW51ZSBzZXR0aW5nIHVwIHlvdXIgYnVzaW5lc3MuJyxcbiAgICAgICAgICAgIGNvZGU6ICdFTUFJTF9BTFJFQURZX0VYSVNUUydcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDkgfSAvLyBDb25mbGljdFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZygnW3NpZ251cF0gVXNlciBpcyBuZXcgb3IgaGFzIG5vIGJ1c2luZXNzIC0gcHJvY2VlZGluZyB3aXRoIHNpZ251cCcpO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUncyBhIHB1YmxpYy51c2VycyB0YWJsZSBhbmQgY3JlYXRlIHJlY29yZCBpZiBuZWVkZWRcbiAgICAvLyBUaGUgZm9yZWlnbiBrZXkgY29uc3RyYWludCBtaWdodCByZWZlcmVuY2UgcHVibGljLnVzZXJzIGluc3RlYWQgb2YgYXV0aC51c2Vyc1xuICAgIC8vIFRoaXMgaXMgYSB3b3JrYXJvdW5kIHVudGlsIHRoZSBtaWdyYXRpb24gZml4ZXMgdGhlIGNvbnN0cmFpbnRcbiAgICB0cnkge1xuICAgICAgLy8gVHJ5IHRvIGNoZWNrIGlmIHVzZXJzIHRhYmxlIGV4aXN0cyBieSBhdHRlbXB0aW5nIHRvIHF1ZXJ5IGl0XG4gICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nVXNlciwgZXJyb3I6IGNoZWNrVXNlckVycm9yIH0gPSBhd2FpdCBhZG1pblN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgLmVxKCdpZCcsIHVzZXJJZClcbiAgICAgICAgLm1heWJlU2luZ2xlKCk7XG4gICAgICBcbiAgICAgIC8vIElmIHRhYmxlIGV4aXN0cyAobm8gUEdSU1QxMTYgZXJyb3IpIGJ1dCB1c2VyIGRvZXNuJ3QgZXhpc3QsIGNyZWF0ZSBpdFxuICAgICAgaWYgKCFjaGVja1VzZXJFcnJvciAmJiAhZXhpc3RpbmdVc2VyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbc2lnbnVwXSB1c2VycyB0YWJsZSBleGlzdHMgYnV0IHVzZXIgcmVjb3JkIG1pc3NpbmcgLSBjcmVhdGluZyBpdCcpO1xuICAgICAgICBjb25zdCB7IGVycm9yOiBjcmVhdGVVc2VyRXJyb3IgfSA9IGF3YWl0IGFkbWluU3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIGVtYWlsOiBub3JtYWxpemVkRW1haWwsXG4gICAgICAgICAgICBmdWxsX25hbWU6IGZ1bGxOYW1lLFxuICAgICAgICAgICAgcGhvbmU6IHBob25lIHx8IG51bGwsXG4gICAgICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY3JlYXRlVXNlckVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdbc2lnbnVwXSBDb3VsZCBub3QgY3JlYXRlIHVzZXIgcmVjb3JkIGluIHVzZXJzIHRhYmxlOicsIGNyZWF0ZVVzZXJFcnJvcik7XG4gICAgICAgICAgLy8gSWYgaW5zZXJ0IGZhaWxzIGR1ZSB0byBtaXNzaW5nIGNvbHVtbnMsIHRyeSB3aXRoIG1pbmltYWwgZmllbGRzXG4gICAgICAgICAgaWYgKGNyZWF0ZVVzZXJFcnJvci5jb2RlID09PSAnNDI3MDMnIHx8IGNyZWF0ZVVzZXJFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnY29sdW1uJykpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgZXJyb3I6IG1pbmltYWxFcnJvciB9ID0gYXdhaXQgYWRtaW5TdXBhYmFzZVxuICAgICAgICAgICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgICAgICAgICAgLmluc2VydCh7IGlkOiB1c2VySWQgfSk7XG4gICAgICAgICAgICAgIGlmIChtaW5pbWFsRXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tzaWdudXBdIENvdWxkIG5vdCBjcmVhdGUgbWluaW1hbCB1c2VyIHJlY29yZDonLCBtaW5pbWFsRXJyb3IpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc2lnbnVwXSBDcmVhdGVkIG1pbmltYWwgdXNlciByZWNvcmQgaW4gdXNlcnMgdGFibGUnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tzaWdudXBdIEZhaWxlZCB0byBjcmVhdGUgbWluaW1hbCB1c2VyIHJlY29yZDonLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tzaWdudXBdIFVzZXIgcmVjb3JkIGNyZWF0ZWQgaW4gdXNlcnMgdGFibGUnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChjaGVja1VzZXJFcnJvciAmJiBjaGVja1VzZXJFcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIC8vIFRhYmxlIGRvZXNuJ3QgZXhpc3QgLSB0aGF0J3MgZmluZSwgZm9yZWlnbiBrZXkgc2hvdWxkIHJlZmVyZW5jZSBhdXRoLnVzZXJzXG4gICAgICAgIGNvbnNvbGUubG9nKCdbc2lnbnVwXSB1c2VycyB0YWJsZSBkb2VzIG5vdCBleGlzdCAtIGZvcmVpZ24ga2V5IHNob3VsZCByZWZlcmVuY2UgYXV0aC51c2VycycpO1xuICAgICAgfSBlbHNlIGlmIChjaGVja1VzZXJFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tzaWdudXBdIEVycm9yIGNoZWNraW5nIHVzZXJzIHRhYmxlOicsIGNoZWNrVXNlckVycm9yKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gdXNlcnMgdGFibGUgbWlnaHQgbm90IGV4aXN0IG9yIGhhdmUgZGlmZmVyZW50IHN0cnVjdHVyZVxuICAgICAgY29uc29sZS5sb2coJ1tzaWdudXBdIHVzZXJzIHRhYmxlIGNoZWNrIGZhaWxlZDonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGJ1c2luZXNzIHJlY29yZCB3aXRoIG5vIG5hbWUgKHdpbGwgYmUgdXBkYXRlZCBpbiBzdGVwIDEpXG4gICAgLy8gU2V0IG5vdGlmaWNhdGlvbnNfZW5hYmxlZCB0byBmYWxzZSAoQmFzaWMgcGxhbikgYnkgZGVmYXVsdCAtIHVzZXIgY2FuIGNoYW5nZSBpbiBzdGVwIDhcbiAgICBjb25zdCB7IGRhdGE6IGJ1c2luZXNzLCBlcnJvcjogYnVzaW5lc3NFcnJvciB9ID0gYXdhaXQgYWRtaW5TdXBhYmFzZVxuICAgICAgLmZyb20oJ2J1c2luZXNzZXMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgbmFtZTogJycsIC8vIEVtcHR5IG5hbWUgLSB3aWxsIGJlIHNldCBpbiBzdGVwIDFcbiAgICAgICAgc3ViZG9tYWluOiBgdGVtcC0ke0RhdGUubm93KCl9YCwgLy8gVGVtcG9yYXJ5LCB3aWxsIGJlIHVwZGF0ZWQgaW4gc3RlcCAyXG4gICAgICAgIHRpbWV6b25lOiAnQW1lcmljYS9OZXdfWW9yaycsIC8vIERlZmF1bHQsIHdpbGwgYmUgdXBkYXRlZCBpbiBzdGVwIDNcbiAgICAgICAgaW5kdXN0cnk6ICdvdGhlcicsIC8vIERlZmF1bHQsIHdpbGwgYmUgdXBkYXRlZCBpbiBzdGVwIDFcbiAgICAgICAgbm90aWZpY2F0aW9uc19lbmFibGVkOiBmYWxzZSwgLy8gRGVmYXVsdCB0byBCYXNpYyBwbGFuICgkMTEuOTkvbW9udGgpIC0gdXNlciBjYW4gdXBncmFkZSBpbiBzdGVwIDhcbiAgICAgIH0pXG4gICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoYnVzaW5lc3NFcnJvciB8fCAhYnVzaW5lc3MpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tzaWdudXBdIEVycm9yIGNyZWF0aW5nIGJ1c2luZXNzOicsIGJ1c2luZXNzRXJyb3IpO1xuICAgICAgLy8gRG9uJ3QgZmFpbCB0aGUgc2lnbnVwIGlmIGJ1c2luZXNzIGNyZWF0aW9uIGZhaWxzIC0gdXNlciBjYW4gc3RpbGwgcHJvY2VlZFxuICAgICAgLy8gVGhlIGJ1c2luZXNzIHdpbGwgYmUgY3JlYXRlZCBpbiBzdGVwIDEgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgY29uc29sZS53YXJuKCdbc2lnbnVwXSBCdXNpbmVzcyBjcmVhdGlvbiBmYWlsZWQsIGJ1dCB1c2VyIGFjY291bnQgd2FzIGNyZWF0ZWQuIEJ1c2luZXNzIHdpbGwgYmUgY3JlYXRlZCBpbiBzdGVwIDEuJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbc2lnbnVwXSBCdXNpbmVzcyBjcmVhdGVkOicsIGJ1c2luZXNzLmlkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IGF1dGhEYXRhLnVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiBhdXRoRGF0YS51c2VyLmVtYWlsLFxuICAgICAgfSxcbiAgICAgIGJ1c2luZXNzSWQ6IGJ1c2luZXNzPy5pZCB8fCBudWxsLFxuICAgICAgbWVzc2FnZTogJ0FjY291bnQgY3JlYXRlZCBzdWNjZXNzZnVsbHkuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsIHRvIHZlcmlmeSB5b3VyIGFjY291bnQuJyxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbc2lnbnVwXSBFcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVDbGllbnQiLCJjcmVhdGVBZG1pbkNsaWVudCIsIlBPU1QiLCJyZXF1ZXN0IiwiYm9keSIsImpzb24iLCJlbWFpbCIsInBhc3N3b3JkIiwiZnVsbE5hbWUiLCJwaG9uZSIsImVycm9yIiwic3RhdHVzIiwiZW1haWxSZWdleCIsInRlc3QiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsInN1cGFiYXNlIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsIm5vcm1hbGl6ZWRFbWFpbCIsInRvTG93ZXJDYXNlIiwidHJpbSIsImNvbnNvbGUiLCJsb2ciLCJkYXRhIiwiYXV0aERhdGEiLCJhdXRoRXJyb3IiLCJzaWduVXAiLCJvcHRpb25zIiwiZnVsbF9uYW1lIiwiZW1haWxSZWRpcmVjdFRvIiwiTkVYVF9QVUJMSUNfQVBQX1VSTCIsImVycm9yTWVzc2FnZSIsInN0YXR1c0NvZGUiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJjb2RlIiwiZGV0YWlscyIsInVzZXIiLCJ1c2VySWQiLCJpZCIsImFkbWluU3VwYWJhc2UiLCJleGlzdGluZ0J1c2luZXNzIiwiYnVzaW5lc3NDaGVja0Vycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaXMiLCJtYXliZVNpbmdsZSIsIm5hbWUiLCJpc0xhdW5jaGVkIiwic3Vic2NyaXB0aW9uX3N0YXR1cyIsImxlbmd0aCIsImV4aXN0aW5nVXNlciIsImNoZWNrVXNlckVycm9yIiwiY3JlYXRlVXNlckVycm9yIiwiaW5zZXJ0IiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInVwZGF0ZWRfYXQiLCJ3YXJuIiwibWluaW1hbEVycm9yIiwiZSIsImJ1c2luZXNzIiwiYnVzaW5lc3NFcnJvciIsInVzZXJfaWQiLCJzdWJkb21haW4iLCJub3ciLCJ0aW1lem9uZSIsImluZHVzdHJ5Iiwibm90aWZpY2F0aW9uc19lbmFibGVkIiwic2luZ2xlIiwic3VjY2VzcyIsImJ1c2luZXNzSWQiLCJFcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/signup/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminClient: () => (/* binding */ createAdminClient),\n/* harmony export */   createClientClient: () => (/* binding */ createClientClient),\n/* harmony export */   createServerClient: () => (/* binding */ createServerClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../../node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\n/**\n * Get Supabase client for server-side operations\n * \n * This function returns different clients based on context:\n * - If called from an authenticated API route, uses the user's JWT from Authorization header (respects RLS)\n * - If called from a public route or background job, uses service role (bypasses RLS)\n * \n * Usage in API routes:\n * ```ts\n * const supabase = await createServerClient();\n * const { data } = await supabase.from('businesses').select('*');\n * ```\n */ async function createServerClient() {\n    const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnd29vcWFrZHZyY2hmd3Jkbnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTQyNDEsImV4cCI6MjA3ODk3MDI0MX0.YpX0dYf_iueJVR1oK5SvREnO765JAKxriy2csdAEZlI\";\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!supabaseUrl) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n    }\n    if (!supabaseAnonKey && !supabaseServiceKey) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_ANON_KEY or SUPABASE_SERVICE_ROLE_KEY environment variable\");\n    }\n    // Try to get the user's JWT from Authorization header (for API routes)\n    let accessToken;\n    try {\n        const headersList = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.headers)();\n        const authHeader = headersList.get(\"authorization\");\n        if (authHeader?.startsWith(\"Bearer \")) {\n            accessToken = authHeader.substring(7);\n        }\n    } catch  {\n    // Not in a headers context\n    }\n    // If we have a user token from header, use anon key with that token (respects RLS)\n    if (accessToken && supabaseAnonKey) {\n        return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey, {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${accessToken}`\n                }\n            }\n        });\n    }\n    // Try to get session from cookies (Supabase stores session in cookies)\n    try {\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        const allCookies = cookieStore.getAll();\n        // Try to extract access token from cookies first\n        const supabaseUrlObj = new URL(supabaseUrl);\n        const projectRef = supabaseUrlObj.hostname.split(\".\")[0];\n        // Look for Supabase auth token cookie\n        // Try sb-api-auth-token first as it's the most common\n        const authCookieNames = [\n            `sb-api-auth-token`,\n            `sb-${projectRef}-auth-token`\n        ];\n        let accessToken;\n        for (const cookieName of authCookieNames){\n            const cookie = cookieStore.get(cookieName);\n            if (cookie?.value) {\n                // Log first 100 chars to see format (without exposing full token)\n                const preview = cookie.value.substring(0, 100);\n                console.log(`[createServerClient] Checking cookie: ${cookieName}, length: ${cookie.value.length}, preview: ${preview}...`);\n                try {\n                    // Try URL decoding first\n                    let decodedValue = cookie.value;\n                    try {\n                        decodedValue = decodeURIComponent(cookie.value);\n                    } catch  {\n                    // Not URL encoded\n                    }\n                    // Try parsing as JSON\n                    try {\n                        const session = JSON.parse(decodedValue);\n                        console.log(`[createServerClient] Parsed ${cookieName} as JSON, type:`, Array.isArray(session) ? \"array\" : typeof session, \"keys:\", Object.keys(session || {}));\n                        // Check if it's an array (Supabase sometimes stores tokens as array)\n                        if (Array.isArray(session) && session.length > 0) {\n                            console.log(`[createServerClient] Array has ${session.length} elements, checking each...`);\n                            // Try each element to find a valid JWT\n                            for(let i = 0; i < session.length; i++){\n                                const element = session[i];\n                                if (typeof element === \"string\") {\n                                    // Remove any quotes or extra characters\n                                    let cleanToken = element.trim();\n                                    if (cleanToken.startsWith('\"') && cleanToken.endsWith('\"') || cleanToken.startsWith(\"'\") && cleanToken.endsWith(\"'\")) {\n                                        cleanToken = cleanToken.slice(1, -1);\n                                    }\n                                    // Check if it looks like a JWT (has 3 parts separated by dots)\n                                    const parts = cleanToken.split(\".\");\n                                    if (parts.length === 3 && cleanToken.length > 100) {\n                                        console.log(`[createServerClient] Found valid JWT structure in element ${i}, using it as access token`);\n                                        // Use this token - even if signature validation fails later, \n                                        // Supabase might still accept it for RLS if the payload is valid\n                                        accessToken = cleanToken;\n                                        break;\n                                    }\n                                }\n                                // If element is an object, check for access_token\n                                if (element && typeof element === \"object\" && element.access_token) {\n                                    console.log(`[createServerClient] Found access_token in element ${i}: ${cookieName}`);\n                                    accessToken = element.access_token;\n                                    break;\n                                }\n                            }\n                            if (accessToken) {\n                                break;\n                            }\n                            // If no single element works, try joining all string elements\n                            const allStrings = session.filter((e)=>typeof e === \"string\");\n                            if (allStrings.length > 0) {\n                                const joined = allStrings.join(\"\");\n                                const parts = joined.split(\".\");\n                                if (parts.length === 3 && joined.length > 100) {\n                                    console.log(\"[createServerClient] Found JWT by joining array elements\");\n                                    accessToken = joined;\n                                    break;\n                                }\n                            }\n                        }\n                        if (session?.access_token) {\n                            console.log(`[createServerClient] Found access_token in ${cookieName}`);\n                            accessToken = session.access_token;\n                            break;\n                        }\n                        // Check for nested session object\n                        if (session?.session?.access_token) {\n                            console.log(`[createServerClient] Found access_token in nested session: ${cookieName}`);\n                            accessToken = session.session.access_token;\n                            break;\n                        }\n                    } catch (parseError) {\n                        // Not JSON, might be direct JWT token\n                        console.log(`[createServerClient] ${cookieName} is not JSON, checking if JWT`);\n                        if (decodedValue.length > 100 && decodedValue.includes(\".\")) {\n                            console.log(`[createServerClient] Using ${cookieName} as direct JWT token`);\n                            accessToken = decodedValue;\n                            break;\n                        }\n                    }\n                } catch (error) {\n                    console.error(`[createServerClient] Error processing ${cookieName}:`, error);\n                }\n            }\n        }\n        // If we found an access token, use it directly\n        if (accessToken && supabaseAnonKey) {\n            return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey, {\n                global: {\n                    headers: {\n                        Authorization: `Bearer ${accessToken}`\n                    }\n                },\n                auth: {\n                    persistSession: false,\n                    autoRefreshToken: false\n                }\n            });\n        }\n        // Fallback: Build cookie header for Supabase to read\n        const cookieHeader = allCookies.map((c)=>`${c.name}=${c.value}`).join(\"; \");\n        if (cookieHeader && supabaseAnonKey) {\n            // Create client with cookies - Supabase will extract session from cookies\n            return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey, {\n                global: {\n                    headers: {\n                        Cookie: cookieHeader\n                    }\n                },\n                auth: {\n                    persistSession: false,\n                    autoRefreshToken: false\n                }\n            });\n        }\n    } catch (error) {\n        console.error(\"Error reading cookies in createServerClient:\", error);\n    // Not in a cookies context, continue\n    }\n    // For public routes or background jobs, use service role key\n    // WARNING: This bypasses RLS - only use when necessary\n    if (supabaseServiceKey) {\n        return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        });\n    }\n    // Fallback to anon key (for public read operations)\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n}\n/**\n * Get Supabase client with service role (bypasses RLS)\n * \n * Use this ONLY for:\n * - Background jobs\n * - Webhook handlers\n * - Admin operations that need to bypass RLS\n * \n * Usage:\n * ```ts\n * const supabase = createAdminClient();\n * const { data } = await supabase.from('businesses').select('*');\n * ```\n */ function createAdminClient() {\n    const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!supabaseUrl) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n    }\n    if (!supabaseServiceKey) {\n        throw new Error(\"Missing SUPABASE_SERVICE_ROLE_KEY environment variable\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        }\n    });\n}\n/**\n * Get Supabase client for client-side operations\n * \n * This should be used in React components or client-side code.\n * It uses the anon key and relies on Supabase Auth for authentication.\n * \n * Usage in client components:\n * ```ts\n * 'use client';\n * const supabase = createClientClient();\n * ```\n */ function createClientClient() {\n    const supabaseUrl = \"https://rgwooqakdvrchfwrdnyx.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnd29vcWFrZHZyY2hmd3Jkbnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzOTQyNDEsImV4cCI6MjA3ODk3MDI0MX0.YpX0dYf_iueJVR1oK5SvREnO765JAKxriy2csdAEZlI\";\n    if (!supabaseUrl) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL environment variable\");\n    }\n    if (!supabaseAnonKey) {\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXFFO0FBQ3JCO0FBRWhEOzs7Ozs7Ozs7Ozs7Q0FZQyxHQUNNLGVBQWVHO0lBQ3BCLE1BQU1DLGNBQWNDLDBDQUFvQztJQUN4RCxNQUFNRyxrQkFBa0JILGtOQUF5QztJQUNqRSxNQUFNSyxxQkFBcUJMLFFBQVFDLEdBQUcsQ0FBQ0sseUJBQXlCO0lBRWhFLElBQUksQ0FBQ1AsYUFBYTtRQUNoQixNQUFNLElBQUlRLE1BQU07SUFDbEI7SUFFQSxJQUFJLENBQUNKLG1CQUFtQixDQUFDRSxvQkFBb0I7UUFDM0MsTUFBTSxJQUFJRSxNQUNSO0lBRUo7SUFFQSx1RUFBdUU7SUFDdkUsSUFBSUM7SUFFSixJQUFJO1FBQ0YsTUFBTUMsY0FBYyxNQUFNWixxREFBT0E7UUFDakMsTUFBTWEsYUFBYUQsWUFBWUUsR0FBRyxDQUFDO1FBQ25DLElBQUlELFlBQVlFLFdBQVcsWUFBWTtZQUNyQ0osY0FBY0UsV0FBV0csU0FBUyxDQUFDO1FBQ3JDO0lBQ0YsRUFBRSxPQUFNO0lBQ04sMkJBQTJCO0lBQzdCO0lBRUEsbUZBQW1GO0lBQ25GLElBQUlMLGVBQWVMLGlCQUFpQjtRQUNsQyxPQUFPUixtRUFBWUEsQ0FBQ0ksYUFBYUksaUJBQWlCO1lBQ2hEVyxRQUFRO2dCQUNOakIsU0FBUztvQkFDUGtCLGVBQWUsQ0FBQyxPQUFPLEVBQUVQLFlBQVksQ0FBQztnQkFDeEM7WUFDRjtRQUNGO0lBQ0Y7SUFFQSx1RUFBdUU7SUFDdkUsSUFBSTtRQUNGLE1BQU1RLGNBQWMsTUFBTXBCLHFEQUFPQTtRQUNqQyxNQUFNcUIsYUFBYUQsWUFBWUUsTUFBTTtRQUVyQyxpREFBaUQ7UUFDakQsTUFBTUMsaUJBQWlCLElBQUlDLElBQUlyQjtRQUMvQixNQUFNc0IsYUFBYUYsZUFBZUcsUUFBUSxDQUFDQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFFeEQsc0NBQXNDO1FBQ3RDLHNEQUFzRDtRQUN0RCxNQUFNQyxrQkFBa0I7WUFDdEIsQ0FBQyxpQkFBaUIsQ0FBQztZQUNuQixDQUFDLEdBQUcsRUFBRUgsV0FBVyxXQUFXLENBQUM7U0FDOUI7UUFFRCxJQUFJYjtRQUNKLEtBQUssTUFBTWlCLGNBQWNELGdCQUFpQjtZQUN4QyxNQUFNRSxTQUFTVixZQUFZTCxHQUFHLENBQUNjO1lBQy9CLElBQUlDLFFBQVFDLE9BQU87Z0JBQ2pCLGtFQUFrRTtnQkFDbEUsTUFBTUMsVUFBVUYsT0FBT0MsS0FBSyxDQUFDZCxTQUFTLENBQUMsR0FBRztnQkFDMUNnQixRQUFRQyxHQUFHLENBQUMsQ0FBQyxzQ0FBc0MsRUFBRUwsV0FBVyxVQUFVLEVBQUVDLE9BQU9DLEtBQUssQ0FBQ0ksTUFBTSxDQUFDLFdBQVcsRUFBRUgsUUFBUSxHQUFHLENBQUM7Z0JBQ3pILElBQUk7b0JBQ0YseUJBQXlCO29CQUN6QixJQUFJSSxlQUFlTixPQUFPQyxLQUFLO29CQUMvQixJQUFJO3dCQUNGSyxlQUFlQyxtQkFBbUJQLE9BQU9DLEtBQUs7b0JBQ2hELEVBQUUsT0FBTTtvQkFDTixrQkFBa0I7b0JBQ3BCO29CQUVBLHNCQUFzQjtvQkFDdEIsSUFBSTt3QkFDRixNQUFNTyxVQUFVQyxLQUFLQyxLQUFLLENBQUNKO3dCQUMzQkgsUUFBUUMsR0FBRyxDQUFDLENBQUMsNEJBQTRCLEVBQUVMLFdBQVcsZUFBZSxDQUFDLEVBQUVZLE1BQU1DLE9BQU8sQ0FBQ0osV0FBVyxVQUFVLE9BQU9BLFNBQVMsU0FBU0ssT0FBT0MsSUFBSSxDQUFDTixXQUFXLENBQUM7d0JBRTVKLHFFQUFxRTt3QkFDckUsSUFBSUcsTUFBTUMsT0FBTyxDQUFDSixZQUFZQSxRQUFRSCxNQUFNLEdBQUcsR0FBRzs0QkFDaERGLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLCtCQUErQixFQUFFSSxRQUFRSCxNQUFNLENBQUMsMkJBQTJCLENBQUM7NEJBRXpGLHVDQUF1Qzs0QkFDdkMsSUFBSyxJQUFJVSxJQUFJLEdBQUdBLElBQUlQLFFBQVFILE1BQU0sRUFBRVUsSUFBSztnQ0FDdkMsTUFBTUMsVUFBVVIsT0FBTyxDQUFDTyxFQUFFO2dDQUUxQixJQUFJLE9BQU9DLFlBQVksVUFBVTtvQ0FDL0Isd0NBQXdDO29DQUN4QyxJQUFJQyxhQUFhRCxRQUFRRSxJQUFJO29DQUM3QixJQUFJLFdBQVloQyxVQUFVLENBQUMsUUFBUStCLFdBQVdFLFFBQVEsQ0FBQyxRQUNsREYsV0FBVy9CLFVBQVUsQ0FBQyxRQUFRK0IsV0FBV0UsUUFBUSxDQUFDLE1BQU87d0NBQzVERixhQUFhQSxXQUFXRyxLQUFLLENBQUMsR0FBRyxDQUFDO29DQUNwQztvQ0FFQSwrREFBK0Q7b0NBQy9ELE1BQU1DLFFBQVFKLFdBQVdwQixLQUFLLENBQUM7b0NBQy9CLElBQUl3QixNQUFNaEIsTUFBTSxLQUFLLEtBQUtZLFdBQVdaLE1BQU0sR0FBRyxLQUFLO3dDQUNqREYsUUFBUUMsR0FBRyxDQUFDLENBQUMsMERBQTBELEVBQUVXLEVBQUUsMEJBQTBCLENBQUM7d0NBQ3RHLDhEQUE4RDt3Q0FDOUQsaUVBQWlFO3dDQUNqRWpDLGNBQWNtQzt3Q0FDZDtvQ0FDRjtnQ0FDRjtnQ0FFQSxrREFBa0Q7Z0NBQ2xELElBQUlELFdBQVcsT0FBT0EsWUFBWSxZQUFZQSxRQUFRTSxZQUFZLEVBQUU7b0NBQ2xFbkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsbURBQW1ELEVBQUVXLEVBQUUsRUFBRSxFQUFFaEIsV0FBVyxDQUFDO29DQUNwRmpCLGNBQWNrQyxRQUFRTSxZQUFZO29DQUNsQztnQ0FDRjs0QkFDRjs0QkFFQSxJQUFJeEMsYUFBYTtnQ0FDZjs0QkFDRjs0QkFFQSw4REFBOEQ7NEJBQzlELE1BQU15QyxhQUFhZixRQUFRZ0IsTUFBTSxDQUFDQyxDQUFBQSxJQUFLLE9BQU9BLE1BQU07NEJBQ3BELElBQUlGLFdBQVdsQixNQUFNLEdBQUcsR0FBRztnQ0FDekIsTUFBTXFCLFNBQVNILFdBQVdJLElBQUksQ0FBQztnQ0FDL0IsTUFBTU4sUUFBUUssT0FBTzdCLEtBQUssQ0FBQztnQ0FDM0IsSUFBSXdCLE1BQU1oQixNQUFNLEtBQUssS0FBS3FCLE9BQU9yQixNQUFNLEdBQUcsS0FBSztvQ0FDN0NGLFFBQVFDLEdBQUcsQ0FBQztvQ0FDWnRCLGNBQWM0QztvQ0FDZDtnQ0FDRjs0QkFDRjt3QkFDRjt3QkFFQSxJQUFJbEIsU0FBU2MsY0FBYzs0QkFDekJuQixRQUFRQyxHQUFHLENBQUMsQ0FBQywyQ0FBMkMsRUFBRUwsV0FBVyxDQUFDOzRCQUN0RWpCLGNBQWMwQixRQUFRYyxZQUFZOzRCQUNsQzt3QkFDRjt3QkFFQSxrQ0FBa0M7d0JBQ2xDLElBQUlkLFNBQVNBLFNBQVNjLGNBQWM7NEJBQ2xDbkIsUUFBUUMsR0FBRyxDQUFDLENBQUMsMkRBQTJELEVBQUVMLFdBQVcsQ0FBQzs0QkFDdEZqQixjQUFjMEIsUUFBUUEsT0FBTyxDQUFDYyxZQUFZOzRCQUMxQzt3QkFDRjtvQkFDRixFQUFFLE9BQU9NLFlBQVk7d0JBQ25CLHNDQUFzQzt3QkFDdEN6QixRQUFRQyxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsRUFBRUwsV0FBVyw2QkFBNkIsQ0FBQzt3QkFDN0UsSUFBSU8sYUFBYUQsTUFBTSxHQUFHLE9BQU9DLGFBQWF1QixRQUFRLENBQUMsTUFBTTs0QkFDM0QxQixRQUFRQyxHQUFHLENBQUMsQ0FBQywyQkFBMkIsRUFBRUwsV0FBVyxvQkFBb0IsQ0FBQzs0QkFDMUVqQixjQUFjd0I7NEJBQ2Q7d0JBQ0Y7b0JBQ0Y7Z0JBQ0YsRUFBRSxPQUFPd0IsT0FBTztvQkFDZDNCLFFBQVEyQixLQUFLLENBQUMsQ0FBQyxzQ0FBc0MsRUFBRS9CLFdBQVcsQ0FBQyxDQUFDLEVBQUUrQjtnQkFDeEU7WUFDRjtRQUNGO1FBRUEsK0NBQStDO1FBQy9DLElBQUloRCxlQUFlTCxpQkFBaUI7WUFDbEMsT0FBT1IsbUVBQVlBLENBQUNJLGFBQWFJLGlCQUFpQjtnQkFDaERXLFFBQVE7b0JBQ05qQixTQUFTO3dCQUNQa0IsZUFBZSxDQUFDLE9BQU8sRUFBRVAsWUFBWSxDQUFDO29CQUN4QztnQkFDRjtnQkFDQWlELE1BQU07b0JBQ0pDLGdCQUFnQjtvQkFDaEJDLGtCQUFrQjtnQkFDcEI7WUFDRjtRQUNGO1FBRUEscURBQXFEO1FBQ3JELE1BQU1DLGVBQWUzQyxXQUFXNEMsR0FBRyxDQUFDQyxDQUFBQSxJQUFLLENBQUMsRUFBRUEsRUFBRUMsSUFBSSxDQUFDLENBQUMsRUFBRUQsRUFBRW5DLEtBQUssQ0FBQyxDQUFDLEVBQUUwQixJQUFJLENBQUM7UUFFdEUsSUFBSU8sZ0JBQWdCekQsaUJBQWlCO1lBQ25DLDBFQUEwRTtZQUMxRSxPQUFPUixtRUFBWUEsQ0FBQ0ksYUFBYUksaUJBQWlCO2dCQUNoRFcsUUFBUTtvQkFDTmpCLFNBQVM7d0JBQ1BtRSxRQUFRSjtvQkFDVjtnQkFDRjtnQkFDQUgsTUFBTTtvQkFDSkMsZ0JBQWdCO29CQUNoQkMsa0JBQWtCO2dCQUNwQjtZQUNGO1FBQ0Y7SUFDRixFQUFFLE9BQU9ILE9BQU87UUFDZDNCLFFBQVEyQixLQUFLLENBQUMsZ0RBQWdEQTtJQUM5RCxxQ0FBcUM7SUFDdkM7SUFFQSw2REFBNkQ7SUFDN0QsdURBQXVEO0lBQ3ZELElBQUluRCxvQkFBb0I7UUFDdEIsT0FBT1YsbUVBQVlBLENBQUNJLGFBQWFNLG9CQUFvQjtZQUNuRG9ELE1BQU07Z0JBQ0pFLGtCQUFrQjtnQkFDbEJELGdCQUFnQjtZQUNsQjtRQUNGO0lBQ0Y7SUFFQSxvREFBb0Q7SUFDcEQsT0FBTy9ELG1FQUFZQSxDQUFDSSxhQUFhSTtBQUNuQztBQUVBOzs7Ozs7Ozs7Ozs7O0NBYUMsR0FDTSxTQUFTOEQ7SUFDZCxNQUFNbEUsY0FBY0MsMENBQW9DO0lBQ3hELE1BQU1LLHFCQUFxQkwsUUFBUUMsR0FBRyxDQUFDSyx5QkFBeUI7SUFFaEUsSUFBSSxDQUFDUCxhQUFhO1FBQ2hCLE1BQU0sSUFBSVEsTUFBTTtJQUNsQjtJQUVBLElBQUksQ0FBQ0Ysb0JBQW9CO1FBQ3ZCLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtJQUVBLE9BQU9aLG1FQUFZQSxDQUFDSSxhQUFhTSxvQkFBb0I7UUFDbkRvRCxNQUFNO1lBQ0pFLGtCQUFrQjtZQUNsQkQsZ0JBQWdCO1FBQ2xCO0lBQ0Y7QUFDRjtBQUVBOzs7Ozs7Ozs7OztDQVdDLEdBQ00sU0FBU1E7SUFDZCxNQUFNbkUsY0FBY0MsMENBQW9DO0lBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0lBRWpFLElBQUksQ0FBQ0QsYUFBYTtRQUNoQixNQUFNLElBQUlRLE1BQU07SUFDbEI7SUFFQSxJQUFJLENBQUNKLGlCQUFpQjtRQUNwQixNQUFNLElBQUlJLE1BQU07SUFDbEI7SUFFQSxPQUFPWixtRUFBWUEsQ0FBQ0ksYUFBYUk7QUFDbkMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvLi9zcmMvbGliL2RiLnRzPzllNGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50LCBTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyBjb29raWVzLCBoZWFkZXJzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcblxuLyoqXG4gKiBHZXQgU3VwYWJhc2UgY2xpZW50IGZvciBzZXJ2ZXItc2lkZSBvcGVyYXRpb25zXG4gKiBcbiAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBkaWZmZXJlbnQgY2xpZW50cyBiYXNlZCBvbiBjb250ZXh0OlxuICogLSBJZiBjYWxsZWQgZnJvbSBhbiBhdXRoZW50aWNhdGVkIEFQSSByb3V0ZSwgdXNlcyB0aGUgdXNlcidzIEpXVCBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyIChyZXNwZWN0cyBSTFMpXG4gKiAtIElmIGNhbGxlZCBmcm9tIGEgcHVibGljIHJvdXRlIG9yIGJhY2tncm91bmQgam9iLCB1c2VzIHNlcnZpY2Ugcm9sZSAoYnlwYXNzZXMgUkxTKVxuICogXG4gKiBVc2FnZSBpbiBBUEkgcm91dGVzOlxuICogYGBgdHNcbiAqIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlU2VydmVyQ2xpZW50KCk7XG4gKiBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ2J1c2luZXNzZXMnKS5zZWxlY3QoJyonKTtcbiAqIGBgYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2VydmVyQ2xpZW50KCk6IFByb21pc2U8U3VwYWJhc2VDbGllbnQ+IHtcbiAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gIGNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZO1xuICBjb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xuXG4gIGlmICghc3VwYWJhc2VVcmwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlJyk7XG4gIH1cblxuICBpZiAoIXN1cGFiYXNlQW5vbktleSAmJiAhc3VwYWJhc2VTZXJ2aWNlS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ01pc3NpbmcgTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgb3IgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSdcbiAgICApO1xuICB9XG5cbiAgLy8gVHJ5IHRvIGdldCB0aGUgdXNlcidzIEpXVCBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyIChmb3IgQVBJIHJvdXRlcylcbiAgbGV0IGFjY2Vzc1Rva2VuOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IGhlYWRlcnNMaXN0ID0gYXdhaXQgaGVhZGVycygpO1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSBoZWFkZXJzTGlzdC5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoYXV0aEhlYWRlcj8uc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICBhY2Nlc3NUb2tlbiA9IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xuICAgIH1cbiAgfSBjYXRjaCB7XG4gICAgLy8gTm90IGluIGEgaGVhZGVycyBjb250ZXh0XG4gIH1cblxuICAvLyBJZiB3ZSBoYXZlIGEgdXNlciB0b2tlbiBmcm9tIGhlYWRlciwgdXNlIGFub24ga2V5IHdpdGggdGhhdCB0b2tlbiAocmVzcGVjdHMgUkxTKVxuICBpZiAoYWNjZXNzVG9rZW4gJiYgc3VwYWJhc2VBbm9uS2V5KSB7XG4gICAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgICBnbG9iYWw6IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRyeSB0byBnZXQgc2Vzc2lvbiBmcm9tIGNvb2tpZXMgKFN1cGFiYXNlIHN0b3JlcyBzZXNzaW9uIGluIGNvb2tpZXMpXG4gIHRyeSB7XG4gICAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKCk7XG4gICAgY29uc3QgYWxsQ29va2llcyA9IGNvb2tpZVN0b3JlLmdldEFsbCgpO1xuICAgIFxuICAgIC8vIFRyeSB0byBleHRyYWN0IGFjY2VzcyB0b2tlbiBmcm9tIGNvb2tpZXMgZmlyc3RcbiAgICBjb25zdCBzdXBhYmFzZVVybE9iaiA9IG5ldyBVUkwoc3VwYWJhc2VVcmwpO1xuICAgIGNvbnN0IHByb2plY3RSZWYgPSBzdXBhYmFzZVVybE9iai5ob3N0bmFtZS5zcGxpdCgnLicpWzBdO1xuICAgIFxuICAgIC8vIExvb2sgZm9yIFN1cGFiYXNlIGF1dGggdG9rZW4gY29va2llXG4gICAgLy8gVHJ5IHNiLWFwaS1hdXRoLXRva2VuIGZpcnN0IGFzIGl0J3MgdGhlIG1vc3QgY29tbW9uXG4gICAgY29uc3QgYXV0aENvb2tpZU5hbWVzID0gW1xuICAgICAgYHNiLWFwaS1hdXRoLXRva2VuYCxcbiAgICAgIGBzYi0ke3Byb2plY3RSZWZ9LWF1dGgtdG9rZW5gLFxuICAgIF07XG4gICAgXG4gICAgbGV0IGFjY2Vzc1Rva2VuOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgZm9yIChjb25zdCBjb29raWVOYW1lIG9mIGF1dGhDb29raWVOYW1lcykge1xuICAgICAgY29uc3QgY29va2llID0gY29va2llU3RvcmUuZ2V0KGNvb2tpZU5hbWUpO1xuICAgICAgaWYgKGNvb2tpZT8udmFsdWUpIHtcbiAgICAgICAgLy8gTG9nIGZpcnN0IDEwMCBjaGFycyB0byBzZWUgZm9ybWF0ICh3aXRob3V0IGV4cG9zaW5nIGZ1bGwgdG9rZW4pXG4gICAgICAgIGNvbnN0IHByZXZpZXcgPSBjb29raWUudmFsdWUuc3Vic3RyaW5nKDAsIDEwMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbY3JlYXRlU2VydmVyQ2xpZW50XSBDaGVja2luZyBjb29raWU6ICR7Y29va2llTmFtZX0sIGxlbmd0aDogJHtjb29raWUudmFsdWUubGVuZ3RofSwgcHJldmlldzogJHtwcmV2aWV3fS4uLmApO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFRyeSBVUkwgZGVjb2RpbmcgZmlyc3RcbiAgICAgICAgICBsZXQgZGVjb2RlZFZhbHVlID0gY29va2llLnZhbHVlO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkZWNvZGVkVmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQoY29va2llLnZhbHVlKTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIC8vIE5vdCBVUkwgZW5jb2RlZFxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBUcnkgcGFyc2luZyBhcyBKU09OXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBKU09OLnBhcnNlKGRlY29kZWRWYWx1ZSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gUGFyc2VkICR7Y29va2llTmFtZX0gYXMgSlNPTiwgdHlwZTpgLCBBcnJheS5pc0FycmF5KHNlc3Npb24pID8gJ2FycmF5JyA6IHR5cGVvZiBzZXNzaW9uLCAna2V5czonLCBPYmplY3Qua2V5cyhzZXNzaW9uIHx8IHt9KSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYW4gYXJyYXkgKFN1cGFiYXNlIHNvbWV0aW1lcyBzdG9yZXMgdG9rZW5zIGFzIGFycmF5KVxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2Vzc2lvbikgJiYgc2Vzc2lvbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbY3JlYXRlU2VydmVyQ2xpZW50XSBBcnJheSBoYXMgJHtzZXNzaW9uLmxlbmd0aH0gZWxlbWVudHMsIGNoZWNraW5nIGVhY2guLi5gKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIC8vIFRyeSBlYWNoIGVsZW1lbnQgdG8gZmluZCBhIHZhbGlkIEpXVFxuICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlc3Npb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc2Vzc2lvbltpXTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYW55IHF1b3RlcyBvciBleHRyYSBjaGFyYWN0ZXJzXG4gICAgICAgICAgICAgICAgICBsZXQgY2xlYW5Ub2tlbiA9IGVsZW1lbnQudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgaWYgKChjbGVhblRva2VuLnN0YXJ0c1dpdGgoJ1wiJykgJiYgY2xlYW5Ub2tlbi5lbmRzV2l0aCgnXCInKSkgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgKGNsZWFuVG9rZW4uc3RhcnRzV2l0aChcIidcIikgJiYgY2xlYW5Ub2tlbi5lbmRzV2l0aChcIidcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFuVG9rZW4gPSBjbGVhblRva2VuLnNsaWNlKDEsIC0xKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgaXQgbG9va3MgbGlrZSBhIEpXVCAoaGFzIDMgcGFydHMgc2VwYXJhdGVkIGJ5IGRvdHMpXG4gICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGNsZWFuVG9rZW4uc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMgJiYgY2xlYW5Ub2tlbi5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtjcmVhdGVTZXJ2ZXJDbGllbnRdIEZvdW5kIHZhbGlkIEpXVCBzdHJ1Y3R1cmUgaW4gZWxlbWVudCAke2l9LCB1c2luZyBpdCBhcyBhY2Nlc3MgdG9rZW5gKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoaXMgdG9rZW4gLSBldmVuIGlmIHNpZ25hdHVyZSB2YWxpZGF0aW9uIGZhaWxzIGxhdGVyLCBcbiAgICAgICAgICAgICAgICAgICAgLy8gU3VwYWJhc2UgbWlnaHQgc3RpbGwgYWNjZXB0IGl0IGZvciBSTFMgaWYgdGhlIHBheWxvYWQgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBjbGVhblRva2VuO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gSWYgZWxlbWVudCBpcyBhbiBvYmplY3QsIGNoZWNrIGZvciBhY2Nlc3NfdG9rZW5cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCAmJiB0eXBlb2YgZWxlbWVudCA9PT0gJ29iamVjdCcgJiYgZWxlbWVudC5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbY3JlYXRlU2VydmVyQ2xpZW50XSBGb3VuZCBhY2Nlc3NfdG9rZW4gaW4gZWxlbWVudCAke2l9OiAke2Nvb2tpZU5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IGVsZW1lbnQuYWNjZXNzX3Rva2VuO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gSWYgbm8gc2luZ2xlIGVsZW1lbnQgd29ya3MsIHRyeSBqb2luaW5nIGFsbCBzdHJpbmcgZWxlbWVudHNcbiAgICAgICAgICAgICAgY29uc3QgYWxsU3RyaW5ncyA9IHNlc3Npb24uZmlsdGVyKGUgPT4gdHlwZW9mIGUgPT09ICdzdHJpbmcnKTtcbiAgICAgICAgICAgICAgaWYgKGFsbFN0cmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGpvaW5lZCA9IGFsbFN0cmluZ3Muam9pbignJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBqb2luZWQuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzICYmIGpvaW5lZC5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbY3JlYXRlU2VydmVyQ2xpZW50XSBGb3VuZCBKV1QgYnkgam9pbmluZyBhcnJheSBlbGVtZW50cycpO1xuICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBqb2luZWQ7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHNlc3Npb24/LmFjY2Vzc190b2tlbikge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gRm91bmQgYWNjZXNzX3Rva2VuIGluICR7Y29va2llTmFtZX1gKTtcbiAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBzZXNzaW9uLmFjY2Vzc190b2tlbjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIGZvciBuZXN0ZWQgc2Vzc2lvbiBvYmplY3RcbiAgICAgICAgICAgIGlmIChzZXNzaW9uPy5zZXNzaW9uPy5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtjcmVhdGVTZXJ2ZXJDbGllbnRdIEZvdW5kIGFjY2Vzc190b2tlbiBpbiBuZXN0ZWQgc2Vzc2lvbjogJHtjb29raWVOYW1lfWApO1xuICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IHNlc3Npb24uc2Vzc2lvbi5hY2Nlc3NfdG9rZW47XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgICAgIC8vIE5vdCBKU09OLCBtaWdodCBiZSBkaXJlY3QgSldUIHRva2VuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gJHtjb29raWVOYW1lfSBpcyBub3QgSlNPTiwgY2hlY2tpbmcgaWYgSldUYCk7XG4gICAgICAgICAgICBpZiAoZGVjb2RlZFZhbHVlLmxlbmd0aCA+IDEwMCAmJiBkZWNvZGVkVmFsdWUuaW5jbHVkZXMoJy4nKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW2NyZWF0ZVNlcnZlckNsaWVudF0gVXNpbmcgJHtjb29raWVOYW1lfSBhcyBkaXJlY3QgSldUIHRva2VuYCk7XG4gICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gZGVjb2RlZFZhbHVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgW2NyZWF0ZVNlcnZlckNsaWVudF0gRXJyb3IgcHJvY2Vzc2luZyAke2Nvb2tpZU5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBJZiB3ZSBmb3VuZCBhbiBhY2Nlc3MgdG9rZW4sIHVzZSBpdCBkaXJlY3RseVxuICAgIGlmIChhY2Nlc3NUb2tlbiAmJiBzdXBhYmFzZUFub25LZXkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xuICAgICAgICBnbG9iYWw6IHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBhdXRoOiB7XG4gICAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEZhbGxiYWNrOiBCdWlsZCBjb29raWUgaGVhZGVyIGZvciBTdXBhYmFzZSB0byByZWFkXG4gICAgY29uc3QgY29va2llSGVhZGVyID0gYWxsQ29va2llcy5tYXAoYyA9PiBgJHtjLm5hbWV9PSR7Yy52YWx1ZX1gKS5qb2luKCc7ICcpO1xuICAgIFxuICAgIGlmIChjb29raWVIZWFkZXIgJiYgc3VwYWJhc2VBbm9uS2V5KSB7XG4gICAgICAvLyBDcmVhdGUgY2xpZW50IHdpdGggY29va2llcyAtIFN1cGFiYXNlIHdpbGwgZXh0cmFjdCBzZXNzaW9uIGZyb20gY29va2llc1xuICAgICAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgICAgIGdsb2JhbDoge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIENvb2tpZTogY29va2llSGVhZGVyLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGF1dGg6IHtcbiAgICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsIC8vIFdlJ3JlIGhhbmRsaW5nIGNvb2tpZXMgbWFudWFsbHlcbiAgICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWFkaW5nIGNvb2tpZXMgaW4gY3JlYXRlU2VydmVyQ2xpZW50OicsIGVycm9yKTtcbiAgICAvLyBOb3QgaW4gYSBjb29raWVzIGNvbnRleHQsIGNvbnRpbnVlXG4gIH1cblxuICAvLyBGb3IgcHVibGljIHJvdXRlcyBvciBiYWNrZ3JvdW5kIGpvYnMsIHVzZSBzZXJ2aWNlIHJvbGUga2V5XG4gIC8vIFdBUk5JTkc6IFRoaXMgYnlwYXNzZXMgUkxTIC0gb25seSB1c2Ugd2hlbiBuZWNlc3NhcnlcbiAgaWYgKHN1cGFiYXNlU2VydmljZUtleSkge1xuICAgIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSwge1xuICAgICAgYXV0aDoge1xuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEZhbGxiYWNrIHRvIGFub24ga2V5IChmb3IgcHVibGljIHJlYWQgb3BlcmF0aW9ucylcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5ISk7XG59XG5cbi8qKlxuICogR2V0IFN1cGFiYXNlIGNsaWVudCB3aXRoIHNlcnZpY2Ugcm9sZSAoYnlwYXNzZXMgUkxTKVxuICogXG4gKiBVc2UgdGhpcyBPTkxZIGZvcjpcbiAqIC0gQmFja2dyb3VuZCBqb2JzXG4gKiAtIFdlYmhvb2sgaGFuZGxlcnNcbiAqIC0gQWRtaW4gb3BlcmF0aW9ucyB0aGF0IG5lZWQgdG8gYnlwYXNzIFJMU1xuICogXG4gKiBVc2FnZTpcbiAqIGBgYHRzXG4gKiBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUFkbWluQ2xpZW50KCk7XG4gKiBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ2J1c2luZXNzZXMnKS5zZWxlY3QoJyonKTtcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQWRtaW5DbGllbnQoKTogU3VwYWJhc2VDbGllbnQge1xuICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcblxuICBpZiAoIXN1cGFiYXNlVXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xuICB9XG5cbiAgaWYgKCFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xuICB9XG5cbiAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XG4gICAgYXV0aDoge1xuICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsXG4gICAgfSxcbiAgfSk7XG59XG5cbi8qKlxuICogR2V0IFN1cGFiYXNlIGNsaWVudCBmb3IgY2xpZW50LXNpZGUgb3BlcmF0aW9uc1xuICogXG4gKiBUaGlzIHNob3VsZCBiZSB1c2VkIGluIFJlYWN0IGNvbXBvbmVudHMgb3IgY2xpZW50LXNpZGUgY29kZS5cbiAqIEl0IHVzZXMgdGhlIGFub24ga2V5IGFuZCByZWxpZXMgb24gU3VwYWJhc2UgQXV0aCBmb3IgYXV0aGVudGljYXRpb24uXG4gKiBcbiAqIFVzYWdlIGluIGNsaWVudCBjb21wb25lbnRzOlxuICogYGBgdHNcbiAqICd1c2UgY2xpZW50JztcbiAqIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50Q2xpZW50KCk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNsaWVudENsaWVudCgpOiBTdXBhYmFzZUNsaWVudCB7XG4gIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuICBjb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTtcblxuICBpZiAoIXN1cGFiYXNlVXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xuICB9XG5cbiAgaWYgKCFzdXBhYmFzZUFub25LZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgZW52aXJvbm1lbnQgdmFyaWFibGUnKTtcbiAgfVxuXG4gIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG59XG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjb29raWVzIiwiaGVhZGVycyIsImNyZWF0ZVNlcnZlckNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwiYWNjZXNzVG9rZW4iLCJoZWFkZXJzTGlzdCIsImF1dGhIZWFkZXIiLCJnZXQiLCJzdGFydHNXaXRoIiwic3Vic3RyaW5nIiwiZ2xvYmFsIiwiQXV0aG9yaXphdGlvbiIsImNvb2tpZVN0b3JlIiwiYWxsQ29va2llcyIsImdldEFsbCIsInN1cGFiYXNlVXJsT2JqIiwiVVJMIiwicHJvamVjdFJlZiIsImhvc3RuYW1lIiwic3BsaXQiLCJhdXRoQ29va2llTmFtZXMiLCJjb29raWVOYW1lIiwiY29va2llIiwidmFsdWUiLCJwcmV2aWV3IiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsImRlY29kZWRWYWx1ZSIsImRlY29kZVVSSUNvbXBvbmVudCIsInNlc3Npb24iLCJKU09OIiwicGFyc2UiLCJBcnJheSIsImlzQXJyYXkiLCJPYmplY3QiLCJrZXlzIiwiaSIsImVsZW1lbnQiLCJjbGVhblRva2VuIiwidHJpbSIsImVuZHNXaXRoIiwic2xpY2UiLCJwYXJ0cyIsImFjY2Vzc190b2tlbiIsImFsbFN0cmluZ3MiLCJmaWx0ZXIiLCJlIiwiam9pbmVkIiwiam9pbiIsInBhcnNlRXJyb3IiLCJpbmNsdWRlcyIsImVycm9yIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImNvb2tpZUhlYWRlciIsIm1hcCIsImMiLCJuYW1lIiwiQ29va2llIiwiY3JlYXRlQWRtaW5DbGllbnQiLCJjcmVhdGVDbGllbnRDbGllbnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Fsignup%2Froute&page=%2Fapi%2Fauth%2Fsignup%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fsignup%2Froute.ts&appDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2F3017387smacbookm%2FDownloads%2FCareer%2FTithi%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();